const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-C1kKzVV0.js","assets/index-BNEGGE57.js","assets/index.n2k6cYEa.css"])))=>i.map(i=>d[i]);
import{r,j as e,t as we,a3 as Aa,b as V,c as R,f as M,_ as ct,a0 as mt,W as ut,a4 as ks,y as v,A as ws,D as Cs,u as Ss,w as Te,i as Ne,m as Ps,a5 as _a,B as j,a6 as Ea,I as te,H as $,a7 as Ds,a8 as Fa,a2 as Ua,T as Ls,o as As,p as ot,q as A,s as _s,v as Oa,S as Ta,a9 as za,M as ke,x as w,X as Ia,Y as $a,Z as Es,$ as Fs,a1 as Us,C as Os,n as Ts,V as Ma}from"./index-BNEGGE57.js";import{R as zs,P as Is}from"./RangeDatePicker-quGvPJGm.js";import{S as $s}from"./file-BKwY2KsR.js";import{S as Ms}from"./chevron-down-BH7m1aFk.js";import{S as Rs}from"./chevron-up-D72zhKQL.js";import{D as Ra}from"./date-picker-BeppTpDh.js";import{f as Se,g as Ce,a as Ha,h as Ba,b as it}from"./leadHelpers-DM4gjVXH.js";const ze=a=>r.createElement("svg",{className:"size-6",width:"1em",height:"1em",viewBox:"0 0 24 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},r.createElement("path",{d:"M12.814 4.75L4.78516 16.0352H11.1859L11.1859 23.25L19.2148 11.9648L12.814 11.9648V4.75Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),Hs=({name:a,datetime:i,callback:d,note:x,status:u})=>{const m=N=>{const g=(N==null?void 0:N.toLowerCase())||"";return g.includes("converted")||g==="qualified"?"success":g.includes("negotiation")||g.includes("contacted")?"info":g.includes("call")||g==="new"?"warning":g.includes("lost")||g.includes("not interested")?"error":"light"};return e.jsxs("div",{className:"rounded-lg border border-gray-50 bg-gray-100 p-4 dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-white",children:a}),e.jsx("span",{children:i}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:e.jsx(we,{size:"sm",color:m(u),children:u||"N/A"})})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-200",children:x}),d&&e.jsxs("div",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:["Next Follow-up: ",d]})]})},Bs=async(a,i,d)=>{if(a.length===0){d.warning("Please select at least one lead to download.");return}try{const x=(await Aa(async()=>{const{default:c}=await import("./jspdf.es.min-C1kKzVV0.js").then(T=>T.j);return{default:c}},__vite__mapDeps([0,1,2]))).default,u=(await Aa(async()=>{const{default:c}=await import("./jspdf.plugin.autotable-Ctn9oCMc.js");return{default:c}},[])).default,m=new x("landscape");m.setFontSize(18),m.text("Lead Report",14,20),m.setFontSize(10),m.text(`Generated on: ${new Date().toLocaleDateString("en-IN")}`,14,28);const g=i.filter(c=>a.includes(c._id)).map(c=>{const T=c.remarks&&c.remarks.length>0?c.remarks[c.remarks.length-1].remark:"No remarks";return[c.fullName,Se(c.createdAt),c.phone1,c.contactPoint||"N/A",c.campaign||"N/A",Ce(c.leadStatus),T.substring(0,30)+(T.length>30?"...":""),Se(c.followUpDate)]});u(m,{head:[["Name","Date Added","Mobile","Contact Point","Campaign","Lead Status","Latest Remark","Follow-up"]],body:g,startY:35,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[70,95,255],textColor:255},alternateRowStyles:{fillColor:[245,247,250]},margin:{top:35}});const _=m.internal.getNumberOfPages();for(let c=1;c<=_;c++)m.setPage(c),m.setFontSize(8),m.text(`Page ${c} of ${_}`,m.internal.pageSize.getWidth()/2,m.internal.pageSize.getHeight()-10,{align:"center"});m.save(`leads-report-${new Date().toISOString().split("T")[0]}.pdf`),d.success(`PDF downloaded with ${a.length} lead(s)!`)}catch(x){console.error("Error generating PDF:",x),d.error("Failed to generate PDF. Please try again.")}},dt=async(a,i)=>{var d;try{const x=await V.get(`${R}/customers/all`,{withCredentials:!0});return typeof a=="function"&&a(x.data.customers),typeof i=="function"&&i(!1),x.data.customers}catch(x){return console.error("Error fetching customers:",x),typeof i=="function"&&i(!1),((d=x.response)==null?void 0:d.status)===401&&alert("Please login to view leads."),[]}},Va=async(a,i,d)=>{try{const u=(await V.get(`${R}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(m=>({value:m.value,label:m.name}));return M(d)&&u.push({value:"__add_new__",label:"+ Add New Campaign"}),typeof a=="function"&&a(u),u}catch(x){console.error("Error fetching campaigns:",x);const u=[...i];return M(d)&&u.push({value:"__add_new__",label:"+ Add New Campaign"}),typeof a=="function"&&a(u),u}},Vs=async(a,i,d,x,u,m,N,g,_,c,T,ae,pe,W)=>{var J,D;if(!a.trim()){W.error("Campaign name is required");return}try{const K=await V.post(`${R}/campaigns/create`,{name:a,description:i,discountPercentage:d?parseFloat(d):0,cashback:x?parseFloat(x):0,isActive:u},{withCredentials:!0});W.success("Campaign created successfully!"),typeof m=="function"&&m(K.data.campaign.value),typeof N=="function"&&await N(),typeof g=="function"&&g(),typeof _=="function"&&_(""),typeof c=="function"&&c(""),typeof T=="function"&&T(""),typeof ae=="function"&&ae(""),typeof pe=="function"&&pe(!0)}catch(K){console.error("Error creating campaign:",K),W.error(((D=(J=K.response)==null?void 0:J.data)==null?void 0:D.message)||"Failed to create campaign")}},Ws=(a,i)=>{var ne,f,I;const{setSelectedRow:d,setEditName:x,setEditPhone:u,setEditEmail:m,setEditStatus:N,setEditFollowUp:g,setFullName:_,setEmail:c,setPhone1:T,setPhone2:ae,setGender:pe,setDob:W,setPlace:J,setOtherPlace:D,setStatus:K,setEducation:Q,setOtherEducation:G,setContactPoint:se,setOtherContactPoint:S,setCampaign:re,setHandledByPerson:je,setFollowUpDate:ge,setRemarks:C,setLeadStatus:fe,setLeadPotential:X,setSelectedValues:z}=i;if(typeof d=="function"&&d(a),typeof x=="function"&&x(a.fullName),typeof u=="function"&&u(a.phone1),typeof m=="function"&&m(a.email),typeof N=="function"&&N(a.status),typeof g=="function"&&g(a.followUpDate?new Date(a.followUpDate).toISOString().split("T")[0]:""),typeof _=="function"&&_(a.fullName),typeof c=="function"&&c(a.email),typeof T=="function"&&T(a.phone1),typeof ae=="function"&&ae(a.phone2||""),typeof pe=="function"&&pe(a.gender||""),typeof W=="function"&&W(a.dob?new Date(a.dob).toISOString().split("T")[0]:""),typeof J=="function"&&(ct.find(L=>L.value===a.place)||!a.place?J(a.place||""):J("Other")),typeof D=="function"){const k=!ct.some(L=>L.value===a.place);D(a.otherPlace||k&&a.place||"")}if(typeof K=="function"&&K(a.status||""),typeof Q=="function"&&(mt.find(L=>L.value===a.education)||!a.education?Q(a.education||""):Q("Other")),typeof G=="function"&&(a.education==="Other"?G(a.otherEducation||""):!mt.find(L=>L.value===a.education)&&a.education?G(a.education):G("")),typeof se=="function"){const k=i.contactPointOptions||ut;(ne=a.contactPoint)==null||ne.toLowerCase(),k.find(he=>he.value===a.contactPoint)||!a.contactPoint?se(a.contactPoint||""):se("other")}if(typeof S=="function"){const k=(f=a.contactPoint)==null?void 0:f.toLowerCase();k==="other"||k==="reference"||k==="referance"?S(a.otherContactPoint||""):!(i.contactPointOptions||ut).find(P=>P.value===a.contactPoint)&&a.contactPoint?S(a.contactPoint):S("")}typeof re=="function"&&re(a.campaign||""),typeof je=="function"&&je(a.handledBy||""),typeof ge=="function"&&(a.leadStatus==="converted"||a.leadStatus==="lost"?ge(""):ge(a.followUpDate?new Date(a.followUpDate).toISOString().split("T")[0]:"")),typeof C=="function"&&C(""),typeof fe=="function"&&fe(a.leadStatus||""),typeof X=="function"&&X(a.leadPotential||"");const ve=((I=a.coursePreference)==null?void 0:I.map(k=>{const L=i.courseOptions||ks;if(typeof k=="string"){if(L.some(P=>P.value===k))return k;const le=L.find(P=>P.label===k);return le?le.value:k}return k}))||[];typeof z=="function"&&z(ve)},Ys=async(a,i,d,x,u,m,N,g,_,c,T,ae,pe,W,J,D,K,Q,G,se,S,re,je,ge,C,fe,X,z,ve,ne,f)=>{try{let I=a;const k=i.trim(),L=(a==null?void 0:a.leadStatus)!==d;if(k||L){const oe={remark:k?i:`Status changed to ${je(d||"new")}`,handledBy:(S==null?void 0:S.fullName)||"Unknown",nextFollowUpDate:d==="converted"?null:G||null,leadStatus:d||"new"},E=await V.post(`${R}/customers/remark/${a._id}`,oe,{withCredentials:!0});E.data.customer&&(I=E.data.customer)}const he={fullName:u,phone1:m,phone2:N,email:g,gender:_,dob:c,place:T,status:pe,education:W,otherEducation:J,contactPoint:D,otherContactPoint:D==="other"||(D==null?void 0:D.toLowerCase())==="reference"||(D==null?void 0:D.toLowerCase())==="referance"?K:"",campaign:Q,handledBy:(S==null?void 0:S.fullName)||re,followUpDate:d==="converted"?null:G,leadStatus:d,leadPotential:x,coursePreference:se},le=await V.put(`${R}/customers/update/${a._id}`,he,{withCredentials:!0});if(d==="converted")try{const P=fe.find(oe=>{var E;return((E=oe.extendedProps)==null?void 0:E.leadId)===a._id})}catch(P){console.error("Error managing calendar event:",P)}else if(G)try{const P=fe.find(Pe=>{var De;return((De=Pe.extendedProps)==null?void 0:De.leadId)===a._id}),oe=G,E={title:`Follow-up: ${u}`,start:oe,end:oe,allDay:!0,extendedProps:{calendar:"Warning",leadId:a._id,phone:m,email:g,status:d||"new"}};P?C(P.id,E):ge(E)}catch(P){console.error("Error managing calendar event:",P)}return typeof X=="function"&&await X(),le.data.customer?typeof z=="function"&&z(le.data.customer):typeof z=="function"&&z(I),typeof ve=="function"&&ve(""),typeof ne=="function"&&ne({type:"lead_updated",userName:(S==null?void 0:S.fullName)||"Someone",avatar:(S==null?void 0:S.avatar)||null,action:"updated lead",entityName:u,module:"Lead Management"}),typeof f=="function"&&f()&&v.success("Updated lead status",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),!0}catch(I){return console.error("Error updating lead:",I),typeof f=="function"&&f()&&v.error("Failed to update lead. Please try again.",{position:"top-center",autoClose:3e3}),!1}},qs=async(a,i,d,x,u,m,N,g)=>{if(!i){g.error("Only managers can delete leads.",{position:"top-center",autoClose:3e3}),typeof d=="function"&&d();return}try{await V.delete(`${R}/customers/delete/${a._id}`,{withCredentials:!0}),typeof u=="function"&&u(_=>_.filter(c=>c._id!==a._id)),typeof d=="function"&&d(),typeof x=="function"&&x(),typeof m=="function"&&m({type:"lead_deleted",userName:a.handledBy||"Someone",avatar:a.avatar||null,action:"deleted lead",entityName:a.fullName,module:"Lead Management"}),typeof N=="function"&&N()&&g.success("Lead deleted successfully!",{position:"top-center",autoClose:3e3})}catch(_){console.error("Error deleting lead:",_),typeof N=="function"&&N()&&g.error("Failed to delete lead. Please try again.",{position:"top-center",autoClose:3e3})}},Ks=async(a,i,d,x,u)=>{if(!(a!=null&&a.followUpDate)){u.error("No follow-up date set for this lead."),typeof i=="function"&&i();return}try{const N=new Date(a.followUpDate).toISOString().split("T")[0];typeof x=="function"&&x({title:`Follow-up: ${a.fullName}`,start:N,end:N,allDay:!0,extendedProps:{calendar:"Warning",leadId:a._id,phone:a.phone1,email:a.email,status:a.status}}),u.success(`Calendar reminder added for ${a.fullName}!`),typeof i=="function"&&i(),typeof d=="function"&&d()}catch(m){console.error("Error creating calendar event:",m),u.error("Failed to create calendar event.")}},Gs=async(a,i)=>{try{return(await V.put(`${R}/customers/mark-remark-read/${a}/${i}`,{},{withCredentials:!0})).data.customer}catch(d){throw console.error("Error marking remark as read:",d),d}},Wa=a=>{switch(a){case"strongProspect":return{bar:"bg-green-500"};case"potentialProspect":return{bar:"bg-blue-500"};case"weakProspect":return{bar:"bg-orange-500"};case"notAProspect":return{bar:"bg-gray-400"};default:return{bar:"bg-transparent"}}},Ya=a=>{if(!a)return"light";const i=new Date;i.setHours(0,0,0,0);const d=new Date(i);d.setDate(d.getDate()+1);const x=new Date(i);x.setDate(x.getDate()+2);const u=new Date(a);return u.setHours(0,0,0,0),u<=i?"error":u.getTime()===d.getTime()?"warning":u.getTime()===x.getTime()?"success":"light"},qa=a=>a?Se(a):"No Date";function cr(){var Da;const{user:a,selectedBrand:i}=r.useContext(ws),{addEvent:d,events:x,updateEvent:u}=Cs(),{addNotification:m,areToastsEnabled:N}=Ss(),[g,_]=r.useState(""),[c,T]=r.useState("followup_latest"),[ae,pe]=r.useState(""),[W,J]=r.useState(""),[D,K]=r.useState(""),[Q,G]=r.useState(""),[se,S]=r.useState(""),[re,je]=r.useState(!1),ge=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,0);return[s,n]},[C,fe]=r.useState(ge()),[X,z]=r.useState([]),[ve,ne]=r.useState(!0),[f,I]=r.useState(null),[k,L]=r.useState([]),[he,le]=r.useState([]),[P,oe]=r.useState([]),[E,Pe]=r.useState([]),[De,Ka]=r.useState([]),[Le,xt]=r.useState(null),[F,Me]=r.useState({top:0,left:0,arrowLeft:0}),[Re,pt]=r.useState(!1),[He,ht]=r.useState(!1),[gt,ft]=r.useState(null),[yt,bt]=r.useState({}),[jt,vt]=r.useState(!1),ie=r.useRef(null),de=r.useRef(null),Nt=r.useRef(null),{isOpen:Ga,openModal:Xa,closeModal:Be}=Te(),{isOpen:Za,openModal:Ja,closeModal:Ve}=Te(),{isOpen:Qa,openModal:es,closeModal:We}=Te(),{isOpen:ts,openModal:as,closeModal:Ye}=Te(),{isOpen:ss,openModal:rs,closeModal:qe}=Te(),[Xs,kt]=r.useState(""),[Zs,wt]=r.useState(""),[Js,Ct]=r.useState(""),[Qs,St]=r.useState(""),[er,Pt]=r.useState(""),[Dt,Lt]=r.useState(""),[At,_t]=r.useState(""),[Et,Ft]=r.useState(""),[Ut,Ot]=r.useState(""),[Tt,zt]=r.useState(""),[It,$t]=r.useState(""),[Mt,Rt]=r.useState(""),[Ht,Bt]=r.useState(""),[Vt,Wt]=r.useState(""),[Yt,ns]=r.useState(!1),[qt,Kt]=r.useState(""),[Gt,Xt]=r.useState(""),[Ke,Ge]=r.useState(""),[ce,Zt]=r.useState(""),[Jt,Qt]=r.useState(""),[ea,Xe]=r.useState(""),[ls,os]=r.useState(""),[tr,ar]=r.useState(""),[Ze,Je]=r.useState(""),[ta,aa]=r.useState([]),[me,sa]=r.useState(""),[Qe,ra]=r.useState(""),[na,la]=r.useState(""),[oa,ia]=r.useState(""),[da,ca]=r.useState(""),[ma,ua]=r.useState(""),[xa,pa]=r.useState(!0),[ha,ye]=r.useState(!1),is=M(a);(Da=a==null?void 0:a.roles)!=null&&Da.includes("Counsellor");const ga=Ne(a)||M(a),et=!Ne(a)&&!is,be=Ne(a)||M(a);r.useEffect(()=>{dt(z,ne),Va(L,Ma,a),vs(),ds()},[a]),r.useEffect(()=>{a&&(()=>{const s=a==null?void 0:a.isAdmin,n=M(a);(s||n)&&Ie((i==null?void 0:i._id)||(i==null?void 0:i.id))})()},[a,i]);const Ie=async(t=null)=>{try{const s=t?`${R}/users/dropdown?brandId=${t}`:`${R}/users/dropdown`,n=await V.get(s,{withCredentials:!0});Ka(n.data.users||[])}catch(s){console.error("Error fetching users:",s),v.error("Failed to fetch users for assignment")}},ds=async()=>{try{const s=(await V.get(`${R}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(n=>({value:n.value,label:n.name}));s.push({value:"other",label:"Other"}),M(a)&&s.push({value:"__add_new__",label:"+ Add New Contact Point"}),oe(s)}catch(t){console.error("Error fetching contact points:",t);const s=[...ut];M(a)&&s.push({value:"__add_new__",label:"+ Add New Contact Point"}),oe(s)}};r.useEffect(()=>{be&&i&&Ie((i==null?void 0:i._id)||(i==null?void 0:i.id))},[i,be]),r.useEffect(()=>{const t=sessionStorage.getItem("openLeadId");if(t&&X.length>0){const s=X.find(n=>n._id===t);s&&(st(s),sessionStorage.removeItem("openLeadId"))}},[X]);const tt=t=>{const l=window.innerWidth,o=window.innerHeight,y=85;let p=t.left,b=t.width/2;p+384>l-20&&(p=l-384-20),p<20&&(p=20),b=t.left+t.width/2-p,b=Math.max(20,Math.min(364,b));const U=t.top-y-20,O=o-t.bottom-20,ee=350;let Y=0,ue="",xe=0;return U>ee||U>O?(Y=t.top,ue="translateY(-100%) translateY(-10px)",xe=U):(Y=t.bottom,ue="translateY(10px)",xe=O),{top:Y,left:p,arrowLeft:b,transform:ue,maxHeight:xe}},cs=(t,s)=>{if(s.remarks&&s.remarks.length>0){ie.current&&clearTimeout(ie.current);const n=t.currentTarget.getBoundingClientRect(),l=tt(n);Me(l),xt(s._id),ie.current=setTimeout(()=>{pt(!0)},150)}},fa=()=>{ie.current&&(clearTimeout(ie.current),ie.current=null),ie.current=setTimeout(()=>{xt(null),pt(!1)},100)},ya=(t,s)=>{de.current&&clearTimeout(de.current);const n=t.currentTarget.getBoundingClientRect(),l=tt(n);Me(l),ft(s._id),de.current=setTimeout(async()=>{if(ht(!0),!yt[s._id]){vt(!0);try{const o=await V.get(`${R}/ai/analyze-lead/${s._id}`,{withCredentials:!0});bt(y=>({...y,[s._id]:o.data.analysis}))}catch(o){console.error("AI Analysis Error:",o),bt(y=>({...y,[s._id]:"Could not load AI suggestions."}))}finally{vt(!1)}}},400)},at=()=>{de.current&&(clearTimeout(de.current),de.current=null),de.current=setTimeout(()=>{ft(null),ht(!1)},100)};r.useEffect(()=>{if(!Le)return;const t=()=>{const s=document.querySelector(`[data-row-id="${Le}"]`);if(s){const n=s.getBoundingClientRect(),l=tt(n);Me(l)}};return window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[Le]);const ms=t=>{const s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t);return ns(!s),s},us=t=>{const s=t.target.value;_t(s),ms(s)},Z=X.filter(t=>{var O,ee,Y,ue,xe,Ae,_e,Ee,lt,Fe;const s=((O=t.fullName)==null?void 0:O.toLowerCase().includes(g.toLowerCase()))||((ee=t.phone1)==null?void 0:ee.includes(g)),n=ae?t.status===ae:!0,l=W?t.leadStatus===W:!0,o=D?t.leadPotential===D:!0,y=se?t.campaign===se:!0;let p=!0;if(be&&Q){const H=((ue=(Y=t.assignedTo)==null?void 0:Y._id)==null?void 0:ue.toString())||((xe=t.assignedTo)==null?void 0:xe.toString());Q==="unassigned"?p=!H:p=H===Q}let b=!0;if(!be){const H=((_e=(Ae=t.assignedTo)==null?void 0:Ae._id)==null?void 0:_e.toString())||((Ee=t.assignedTo)==null?void 0:Ee.toString()),q=((lt=a==null?void 0:a.id)==null?void 0:lt.toString())||((Fe=a==null?void 0:a._id)==null?void 0:Fe.toString());(!H||H!==q)&&(b=!1)}let U=!0;if(C&&C.length>0){const H=new Date(t.createdAt);H.setHours(0,0,0,0);const q=t.followUpDate?new Date(t.followUpDate):null;if(q&&q.setHours(0,0,0,0),C.length===2){const h=new Date(C[0]),B=new Date(C[1]);h.setHours(0,0,0,0),B.setHours(0,0,0,0);const Ue=H>=h&&H<=B,Oe=q&&q>=h&&q<=B;U=Ue||Oe}else if(C.length===1){const h=new Date(C[0]);h.setHours(0,0,0,0);const B=H.getTime()===h.getTime(),Ue=q&&q.getTime()===h.getTime();U=B||Ue}}return s&&n&&l&&o&&y&&p&&b&&U}).sort((t,s)=>{const n=p=>({strongProspect:4,potentialProspect:3,weakProspect:2,notAProspect:1})[p]||0,l=p=>["converted","lost","notInterested"].includes(p)?2:1;if(c==="followup_latest"||c==="followup_oldest"){const p=t.followUpDate?new Date(t.followUpDate):null,b=s.followUpDate?new Date(s.followUpDate):null;if(p&&p.setHours(0,0,0,0),b&&b.setHours(0,0,0,0),(p==null?void 0:p.getTime())!==(b==null?void 0:b.getTime()))return!p&&!b?0:p?b?c==="followup_latest"?p-b:b-p:-1:1;const U=l(t.leadStatus),O=l(s.leadStatus);if(U!==O)return U-O;const ee=n(t.leadPotential),Y=n(s.leadPotential);return ee!==Y?Y-ee:new Date(s.createdAt)-new Date(t.createdAt)}const o=new Date(t.createdAt),y=new Date(s.createdAt);return c==="asc"?o-y:y-o}),ba=r.useMemo(()=>{const t={};return Z.filter(n=>{if(!C||C.length===0)return!0;const l=new Date(n.createdAt);if(l.setHours(0,0,0,0),C.length===2){const o=new Date(C[0]),y=new Date(C[1]);return o.setHours(0,0,0,0),y.setHours(0,0,0,0),l>=o&&l<=y}else if(C.length===1){const o=new Date(C[0]);return o.setHours(0,0,0,0),l.getTime()===o.getTime()}return!0}).forEach(n=>{let l=n.contactPoint||"Not Specified";l&&l!=="Not Specified"&&(l=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()),t[l]=(t[l]||0)+1}),Object.entries(t).sort((n,l)=>l[1]-n[1]).reduce((n,[l,o])=>(n[l]=o,n),{})},[Z,C]),ja=t=>{Pe(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},xs=t=>{t.target.checked?Pe(Z.map(s=>s._id)):Pe([])},ps=async()=>{await Bs(E,X,v)},st=async t=>{if(t.remarks&&t.remarks.length>0){const n=t.remarks.map((l,o)=>({remark:l,index:o})).filter(({remark:l})=>l.isUnread);for(const{index:l}of n)try{await Gs(t._id,l)}catch(o){console.error("Error marking remark as read:",o)}n.length>0&&z(l=>l.map(o=>{if(o._id===t._id){const y=[...o.remarks];return n.forEach(({index:p})=>{y[p].isUnread=!1}),{...o,remarks:y}}return o}))}Ws(t,{setSelectedRow:I,setEditName:kt,setEditPhone:wt,setEditEmail:Ct,setEditStatus:St,setEditFollowUp:Pt,setFullName:Lt,setEmail:_t,setPhone1:Rt,setPhone2:Bt,setGender:Wt,setDob:Ft,setPlace:Ot,setOtherPlace:zt,setStatus:$t,setEducation:Kt,setOtherEducation:Xt,setContactPoint:Zt,setOtherContactPoint:Qt,setCampaign:Xe,setHandledByPerson:os,setFollowUpDate:Je,setRemarks:Ge,setLeadStatus:sa,setLeadPotential:ra,setSelectedValues:aa,courseOptions:he,contactPointOptions:P}),Xa()},va=t=>{if(!ga){v.error("Only managers and admins can delete leads.",{position:"top-center",autoClose:3e3});return}I(t),Ja()},Na=t=>{I(t),es()},hs=async()=>{if(!me){v.error("Lead Status is required");return}if(!Qe){v.error("Lead Potential is required");return}if(me!=="converted"&&me!=="lost"&&!Ze){v.error("Next Follow Up Date is required");return}if(!Ke.trim()){v.error("Remarks are required");return}ye(!0);try{await Ys(f,Ke,me,Qe,Dt,Mt,Ht,At,Vt,Et,Ut,Tt,It,qt,Gt,ce,Jt,ea,me==="converted"||me==="lost"?null:Ze,ta,a,ls,Ce,d,u,x,()=>dt(z,ne),I,Ge,m,N)}finally{ye(!1)}},gs=async()=>{await qs(f,ga,Ve,$e,z,m,N,v)},fs=async()=>{await Ks(f,We,$e,d,v)},ys=t=>{t==="__add_new__"?as():Xe(t)},bs=async()=>{await Vs(na,oa,da,ma,xa,Xe,()=>Va(L,Ma,a),Ye,la,ia,ca,ua,pa,v)},$e=()=>{I(null),kt(""),wt(""),Ct(""),St(""),Pt("")},[js,ka]=r.useState(!1),[rt,wa]=r.useState(""),[Ca,Sa]=r.useState(""),Pa=t=>{I(t),ka(!0),t.brand?Ie(t.brand._id||t.brand):Ie()},nt=()=>{ka(!1),wa(""),Sa("")},vs=async()=>{try{const s=(await V.get(`${R}/course-categories/all`,{withCredentials:!0})).data.categories.filter(n=>n.isActive).map(n=>({value:n.name,label:n.name}));le(s)}catch(t){console.error("Error fetching course categories:",t),le([{value:"General",label:"General"}])}},Ns=async()=>{var t,s;if(!rt){v.error("Please select a user to assign the lead to");return}try{const n=await V.put(`${R}/customers/assign/${f._id}`,{assignedTo:rt,assignmentRemark:Ca},{withCredentials:!0});n.data.customer&&(z(l=>l.map(o=>o._id===f._id?n.data.customer:o)),v.success("Lead assigned successfully!"),nt(),typeof m=="function"&&m({type:"lead_assigned",userName:(a==null?void 0:a.fullName)||"Someone",avatar:(a==null?void 0:a.avatar)||null,action:"assigned lead",entityName:f.fullName,module:"Lead Management"}))}catch(n){console.error("Error assigning lead:",n),v.error(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to assign lead")}};return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6",children:[ve?e.jsx(Ps,{className:"py-20"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between border-b border-gray-100 dark:border-gray-800 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Enquiries"}),et&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Showing only leads assigned to you"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[E.length>0&&e.jsxs("p",{className:"text-xs text-brand-500 font-medium",children:[E.length," lead(s) selected"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Total: ",Z.length," records"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-800/60",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Lead Potential:"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Strong"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Potential"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Weak"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Not a prospect"})]})]}),Object.keys(ba).length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-800/60",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"This Month:"}),Object.entries(ba).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[t,":"]}),e.jsx("span",{className:"text-xs font-semibold text-brand-600 dark:text-brand-400",children:s})]},t))]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"w-full sm:w-56",children:e.jsx(zs,{id:"leadDateFilter",value:C,onChange:t=>fe(t),placeholder:"Filter by date range"})}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>je(!re),startIcon:re?e.jsx(Rs,{className:"size-5"}):e.jsx(Ms,{className:"size-5"}),children:re?"Hide Filters":"Show Filters"}),e.jsx(j,{size:"sm",variant:"outline",onClick:rs,startIcon:e.jsx($s,{className:"size-5"}),children:"Import"}),e.jsx(j,{size:"sm",variant:"outline",onClick:ps,endIcon:e.jsx(Ea,{className:"size-5"}),disabled:E.length===0,children:"PDF"})]})]}),re&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-gray-50/50 dark:bg-white/[0.02] p-4 rounded-xl border border-gray-100 dark:border-gray-800 transition-all duration-300",children:[e.jsx(te,{type:"text",placeholder:"Search by name or phone...",value:g,onChange:t=>_(t.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"}),e.jsx($,{options:Ds,value:c,placeholder:"Sort by date",onChange:t=>T(t)}),e.jsx($,{options:[{value:"",label:"All Lead Statuses"},...Fa],value:W,placeholder:"Filter by lead status",onChange:t=>J(t)}),e.jsx($,{options:[{value:"",label:"All Lead Potentials"},...Ua],value:D,placeholder:"Filter by lead potential",onChange:t=>K(t)}),e.jsx($,{options:[{value:"",label:"All Campaigns"},...k],value:se,placeholder:"Filter by campaign",onChange:t=>S(t)}),be&&e.jsx($,{options:[{value:"",label:"All Users"},{value:"unassigned",label:"Unassigned"},...De.map(t=>({value:t._id,label:t.fullName}))],value:Q,placeholder:"Filter by assigned user",onChange:t=>G(t)})]})]}),e.jsx("div",{className:"hidden md:block max-w-full overflow-x-auto",children:e.jsxs(Ls,{children:[e.jsx(As,{className:"border-gray-100 dark:border-gray-800 border-y",children:e.jsxs(ot,{children:[e.jsx(A,{isHeader:!0,className:"py-3 pl-8 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:Z.length>0&&E.length===Z.length,onChange:xs,className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx("div",{className:"size-6 invisible shrink-0"})]})}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Name"}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Date Added"}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Contact Point"}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Campaign"}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Status & Remark"}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Next Follow-up"}),e.jsx(A,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Actions"})]})}),e.jsx(_s,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:Z.length===0?e.jsx(ot,{children:e.jsx(A,{colSpan:10,className:"py-8 text-center text-gray-500",children:et?"No leads assigned to you.":"No leads found. Create your first lead!"})}):Z.map(t=>{var o,y,p,b,U;const s=Ha(t.remarks),n=Ba(t.remarks),l=Wa(t.leadPotential);return e.jsxs(ot,{className:"group overflow-hidden transition-colors even:bg-gray-50/40 even:dark:bg-white/[0.01] hover:bg-gray-50/50 dark:hover:bg-white/[0.02]",children:[e.jsxs(A,{className:"py-4 pl-8 relative",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-[6px] ${l.bar}`}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:E.includes(t._id),onChange:()=>ja(t._id),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),n?e.jsx("div",{className:"size-5 shrink-0 rounded-full bg-red-600 flex items-center justify-center shadow-md",title:"New Remark",children:e.jsx(ze,{className:"size-3.5 text-white"})}):e.jsx("div",{className:"size-6 invisible shrink-0"})]})]}),e.jsx(A,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col min-w-0 cursor-help",onMouseEnter:O=>ya(O,t),onMouseLeave:at,children:[e.jsx("p",{className:"font-semibold text-gray-800 text-theme-sm dark:text-white/90 truncate group-hover/name:text-brand-500 transition-colors",children:t.fullName}),e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:((o=t.coursePreference)==null?void 0:o.join(", "))||"N/A"}),e.jsx("a",{href:`tel:${t.phone1}`,className:"text-brand-500 hover:underline text-[12px] font-medium mt-0.5",children:t.phone1})]})}),e.jsx(A,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{children:Se(t.createdAt)}),e.jsxs("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:["By: ",((y=t.createdBy)==null?void 0:y.fullName)||t.handledBy||"N/A"]})]})}),e.jsx(A,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{children:t.contactPoint||"N/A"}),(((p=t.contactPoint)==null?void 0:p.toLowerCase())==="other"||((b=t.contactPoint)==null?void 0:b.toLowerCase())==="reference"||((U=t.contactPoint)==null?void 0:U.toLowerCase())==="referance")&&t.otherContactPoint&&e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[150px]",children:t.otherContactPoint})]})}),e.jsx(A,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:t.campaign||"N/A"}),e.jsx(A,{className:"py-3",children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(we,{size:"sm",color:it(t.leadStatus),children:Ce(t.leadStatus)})}),e.jsxs("div",{className:"relative group/remark","data-row-id":t._id,onMouseEnter:O=>cs(O,t),onMouseLeave:fa,children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 max-w-[180px] truncate cursor-help leading-relaxed",children:s||"No remarks yet"}),t.assignmentRemark&&e.jsxs("p",{className:"text-[10px] text-red-500 dark:text-red-400 mt-0.5 truncate animate-pulse duration-100",children:["Suggestion: ",t.assignmentRemark]})]})]})}),e.jsx(A,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx(we,{size:"sm",color:Ya(t.followUpDate),children:qa(t.followUpDate)}),t.assignedTo&&e.jsxs("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:["Assigned To: ",t.assignedTo.fullName]})]})}),e.jsx(A,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{size:"sm",variant:"outline",className:"mr-2",endIcon:e.jsx(Ta,{className:"size-5"}),onClick:()=>st(t)}),Oa(a)&&e.jsx(j,{size:"sm",variant:"outline",className:"text-red-500 mr-2",endIcon:e.jsx(za,{className:"size-5"}),onClick:()=>va(t)}),be&&e.jsx(j,{size:"sm",variant:"outline",className:"text-blue-500 mr-2",onClick:()=>Pa(t),children:"Assign"}),e.jsx(j,{size:"sm",variant:"outline",className:"text-yellow-500",title:"Follow-up Alarm",endIcon:e.jsx(ze,{className:"size-5"}),onClick:()=>Na(t)})]})})]},t._id)})})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:hidden",children:Z.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500 bg-white dark:bg-white/[0.03] rounded-xl border border-gray-100 dark:border-gray-800",children:et?"No leads assigned to you.":"No leads found."}):Z.map(t=>{var o,y;const s=Ha(t.remarks),n=Wa(t.leadPotential),l=Ba(t.remarks);return e.jsxs("div",{className:"relative overflow-hidden bg-white dark:bg-white/[0.03] border border-gray-100 dark:border-gray-800 rounded-xl p-4 shadow-sm",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-[4px] ${n.bar}`}),e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:E.includes(t._id),onChange:()=>ja(t._id),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsxs("div",{className:"cursor-help",onMouseEnter:p=>ya(p,t),onMouseLeave:at,children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white/90",children:t.fullName}),e.jsx("a",{href:`tel:${t.phone1}`,className:"text-brand-500 text-sm font-medium hover:underline",children:t.phone1})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(we,{size:"sm",color:it(t.leadStatus),children:Ce(t.leadStatus)}),l&&e.jsx("div",{className:"size-5 rounded-full bg-red-600 flex items-center justify-center shadow-sm",children:e.jsx(ze,{className:"size-3 text-white"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Course Preference:"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200 text-right max-w-[150px] truncate",children:((o=t.coursePreference)==null?void 0:o.join(", "))||"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Added:"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-200",children:[Se(t.createdAt)," by ",((y=t.createdBy)==null?void 0:y.fullName)||t.handledBy||"N/A"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Next Follow-up:"}),e.jsx(we,{size:"sm",color:Ya(t.followUpDate),children:qa(t.followUpDate)})]}),t.assignedTo&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Assigned To:"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200 font-medium",children:t.assignedTo.fullName})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Latest Remark:"}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 line-clamp-2",children:s||"No remarks yet"}),t.assignmentRemark&&e.jsxs("p",{className:"text-[10px] text-red-500 dark:text-red-400 mt-2 font-medium",children:["Suggestion: ",t.assignmentRemark]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-3 border-t border-gray-100 dark:border-gray-800",children:[e.jsx(j,{size:"sm",variant:"outline",className:"p-2",onClick:()=>Na(t),children:e.jsx(ze,{className:"size-5 text-yellow-500"})}),be&&e.jsx(j,{size:"sm",variant:"outline",className:"text-blue-500 px-3",onClick:()=>Pa(t),children:"Assign"}),Oa(a)&&e.jsx(j,{size:"sm",variant:"outline",className:"p-2 text-red-500",onClick:()=>va(t),children:e.jsx(za,{className:"size-5"})}),e.jsxs(j,{size:"sm",variant:"primary",className:"px-3",onClick:()=>st(t),children:[e.jsx(Ta,{className:"size-4 mr-2"})," Edit"]})]})]},t._id)})}),Le&&Re&&_a.createPortal((()=>{const t=Z.find(n=>n._id===Le);if(!t||!t.remarks||t.remarks.length===0)return null;const s=F.transform.includes("-100%")||F.transform==="translateY(-10px)";return e.jsxs("div",{ref:Nt,className:`fixed w-96 max-w-[90vw] bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 z-[100000] transition-all duration-200 ${Re?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{top:`${F.top}px`,left:`${F.left}px`,maxHeight:`${F.maxHeight}px`,transform:`${F.transform} ${Re?"scale(1)":"scale(0.95)"}`},onMouseEnter:()=>{ie.current&&clearTimeout(ie.current)},onMouseLeave:fa,children:[F.arrowLeft>0&&e.jsx("div",{className:`absolute ${s?"bottom-0":"top-0"} left-0 w-0 h-0`,style:{left:`${F.arrowLeft}px`,transform:s?"translateY(100%) translateX(-50%)":"translateY(-100%) translateX(-50%)"},children:e.jsx("div",{className:`w-0 h-0 border-l-[8px] border-r-[8px] ${s?"border-t-[8px] border-t-white dark:border-t-gray-800 border-l-transparent border-r-transparent":"border-b-[8px] border-b-white dark:border-b-gray-800 border-l-transparent border-r-transparent"}`,style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"}})}),e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10 rounded-t-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:"Remark History"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t.remarks.length," remark",t.remarks.length!==1?"s":""]})]}),e.jsx("div",{className:"overflow-y-auto p-3 space-y-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-700 hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-gray-600",style:{maxHeight:`${F.maxHeight-60}px`},children:[...t.remarks].reverse().map((n,l)=>e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-900 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-800 dark:text-white",children:n.handledBy||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.updatedOn?new Date(n.updatedOn).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{size:"sm",color:it(n.leadStatus||"new"),children:Ce(n.leadStatus||"new")}),n.isUnread&&e.jsx("span",{className:"text-xs text-red-500 dark:text-red-400",children:"Unread"})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words",children:n.remark||"No remarks"}),n.nextFollowUpDate&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:["Next Follow-up: ",new Date(n.nextFollowUpDate).toLocaleDateString()]})]},l))})]})})(),document.body),gt&&He&&_a.createPortal((()=>{const t=F.transform.includes("-100%")||F.transform==="translateY(-10px)";return e.jsxs("div",{ref:Nt,className:`fixed w-80 max-w-[90vw] bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-blue-200 dark:border-blue-900/50 z-[100000] transition-all duration-200 ${He?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{top:`${F.top}px`,left:`${F.left}px`,transform:`${F.transform} ${He?"scale(1)":"scale(0.95)"}`},onMouseEnter:()=>{de.current&&clearTimeout(de.current)},onMouseLeave:at,children:[F.arrowLeft>0&&e.jsx("div",{className:`absolute ${t?"bottom-0":"top-0"} left-0 w-0 h-0`,style:{left:`${F.arrowLeft}px`,transform:t?"translateY(100%) translateX(-50%)":"translateY(-100%) translateX(-50%)"},children:e.jsx("div",{className:`w-0 h-0 border-l-[8px] border-r-[8px] ${t?"border-t-[8px] border-t-white dark:border-t-gray-800 border-l-transparent border-r-transparent":"border-b-[8px] border-b-white dark:border-b-gray-800 border-l-transparent border-r-transparent"}`})}),e.jsx("div",{className:"p-3 border-b border-blue-50 dark:border-blue-900/30 bg-blue-50/50 dark:bg-blue-900/20 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"size-4 text-blue-500"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:"Lead Analysis - CDC AI"}),jt&&e.jsx("div",{className:"size-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin ml-auto"})]})}),e.jsxs("div",{className:"p-4",children:[jt?e.jsxs("div",{className:"space-y-2 animate-pulse",children:[e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-4/6"})]}):e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed italic",children:['"',yt[gt]||"Loading suggestion...",'"']}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-3 text-right",children:"System suggestion"})]})]})})(),document.body),e.jsxs(ke,{isOpen:Ga,onClose:Be,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[1480px] p-6 lg:p-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"mb-2 font-semibold text-gray-800 dark:text-white/90 modal-title text-theme-xl lg:text-2xl",children:"Edit Lead"}),e.jsx("button",{onClick:Be,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(te,{type:"text",id:"firstName",value:Dt,onChange:t=>Lt(t.target.value),disabled:!Ne(a)&&!M(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Email"}),e.jsx(te,{type:"email",value:At,error:Yt,onChange:us,placeholder:"Enter email",hint:Yt?"This is an invalid email address.":"",disabled:!Ne(a)&&!M(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Phone *"}),e.jsx(Ia,{selectPosition:"end",countries:$a,placeholder:"+91 98765 43210",value:Mt,onChange:Rt,disabled:!Ne(a)&&!M(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Phone (optional)"}),e.jsx(Ia,{selectPosition:"end",countries:$a,placeholder:"+91 98765 43210",value:Ht,onChange:Bt})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Gender"}),e.jsx($,{options:Es,value:Vt,placeholder:"Select Gender",onChange:Wt})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Ra,{id:"dob",label:"DoB",placeholder:"Select a date",value:Et,onChange:(t,s)=>Ft(s)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Place *"}),e.jsx($,{options:ct,value:Ut,placeholder:"Select Place",onChange:Ot})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(te,{type:"text",id:"otherPlace",value:Tt,onChange:t=>zt(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Current Status"}),e.jsx($,{options:Fs,value:It,placeholder:"Select Status",onChange:$t})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Education *"}),e.jsx($,{options:mt,value:qt,placeholder:"Select Education",onChange:Kt})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(te,{type:"text",id:"otherEducation",value:Gt,onChange:t=>Xt(t.target.value)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Contact Point"}),e.jsx($,{options:M(a)?P:P.filter(t=>t.value!=="__add_new__"),value:ce,onChange:Zt,disabled:!M(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{htmlFor:"otherContactPoint",children:"Specify other"}),e.jsx(te,{type:"text",id:"otherContactPoint",value:Jt,onChange:t=>Qt(t.target.value),disabled:ce!=="other"&&(ce==null?void 0:ce.toLowerCase())!=="reference"&&(ce==null?void 0:ce.toLowerCase())!=="referance"})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:e.jsx("div",{className:"w-full",children:e.jsx(Us,{label:"Course Preference",options:he,selectedValues:ta,onChange:aa})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Campaign"}),e.jsx($,{options:k,value:ea,placeholder:"Campaigns",onChange:ys,disabled:!M(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Lead Status *"}),e.jsx($,{id:"leadStatus",label:"Lead Status",options:Fa,value:me,onChange:t=>{sa(t),(t==="converted"||t==="lost")&&Je("")},required:!0})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(w,{children:"Lead Potential *"}),e.jsx($,{options:Ua,value:Qe,placeholder:"Select Lead Potential",onChange:ra})]}),me!=="converted"&&me!=="lost"&&e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Ra,{id:"followupDate",label:"Next Follow Up Date *",value:Ze,disablePastDates:!0,onChange:(t,s)=>Je(s)})})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:e.jsxs("div",{className:"w-full",children:[e.jsx(w,{htmlFor:"remarks",children:"Remarks *"}),e.jsx(te,{type:"text",id:"remarks",value:Ke,onChange:t=>Ge(t.target.value)})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(j,{variant:"outline",onClick:Be,children:"Cancel"}),e.jsx(j,{variant:"primary",onClick:hs,loading:ha,children:"Update"})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(Os,{title:"History & Remarks",children:e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-700 hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-gray-600",children:f!=null&&f.remarks&&f.remarks.length>0?[...f.remarks].reverse().map((t,s)=>e.jsx(Hs,{name:t.handledBy||(a==null?void 0:a.fullName)||"Unknown",datetime:t.updatedOn?new Date(t.updatedOn).toLocaleString():"N/A",callback:t.nextFollowUpDate?new Date(t.nextFollowUpDate).toLocaleDateString():"",note:t.remark||"No remarks",status:Ce(t.leadStatus||"new")},s)):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"No history available yet."}),e.jsx("p",{className:"text-sm mt-2",children:"Remarks and updates will appear here."})]})})})})]})]}),e.jsxs(ke,{isOpen:Za,onClose:Ve,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[700px] p-6 lg:p-10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Confirm Delete"}),e.jsxs("p",{children:["Are you sure you want to delete enquiry ",e.jsx("strong",{children:f==null?void 0:f.name}),"?"]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>{Ve(),$e()},children:" Cancel"}),e.jsx(j,{variant:"danger",onClick:gs,children:"Delete"})]})]}),e.jsxs(ke,{isOpen:Qa,onClose:We,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[700px] p-6 lg:p-10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Set Follow-up Reminder"}),e.jsxs("p",{children:["Set a reminder for ",e.jsx("strong",{children:f==null?void 0:f.fullName})," on ",f?Se(f.followUpDate):"","."]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>{We(),$e()},children:"Close"}),e.jsx(j,{variant:"warning",onClick:fs,children:"Set Reminder"})]})]}),e.jsxs(ke,{isOpen:ts,onClose:Ye,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(te,{id:"newCampaignName",type:"text",value:na,onChange:t=>la(t.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:oa,onChange:t=>ia(t.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 shadow-theme-xs"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(te,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:da,onChange:t=>ca(t.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{htmlFor:"newCampaignCashback",children:"Cashback (₹)"}),e.jsx(te,{id:"newCampaignCashback",type:"number",min:"0",value:ma,onChange:t=>ua(t.target.value),placeholder:"0"})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:xa,onChange:t=>pa(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(w,{htmlFor:"newCampaignActive",className:"mb-0",children:"Active"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(j,{variant:"outline",onClick:Ye,children:"Cancel"}),e.jsx(j,{variant:"primary",onClick:bs,children:"Create Campaign"})]})]})]}),e.jsxs(ke,{isOpen:ss,onClose:qe,className:"max-w-xl p-0 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90",children:"Import Leads"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Upload a CSV file to bulk import your leads into the system."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-brand-50/50 dark:bg-brand-500/5 p-4 rounded-xl border border-brand-100 dark:border-brand-500/20 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-brand-700 dark:text-brand-400",children:"Step 1: Get the template"}),e.jsx("p",{className:"text-xs text-brand-600/80 dark:text-brand-400/60 mt-0.5",children:"Use our CSV template to ensure correct data formatting."})]}),e.jsx(j,{size:"sm",variant:"outline",className:"bg-white dark:bg-gray-900",onClick:()=>{const n="data:text/csv;charset=utf-8,"+[["Full Name","Phone","Email","Place","Education","Course Preference","Contact Point","Campaign","Next Follow Up Date","Remarks","Lead Potential"],...[["John Doe","9876543210","john@example.com","New York","Bachelor's","Python;Java","Website","Summer 2024","2024-07-15","Interested in backend","strongProspect"],["Jane Smith","9123456789","jane@test.com","London","Master's","AWS","LinkedIn","Winter Sale","2024-07-20","Wants to switch career","potentialProspect"]]].map(y=>y.join(",")).join(`
`),l=encodeURI(n),o=document.createElement("a");o.setAttribute("href",l),o.setAttribute("download","lead_import_template.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},children:"Download Sample"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Step 2: Upload your file"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-2xl p-10 flex flex-col items-center justify-center text-center hover:border-brand-300 dark:hover:border-brand-800 transition-colors cursor-pointer group",onClick:()=>document.getElementById("csv-upload").click(),children:[e.jsx("div",{className:"size-12 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center mb-4 group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10 transition-colors",children:e.jsx(Ea,{className:"size-6 text-gray-400 group-hover:text-brand-500 rotate-180"})}),e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Only CSV files are supported (max 5MB)"}),e.jsx("input",{type:"file",id:"csv-upload",className:"hidden",accept:".csv",onChange:t=>{const s=t.target.files[0];if(s){if(s.type!=="text/csv"&&!s.name.endsWith(".csv")){v.error("Please upload a valid CSV file");return}v.info(`Processing ${s.name}...`)}}})]})]}),e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-white/[0.02] rounded-xl border border-gray-100 dark:border-gray-800",children:[e.jsx("div",{className:"size-5 rounded-full bg-blue-500 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[10px] text-white font-bold",children:"i"})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Ensure dates are in YYYY-MM-DD format."}),e.jsx("li",{children:'"Full Name" and "Phone" are required fields.'}),e.jsx("li",{children:'"Course Preference" can be multiple items separated by semi-colons.'})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-white/[0.02] border-t border-gray-100 dark:border-gray-800 flex items-center justify-end gap-3",children:[e.jsx(j,{variant:"outline",onClick:qe,children:"Cancel"}),e.jsx(j,{variant:"primary",loading:ha,onClick:()=>{const t=document.getElementById("csv-upload");if(t.files.length===0){v.error("Please select a file first");return}ye(!0);const s=t.files[0];Is.parse(s,{header:!0,skipEmptyLines:!0,complete:async n=>{var H,q;const l=(h,B)=>{if(!h)return null;const Ue=h.map(Oe=>Oe.toLowerCase().trim());for(const Oe of B){const La=Ue.indexOf(Oe.toLowerCase());if(La!==-1)return h[La]}return null},o=n.meta.fields||[];console.log("Details found in CSV:",o);const y=l(o,["Full Name","Name","Student Name","Lead Name","Enquiry Name"]),p=l(o,["Phone","Phone Number","Mobile","Contact","Phone 1","Contact Number"]),b=l(o,["Email","Email Address","Email ID"]),U=l(o,["Place","City","Location","Address"]),O=l(o,["Education","Qualification"]),ee=l(o,["Course Preference","Course","Interest","Subject"]),Y=l(o,["Contact Point","Source"]),ue=l(o,["Campaign"]),xe=l(o,["Next Follow Up Date","Follow Up Date","Follow Up","Date"]),Ae=l(o,["Remarks","Note","Comment"]),_e=l(o,["Lead Potential","Potential","Status"]),Ee=l(o,["Date Created","Created At","Creation Date","Date Added"]);if(!y||!p){console.error("Missing headers. Found:",o),v.error(`Missing required columns! Found: ${o.join(", ")}. Need at least 'Name' and 'Phone'.`,{autoClose:1e4}),ye(!1);return}const Fe=n.data.map(h=>({fullName:h[y],phone1:h[p],email:b?h[b]:"",place:U?h[U]:"",education:O?h[O]:"Other",coursePreference:ee?h[ee]:"",contactPoint:Y?h[Y]:"Other",campaign:ue?h[ue]:"",nextFollowUpDate:xe?h[xe]:"",remarks:Ae?h[Ae]:"",leadStatus:"new",leadPotential:_e&&h[_e]||"potentialProspect",createdAt:Ee?h[Ee]:null})).filter(h=>h.fullName&&h.phone1);if(Fe.length===0){v.error("No valid leads found in file. Check Name and Phone columns."),ye(!1);return}try{const h=await V.post(`${R}/customers/import-leads`,{leads:Fe},{withCredentials:!0}),{summary:B}=h.data;B.success>0&&(v.success(`Successfully imported ${B.success} leads!`),dt(z,ne)),B.failed>0&&(v.warn(`${B.failed} leads failed to import. Check console for details.`),console.warn("Import Errors:",B.errors)),qe()}catch(h){console.error("Import failed:",h),v.error(((q=(H=h.response)==null?void 0:H.data)==null?void 0:q.message)||"Import failed. Please try again.")}finally{ye(!1)}},error:n=>{console.error("CSV Parse Error:",n),v.error("Failed to parse CSV file."),ye(!1)}})},children:"Confirm Import"})]})]}),e.jsxs(ke,{isOpen:js,onClose:nt,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Assign Lead"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"assignToUser",children:"Assign To"}),e.jsx($,{options:De.map(t=>({value:t._id,label:t.fullName})),value:rt,placeholder:"Select User",onChange:wa})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"assignmentRemark",children:"Assignment Remark (Optional)"}),e.jsx("textarea",{id:"assignmentRemark",value:Ca,onChange:t=>Sa(t.target.value),placeholder:"Add a remark for the assignment...",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(j,{variant:"outline",onClick:nt,children:"Cancel"}),e.jsx(j,{onClick:Ns,children:"Assign Lead"})]})]})]})]}),e.jsx(Ts,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{cr as R};
