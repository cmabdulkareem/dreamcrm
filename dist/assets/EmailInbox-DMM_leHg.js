import{r as a,w as H,b as m,c as x,y as o,j as e,P as ke,E as we,C as ee,B as n,F as se,G as Ee,M as O,x as r,I as d,H as te,n as Se}from"./index-BNEGGE57.js";function Ae(){const[f,N]=a.useState([]),[h,ae]=a.useState(null),[W,re]=a.useState([]),[i,D]=a.useState(""),[G,J]=a.useState(!1),{isOpen:le,openModal:oe,closeModal:R}=H(),{isOpen:de,openModal:ie,closeModal:T}=H(),{isOpen:ce,openModal:ne,closeModal:me}=H(),{isOpen:xe,openModal:he,closeModal:_}=H(),[p,C]=a.useState(""),[u,k]=a.useState(""),[g,w]=a.useState(""),[j,E]=a.useState("imap"),[y,S]=a.useState(""),[P,A]=a.useState("993"),[v,M]=a.useState(""),[F,I]=a.useState("465"),[B,K]=a.useState(""),[z,Q]=a.useState(""),[U,V]=a.useState(""),[pe,L]=a.useState(null);a.useEffect(()=>{$()},[]),a.useEffect(()=>{i&&X()},[i]);const $=async()=>{var s;try{const t=await m.get(`${x}/email/accounts`,{withCredentials:!0});re(t.data.accounts||[]),((s=t.data.accounts)==null?void 0:s.length)>0&&!i&&D(t.data.accounts[0]._id)}catch(t){console.error("Error fetching email accounts:",t)}},X=async()=>{if(i){J(!0);try{const s=await m.get(`${x}/email/fetch/${i}`,{withCredentials:!0});N(s.data.emails||[])}catch(s){console.error("Error fetching emails:",s),o.error("Failed to fetch emails")}finally{J(!1)}}},ue=async()=>{var s,t;if(!p||!u||!g||!y||!v){o.error("Please fill all required fields");return}try{await m.post(`${x}/email/accounts/add`,{name:p,email:u,password:g,protocol:j,imapHost:y,imapPort:parseInt(P),smtpHost:v,smtpPort:parseInt(F)},{withCredentials:!0}),o.success("Email account added successfully!"),R(),q(),$()}catch(l){console.error("Error adding email account:",l),o.error(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to add email account")}},ge=async()=>{if(!B||!z||!U){o.error("Please fill all fields");return}try{await m.post(`${x}/email/send`,{accountId:i,to:B,subject:z,body:U},{withCredentials:!0}),o.success("Email sent successfully!"),T(),Ce()}catch(s){console.error("Error sending email:",s),o.error("Failed to send email")}},je=s=>{ae(s),ne()},ye=async(s,t)=>{var l,b;if(t.stopPropagation(),!s.uid){o.error("Cannot mark email as read - missing UID");return}try{await m.post(`${x}/email/mark-read/${i}/${s.uid}`,{},{withCredentials:!0}),N(f.map(c=>c.uid===s.uid?{...c,isRead:!0}:c)),o.success("Marked as read")}catch(c){console.error("Error marking as read:",c),o.error(((b=(l=c.response)==null?void 0:l.data)==null?void 0:b.message)||"Failed to mark as read")}},ve=async(s,t)=>{var l,b;if(t.stopPropagation(),!s.uid){o.error("Cannot delete email - missing UID");return}try{await m.delete(`${x}/email/delete/${i}/${s.uid}`,{withCredentials:!0}),N(f.filter(c=>c.uid!==s.uid)),o.success("Email deleted successfully")}catch(c){console.error("Error deleting email:",c),o.error(((b=(l=c.response)==null?void 0:l.data)==null?void 0:b.message)||"Failed to delete email")}},be=s=>{L(s._id),C(s.name),k(s.email),w(""),E(s.protocol),S(s.imapHost),A(s.imapPort.toString()),M(s.smtpHost),I(s.smtpPort.toString()),he()},fe=async()=>{var s,t;if(!p||!u||!y||!v){o.error("Please fill all required fields");return}try{const l={name:p,email:u,protocol:j,imapHost:y,imapPort:parseInt(P),smtpHost:v,smtpPort:parseInt(F)};g&&(l.password=g),await m.put(`${x}/email/accounts/${pe}`,l,{withCredentials:!0}),o.success("Email account updated successfully!"),_(),q(),L(null),$()}catch(l){console.error("Error updating email account:",l),o.error(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to update email account")}},Ne=async s=>{if(confirm("Are you sure you want to delete this email account?"))try{await m.delete(`${x}/email/accounts/${s}`,{withCredentials:!0}),o.success("Email account deleted successfully!"),i===s&&(D(""),N([])),$()}catch(t){console.error("Error deleting email account:",t),o.error("Failed to delete email account")}},q=()=>{C(""),k(""),w(""),E("imap"),S(""),A("993"),M(""),I("465")},Ce=()=>{K(""),Q(""),V("")},Y=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Z=[{value:"imap",label:"IMAP"},{value:"pop3",label:"POP3"}];return e.jsxs("div",{children:[e.jsx(ke,{title:"Email Inbox | DreamCRM",description:"Manage your emails"}),e.jsx(we,{pageTitle:"Email"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ee,{title:"Email Accounts",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{onClick:ie,className:"w-full",endIcon:e.jsx(se,{className:"size-4"}),children:"Compose Email"}),e.jsx(n,{onClick:oe,variant:"outline",className:"w-full",endIcon:e.jsx(se,{className:"size-4"}),children:"Add Account"}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Accounts"}),W.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No accounts added"}):e.jsx("div",{className:"space-y-2",children:W.map(s=>e.jsxs("div",{className:`group w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${i===s._id?"bg-brand-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[e.jsxs("div",{onClick:()=>D(s._id),className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium truncate",children:s.name}),e.jsx("div",{className:"text-xs opacity-80 truncate",children:s.email})]}),e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("button",{onClick:()=>be(s),className:`flex-1 px-2 py-1 text-xs rounded transition-colors cursor-pointer ${i===s._id?"bg-white/20 hover:bg-white/30 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"Edit"}),e.jsx("button",{onClick:()=>Ne(s._id),className:`flex-1 px-2 py-1 text-xs rounded transition-colors cursor-pointer ${i===s._id?"bg-red-500/80 hover:bg-red-600 text-white":"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50"}`,children:"Delete"})]})]},s._id))})]})]})})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(ee,{title:"Inbox",action:e.jsx(n,{size:"sm",variant:"outline",onClick:X,disabled:!i||G,endIcon:e.jsx(Ee,{className:"size-4"}),children:"Refresh"}),children:i?G?e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{children:"Loading emails..."})}):f.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{children:"No emails found"})}):e.jsx("div",{className:"space-y-2",children:f.map((s,t)=>e.jsx("div",{onClick:()=>je(s),className:`p-4 rounded-lg border cursor-pointer transition-colors ${s.isRead?"border-gray-200 dark:border-gray-700":"border-brand-300 bg-brand-50/50 dark:bg-brand-900/10 dark:border-brand-700"} hover:border-brand-500 hover:bg-gray-50 dark:hover:bg-gray-800/50`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[!s.isRead&&e.jsx("div",{className:"w-2 h-2 bg-brand-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`truncate ${s.isRead?"font-semibold text-gray-800 dark:text-white":"font-bold text-gray-900 dark:text-white"}`,children:s.subject||"(No Subject)"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate mt-1",children:["From: ",s.from]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-500",children:Y(s.date)}),e.jsxs("div",{className:"flex gap-1",children:[!s.isRead&&e.jsx("button",{onClick:l=>ye(s,l),className:"px-2 py-1 text-xs bg-brand-500 text-white rounded hover:bg-brand-600 transition-colors cursor-pointer",title:"Mark as read",children:"Mark Read"}),e.jsx("button",{onClick:l=>ve(s,l),className:"px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors cursor-pointer",title:"Delete email",children:"Delete"})]})]})]})},s.uid||t))}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{children:"Please select or add an email account to view emails"})})})})]}),e.jsxs(O,{isOpen:le,onClose:R,className:"max-w-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add Email Account"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"accountName",children:"Account Name *"}),e.jsx(d,{id:"accountName",type:"text",value:p,onChange:s=>C(s.target.value),placeholder:"e.g., Work Email"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"protocol",children:"Protocol *"}),e.jsx(te,{options:Z,value:j,onChange:E,placeholder:"Select Protocol"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"emailAddress",children:"Email Address *"}),e.jsx(d,{id:"emailAddress",type:"email",value:u,onChange:s=>k(s.target.value),placeholder:"your@email.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"password",children:"Password *"}),e.jsx(d,{id:"password",type:"password",value:g,onChange:s=>w(s.target.value),placeholder:"••••••••"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:["Incoming Mail Server (",j.toUpperCase(),")"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"imapHost",children:"Server Host *"}),e.jsx(d,{id:"imapHost",type:"text",value:y,onChange:s=>S(s.target.value),placeholder:"imap.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"imapPort",children:"Port *"}),e.jsx(d,{id:"imapPort",type:"number",value:P,onChange:s=>A(s.target.value),placeholder:"993"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Outgoing Mail Server (SMTP)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"smtpHost",children:"Server Host *"}),e.jsx(d,{id:"smtpHost",type:"text",value:v,onChange:s=>M(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"smtpPort",children:"Port *"}),e.jsx(d,{id:"smtpPort",type:"number",value:F,onChange:s=>I(s.target.value),placeholder:"465"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(n,{type:"button",variant:"outline",onClick:R,children:"Cancel"}),e.jsx(n,{type:"button",onClick:ue,children:"Add Account"})]})]})]}),e.jsxs(O,{isOpen:de,onClose:T,className:"max-w-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Compose Email"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"composeTo",children:"To *"}),e.jsx(d,{id:"composeTo",type:"email",value:B,onChange:s=>K(s.target.value),placeholder:"recipient@email.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"composeSubject",children:"Subject *"}),e.jsx(d,{id:"composeSubject",type:"text",value:z,onChange:s=>Q(s.target.value),placeholder:"Email subject"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"composeBody",children:"Message *"}),e.jsx("textarea",{id:"composeBody",value:U,onChange:s=>V(s.target.value),placeholder:"Type your message here...",rows:10,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(n,{type:"button",variant:"outline",onClick:T,children:"Cancel"}),e.jsx(n,{type:"button",onClick:ge,children:"Send Email"})]})]})]}),e.jsxs(O,{isOpen:xe,onClose:_,className:"max-w-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Edit Email Account"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editAccountName",children:"Account Name *"}),e.jsx(d,{id:"editAccountName",type:"text",value:p,onChange:s=>C(s.target.value),placeholder:"e.g., Work Email"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editProtocol",children:"Protocol *"}),e.jsx(te,{options:Z,value:j,onChange:E,placeholder:"Select Protocol"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editEmailAddress",children:"Email Address *"}),e.jsx(d,{id:"editEmailAddress",type:"email",value:u,onChange:s=>k(s.target.value),placeholder:"your@email.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editPassword",children:"Password (leave blank to keep current)"}),e.jsx(d,{id:"editPassword",type:"password",value:g,onChange:s=>w(s.target.value),placeholder:"••••••••"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:["Incoming Mail Server (",j.toUpperCase(),")"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editImapHost",children:"Server Host *"}),e.jsx(d,{id:"editImapHost",type:"text",value:y,onChange:s=>S(s.target.value),placeholder:"imap.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editImapPort",children:"Port *"}),e.jsx(d,{id:"editImapPort",type:"number",value:P,onChange:s=>A(s.target.value),placeholder:"993"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Outgoing Mail Server (SMTP)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editSmtpHost",children:"Server Host *"}),e.jsx(d,{id:"editSmtpHost",type:"text",value:v,onChange:s=>M(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editSmtpPort",children:"Port *"}),e.jsx(d,{id:"editSmtpPort",type:"number",value:F,onChange:s=>I(s.target.value),placeholder:"465"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>{_(),q(),L(null)},children:"Cancel"}),e.jsx(n,{type:"button",onClick:fe,children:"Update Account"})]})]})]}),e.jsx(O,{isOpen:ce,onClose:me,className:"max-w-3xl p-6",children:h&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90",children:h.subject||"(No Subject)"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["From: ",h.from]}),e.jsx("p",{children:Y(h.date)})]})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap max-h-96 overflow-y-auto",children:h.body||h.text||"(No content)"})})]})}),e.jsx(Se,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{Ae as default};
