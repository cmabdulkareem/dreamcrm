import{r as s,A as ta,F as sa,b as na,u as ra,x as Oe,c as h,d as p,h as S,U as la,V as ia,j as e,P as oa,G as ca,C as Ae,z as l,I as o,W as Fe,X as Me,K as u,Y as da,Z as ma,_ as ua,$ as ha,a0 as pa,a1 as xa,B as x,M as qe,o as ga,y as c}from"./index-BRRNp47y.js";import{D as Le}from"./date-picker-DxGeXKuS.js";import"./calender-line-CMLkAvQj.js";function va(){const{user:i}=s.useContext(ta),{addEvent:Re}=sa(),Ie=na(),{addNotification:Ge,areToastsEnabled:$e}=ra(),[j,U]=s.useState(!1),[g,k]=s.useState(""),[f,D]=s.useState(""),[N,V]=s.useState(""),[W,Z]=s.useState(""),[T,H]=s.useState(""),[K,J]=s.useState(""),[C,X]=s.useState("Kasaragod"),[P,Y]=s.useState(""),[Q,ee]=s.useState(""),[y,ae]=s.useState(""),[E,te]=s.useState(""),[_,se]=s.useState(["General"]),[d,O]=s.useState(""),[w,ne]=s.useState(""),[A,F]=s.useState(""),[M,re]=s.useState(""),[v,le]=s.useState(""),[q,ie]=s.useState(""),[oe,L]=s.useState(!1),[ze,ce]=s.useState([]),[Be,de]=s.useState([]),[Ue,me]=s.useState([]),[r,ue]=s.useState({}),{isOpen:Ve,openModal:We,closeModal:R}=Oe(),[I,he]=s.useState(""),[pe,xe]=s.useState(""),[G,ge]=s.useState(""),[$,fe]=s.useState(""),[Ce,we]=s.useState(!0),{isOpen:Ze,openModal:Te,closeModal:z}=Oe(),[B,ve]=s.useState(""),[je,Ne]=s.useState(""),[Pe,ye]=s.useState(!0);s.useEffect(()=>{const a=sessionStorage.getItem("prefillLeadData");if(a){const{fullName:t,email:n}=JSON.parse(a);k(t||""),D(n||""),sessionStorage.removeItem("prefillLeadData")}be(),Se(),He()},[]);const He=async()=>{try{const t=(await h.get(`${p}/course-categories/all`,{withCredentials:!0})).data.categories.filter(n=>n.isActive).map(n=>({value:n.name,label:n.name}));me(t)}catch(a){console.error("Error fetching course categories:",a),me([{value:"General",label:"General"}])}},be=async()=>{try{const t=(await h.get(`${p}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(n=>({value:n.value,label:n.name}));S(i)&&t.push({value:"__add_new__",label:"+ Add New Campaign"}),ce(t)}catch(a){console.error("Error fetching campaigns:",a);const t=[...la];S(i)&&t.push({value:"__add_new__",label:"+ Add New Campaign"}),ce(t)}},Se=async()=>{try{const t=(await h.get(`${p}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(n=>({value:n.value,label:n.name}));t.push({value:"other",label:"Other"}),S(i)&&t.push({value:"__add_new__",label:"+ Add New Contact Point"}),de(t)}catch(a){console.error("Error fetching contact points:",a);const t=[...ia];S(i)&&t.push({value:"__add_new__",label:"+ Add New Contact Point"}),de(t)}},ke=a=>{if(!a||!a.trim())return L(!1),!0;const t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a);return L(!t),t},Ke=a=>{const t=a.target.value;D(t),ke(t)},Je=a=>{a==="__add_new__"?We():F(a)},Xe=a=>{a==="__add_new__"?Te():O(a)},Ye=async()=>{var a,t;if(!I.trim()){c.error("Campaign name is required");return}try{const n=await h.post(`${p}/campaigns/create`,{name:I,description:pe,discountPercentage:G?parseFloat(G):0,cashback:$?parseFloat($):0,isActive:Ce},{withCredentials:!0});c.success("Campaign created successfully!"),F(n.data.campaign.value),await be(),R(),he(""),xe(""),ge(""),fe(""),we(!0)}catch(n){console.error("Error creating campaign:",n),c.error(((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create campaign")}},Qe=async()=>{var a,t;if(!B.trim()){c.error("Contact point name is required");return}try{const n=await h.post(`${p}/contact-points/create`,{name:B,description:je,isActive:Pe},{withCredentials:!0});c.success("Contact point created successfully!"),O(n.data.contactPoint.value),await Se(),z(),ve(""),Ne(""),ye(!0)}catch(n){console.error("Error creating contact point:",n),c.error(((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create contact point")}},ea=()=>{const a={};return g.trim()||(a.fullName="Full Name is required"),f.trim()&&!ke(f)&&(a.email="Please enter a valid email address"),N.trim()||(a.phone1="Phone is required"),C?C==="Other"&&!P.trim()&&(a.otherPlace="Please specify the place"):a.place="Place is required",y?y==="Other"&&!E.trim()&&(a.otherEducation="Please specify the education"):a.education="Education is required",_.length===0&&(a.coursePreference="Course preference is required"),d||(a.contactPoint="Contact point is required"),d==="other"&&!w.trim()&&(a.otherContactPoint="Please specify the contact point"),A||(a.campaign="Campaign is required"),v||(a.followUpDate="Next follow up date is required"),M.trim()||(a.leadRemarks="Remarks are required"),q||(a.leadPotential="Lead Potential is required"),ue(a),Object.keys(a).length===0},De=()=>{k(""),D(""),V(""),Z(""),H(""),J(""),X(""),Y(""),ee(""),ae(""),te(""),se(["General"]),O(""),ne(""),F(""),re(""),le(""),ie(""),L(!1),ue({})},aa=async a=>{var n,Ee,_e;if(a.preventDefault(),j)return;if(!ea()){c.error("Please fill in all required fields");return}U(!0);const t={fullName:g,email:f.trim()||null,phone1:N,phone2:W,gender:T,dob:K,place:C==="Other"?P:C,otherPlace:P,status:Q,education:y,otherEducation:E,coursePreference:_,contactPoint:d,otherContactPoint:d==="other"?w:"",campaign:A,handledBy:(i==null?void 0:i.fullName)||"Unknown",leadRemarks:M,followUpDate:v,leadPotential:q};try{const m=await h.post(`${p}/customers/create`,t,{withCredentials:!0});if(m.status===201){if(v)try{const b=v;Re({title:`Follow-up: ${g}`,start:b,end:b,allDay:!0,extendedProps:{calendar:"Warning",leadId:m.data.customer._id,phone:N,email:f,status:m.data.customer.leadStatus||"new"}})}catch(b){console.error("Error creating calendar event:",b)}Ge({type:"lead_created",userName:(i==null?void 0:i.fullName)||"Someone",avatar:(i==null?void 0:i.avatar)||null,action:"added new lead",entityName:g,module:"Lead Management"}),$e()&&c.success("Lead created successfully!",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),De(),Ie("/lead-management")}}catch(m){console.error("Error creating lead:",m),((n=m.response)==null?void 0:n.status)===401?c.error("Please login to create a lead."):c.error(((_e=(Ee=m.response)==null?void 0:Ee.data)==null?void 0:_e.message)||"Failed to create lead. Please try again.")}finally{U(!1)}};return e.jsxs("div",{children:[e.jsx(oa,{title:"New Lead | DreamCRM",description:"Add new enquiry here"}),e.jsx(ca,{pageTitle:"New Enquiry"}),e.jsxs("form",{onSubmit:aa,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(Ae,{title:"Basic Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(l,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(o,{type:"text",id:"firstName",value:g,onChange:a=>k(a.target.value),error:!!r.fullName,hint:r.fullName})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(l,{children:"Email"}),e.jsx(o,{type:"email",id:"new-lead-email",value:f,error:oe||!!r.email,onChange:Ke,placeholder:"Enter your email (optional)",hint:r.email||(oe?"This is an invalid email address.":"")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(l,{children:"Phone *"}),e.jsx(Fe,{id:"new-lead-phone",selectPosition:"end",countries:Me,placeholder:"+91 98765 43210",value:N,onChange:V,error:!!r.phone1,hint:r.phone1})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(l,{children:"Phone (optional)"}),e.jsx(Fe,{selectPosition:"end",countries:Me,placeholder:"+91 98765 43210",value:W,onChange:Z})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(l,{children:"Gender"}),e.jsx(u,{options:da,value:T,placeholder:"Select Gender",onChange:H})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Le,{id:"dob",label:"DoB",value:K,onChange:(a,t)=>J(t)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(l,{children:"Place *"}),e.jsx(u,{options:ma,value:C,placeholder:"Select Place",onChange:X,error:!!r.place,hint:r.place})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(l,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(o,{type:"text",id:"otherPlace",value:P,onChange:a=>Y(a.target.value),placeholder:"Specify details"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(l,{children:"Current Status"}),e.jsx(u,{options:ua,value:Q,placeholder:"Select Status",onChange:ee})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(l,{children:"Education *"}),e.jsx(u,{options:ha,value:y,placeholder:"Select Education",onChange:ae,error:!!r.education,hint:r.education})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(l,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(o,{type:"text",id:"otherEducation",value:E,onChange:a=>te(a.target.value),placeholder:"Specify details"})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(Ae,{title:"Enquiry / Lead Information",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(pa,{label:"Course Preference *",id:"new-lead-course-preference",options:Ue,selectedValues:_,onChange:se,error:!!r.coursePreference,hint:r.coursePreference})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(l,{children:"Contact Point *"}),e.jsx(u,{options:Be,value:d,placeholder:"Contact Point",onChange:Xe,error:!!r.contactPoint,hint:r.contactPoint})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(l,{htmlFor:"otherContactPoint",children:"Specify other *"}),e.jsx(o,{type:"text",id:"otherContactPoint",value:w,onChange:a=>ne(a.target.value),disabled:d!=="other",error:d==="other"&&!w.trim()&&!!r.otherContactPoint,hint:d==="other"&&!w.trim()?r.otherContactPoint:""})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(l,{children:"Campaign *"}),e.jsx(u,{options:ze,value:A,placeholder:"Campaigns",id:"new-lead-campaign",onChange:Je,error:!!r.campaign,hint:r.campaign})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsx(Le,{id:"followupDate",label:"Next Follow Up Date *",value:v,disablePastDates:!0,onChange:(a,t)=>le(t),error:!!r.followUpDate,hint:r.followUpDate})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(l,{htmlFor:"leadRemarks",children:"Remarks *"}),e.jsx(o,{type:"text",id:"leadRemarks",value:M,onChange:a=>re(a.target.value),error:!!r.leadRemarks,hint:r.leadRemarks})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx(l,{children:"Lead Potential *"}),e.jsx(u,{options:xa,value:q,placeholder:"Select Lead Potential",onChange:ie,error:!!r.leadPotential,hint:r.leadPotential})]})})]})})})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-6",children:[e.jsx(x,{type:"button",onClick:De,variant:"outline",disabled:j,children:"Clear"}),e.jsx(x,{variant:"primary",type:"submit",disabled:j,id:"new-lead-submit-btn",children:j?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"})]})]}),e.jsxs(qe,{isOpen:Ve,onClose:R,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(o,{id:"newCampaignName",type:"text",value:I,onChange:a=>he(a.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:pe,onChange:a=>xe(a.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(o,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:G,onChange:a=>ge(a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"newCampaignCashback",children:"Cashback (â‚¹)"}),e.jsx(o,{id:"newCampaignCashback",type:"number",min:"0",value:$,onChange:a=>fe(a.target.value),placeholder:"0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:Ce,onChange:a=>we(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(l,{htmlFor:"newCampaignActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active campaigns will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:R,children:"Cancel"}),e.jsx(x,{type:"button",onClick:Ye,children:"Create Campaign"})]})]})]}),e.jsxs(qe,{isOpen:Ze,onClose:z,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Contact Point"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"newContactPointName",children:"Contact Point Name *"}),e.jsx(o,{id:"newContactPointName",type:"text",value:B,onChange:a=>ve(a.target.value),placeholder:"e.g., Walk In"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"newContactPointDesc",children:"Description"}),e.jsx("textarea",{id:"newContactPointDesc",value:je,onChange:a=>Ne(a.target.value),placeholder:"Contact point description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newContactPointActive",checked:Pe,onChange:a=>ye(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(l,{htmlFor:"newContactPointActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active contact points will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:z,children:"Cancel"}),e.jsx(x,{type:"button",onClick:Qe,children:"Create Contact Point"})]})]})]}),e.jsx(ga,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{va as default};
