import{r as l,c as g,b as I,j as e,P as B,E,C as w,x as o,I as m,m as O,B as D,H as z,y as p}from"./index-BNEGGE57.js";const F=()=>{const[d,j]=l.useState("student"),[h,v]=l.useState(""),[f,b]=l.useState([]),[T,N]=l.useState(!1),[s,i]=l.useState(null),[r,y]=l.useState({amount:"",paymentDate:new Date().toISOString().split("T")[0],paymentMode:"Cash",transactionId:"",remarks:""}),[C,S]=l.useState(!1);l.useEffect(()=>{const a=setTimeout(()=>{h.length>2?$():b([])},500);return()=>clearTimeout(a)},[h,d]);const $=async()=>{N(!0);try{const a=d==="student"?`${g}/students/all`:`${g}/customers/all`,t=await I.get(a,{withCredentials:!0}),n=(d==="student"?t.data.students:t.data.customers).filter(u=>{const q=u.fullName||`${u.firstName} ${u.lastName}`,P=u.phone||u.phone1,k=h.toLowerCase();return q.toLowerCase().includes(k)||P&&P.includes(k)}).slice(0,5);b(n)}catch(a){console.error("Search error:",a)}finally{N(!1)}},M=a=>{i(a),v(""),b([])},x=a=>{const{name:t,value:c}=a.target;y(n=>({...n,[t]:c}))},R=async a=>{var t,c;if(a.preventDefault(),!s){p.error("Please select a Student or Lead");return}if(!r.amount||r.amount<=0){p.error("Please enter a valid amount");return}S(!0);try{const n={...r,studentId:d==="student"?s._id:void 0,leadId:d==="lead"?s._id:void 0,brandId:s.brand};await I.post(`${g}/payments/create`,n,{withCredentials:!0}),p.success("Payment recorded successfully!"),y({amount:"",paymentDate:new Date().toISOString().split("T")[0],paymentMode:"Cash",transactionId:"",remarks:""}),i(null)}catch(n){console.error("Payment submission error:",n),p.error(((c=(t=n.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to record payment")}finally{S(!1)}},L=[{value:"Cash",label:"Cash"},{value:"Bank Transfer",label:"Bank Transfer"},{value:"UPI",label:"UPI"},{value:"Cheque",label:"Cheque"},{value:"Card",label:"Card"},{value:"Online",label:"Online"}];return e.jsxs("div",{children:[e.jsx(B,{title:"Collect Payment",description:"Record received payments"}),e.jsx(E,{pageTitle:"Collect Payment"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs(w,{title:"Select This Payer",children:[e.jsxs("div",{className:"flex gap-4 mb-4 border-b border-gray-200 dark:border-gray-700 pb-2",children:[e.jsx("button",{className:`pb-2 px-4 font-medium ${d==="student"?"text-brand-600 border-b-2 border-brand-600":"text-gray-500"}`,onClick:()=>{j("student"),i(null)},children:"Student"}),e.jsx("button",{className:`pb-2 px-4 font-medium ${d==="lead"?"text-brand-600 border-b-2 border-brand-600":"text-gray-500"}`,onClick:()=>{j("lead"),i(null)},children:"Lead"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{children:"Search by Name or Phone"}),e.jsx(m,{placeholder:"Type to search...",value:h,onChange:a=>v(a.target.value)}),T&&e.jsx("div",{className:"absolute right-3 top-9",children:e.jsx(O,{size:"sm"})}),f.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg dark:bg-gray-800 dark:border-gray-700",children:f.map(a=>e.jsxs("div",{className:"p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 border-b last:border-0 border-gray-100 dark:border-gray-700",onClick:()=>M(a),children:[e.jsx("p",{className:"font-medium text-gray-800 dark:text-white",children:a.fullName||`${a.firstName} ${a.lastName}`}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.email," | ",a.phone||a.phone1]})]},a._id))})]}),s&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-2",children:"Selected Payer Details"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",s.fullName||`${s.firstName} ${s.lastName}`]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",s.phone||s.phone1]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",s.email]})]}),e.jsx(D,{className:"mt-3 text-xs",variant:"outline",size:"sm",onClick:()=>i(null),children:"Clear Selection"})]})]})}),e.jsx("div",{children:e.jsx(w,{title:"Payment Details",children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{required:!0,children:"Amount"}),e.jsx(m,{type:"number",name:"amount",value:r.amount,onChange:x,disabled:!s,min:"0"})]}),e.jsxs("div",{children:[e.jsx(o,{required:!0,children:"Date"}),e.jsx(m,{type:"date",name:"paymentDate",value:r.paymentDate,onChange:x,disabled:!s})]}),e.jsxs("div",{children:[e.jsx(o,{required:!0,children:"Mode"}),e.jsx(z,{options:L,value:r.paymentMode,onChange:a=>y(t=>({...t,paymentMode:a})),disabled:!s})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Transaction ID (Optional)"}),e.jsx(m,{name:"transactionId",value:r.transactionId,onChange:x,disabled:!s,placeholder:"e.g. UPI Ref Number"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Remarks"}),e.jsx(m,{name:"remarks",value:r.remarks,onChange:x,disabled:!s})]}),e.jsx("div",{className:"pt-4",children:e.jsx(D,{type:"submit",variant:"primary",className:"w-full",disabled:!s||C,children:C?"Processing...":"Receive Payment"})})]})})})]})]})};export{F as default};
