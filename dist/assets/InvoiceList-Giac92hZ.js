import{r,j as e,M as w,B as x,b as N,y as p,A as D,c as j,P as A,E as R,F as V,C as L,m as E,t as z,al as O,S as H,n as Z}from"./index-BNEGGE57.js";import{S as _,I as $}from"./InvoiceViewer-BTtsNvgx.js";import"./file-BKwY2KsR.js";const B=s=>r.createElement("svg",{width:"1em",height:"1em",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},r.createElement("path",{d:"M2.5 8.5V8C2.29076 8 2.10365 8.13029 2.03106 8.32653C1.95846 8.52277 2.01574 8.74346 2.1746 8.87963L2.5 8.5ZM2 1H13V0H2V1ZM2.5 9H5.5V8H2.5V9ZM5.5 0H2.5V1H5.5V0ZM2.1746 8.87963L9.1746 14.8796L9.8254 14.1204L2.8254 8.12037L2.1746 8.87963ZM10 4.5C10 2.01472 7.98528 0 5.5 0V1C7.433 1 9 2.567 9 4.5H10ZM5.5 9C7.98528 9 10 6.98528 10 4.5H9C9 6.433 7.433 8 5.5 8V9ZM2 5H13V4H2V5Z",fill:"#000000"})),T="/api",q=({isOpen:s,onClose:m,invoice:a,onPaymentRecorded:b})=>{const[i,o]=r.useState({amount:"",paymentDate:new Date().toISOString().split("T")[0],paymentMode:"Cash",referenceNumber:"",notes:""}),[y,h]=r.useState(!1);r.useEffect(()=>{if(a){let l=a.balanceDue;a.status==="Paid"?l=0:l=a.totalAmount-(a.amountReceived||0),o(d=>({...d,amount:l}))}},[a]);const n=l=>{const{name:d,value:u}=l.target;o(c=>({...c,[d]:u}))},f=async l=>{var d,u;l.preventDefault(),h(!0);try{await N.post(`${T}/receipts`,{...i,invoiceId:a._id},{withCredentials:!0}),p.success("Payment recorded successfully!"),b(),m()}catch(c){console.error("Payment error:",c),p.error(((u=(d=c.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to record payment")}finally{h(!1)}};return a?e.jsxs(w,{isOpen:s,onClose:m,className:"max-w-lg w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Record Payment"}),e.jsxs("div",{className:"mb-6 bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-500",children:"Invoice Number:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-200",children:a.invoiceNumber})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-500",children:"Total Amount:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-200",children:a.totalAmount.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Balance Due:"}),e.jsx("span",{className:"font-bold text-red-500",children:((a.status==="Paid"?0:a.totalAmount-(a.amountReceived||0))||0).toLocaleString("en-IN",{style:"currency",currency:"INR"})})]})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Amount Received ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"â‚¹"}),e.jsx("input",{type:"number",name:"amount",required:!0,min:"1",max:a.status==="Paid"?0:a.totalAmount-(a.amountReceived||0),value:i.amount,onChange:n,className:"w-full pl-8 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Payment Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"paymentDate",required:!0,value:i.paymentDate,onChange:n,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Payment Mode ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"paymentMode",value:i.paymentMode,onChange:n,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all",children:[e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Cheque",children:"Cheque"}),e.jsx("option",{value:"Online",children:"Online"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reference Number"}),e.jsx("input",{type:"text",name:"referenceNumber",placeholder:"e.g. Transaction ID, Cheque No.",value:i.referenceNumber,onChange:n,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",rows:"2",value:i.notes,onChange:n,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(x,{variant:"outline",onClick:m,disabled:y,children:"Cancel"}),e.jsx(x,{variant:"primary",type:"submit",loading:y,children:"Record Payment"})]})]})]}):null},K=()=>{const{selectedBrand:s}=r.useContext(D),[m,a]=r.useState([]),[b,i]=r.useState(!0),[o,y]=r.useState(null),[h,n]=r.useState(!1),[f,l]=r.useState(!1),[d,u]=r.useState(null);r.useEffect(()=>{c()},[s]);const c=async()=>{i(!0);try{const t=(s==null?void 0:s._id)||(s==null?void 0:s.id),g=t?`${j}/invoices?brand=${t}`:`${j}/invoices`,M=await N.get(g,{withCredentials:!0});a(M.data)}catch(t){console.error("Error fetching invoices:",t)}finally{i(!1)}},C=t=>{y(t),n(!0)},v=t=>{window.location.href=`/finance/generate-invoice?edit=${t}`},S=t=>{u(t),l(!0)},I=()=>{c(),o&&d&&o._id===d._id&&n(!1)},k=async t=>{try{await N.patch(`${j}/invoices/${t._id}`,{status:"Sent"},{withCredentials:!0}),p.success("Invoice marked as sent"),c()}catch(g){console.error("Error updating invoice status:",g),p.error("Failed to update status")}},P=t=>{switch(t){case"Paid":return"success";case"Draft":return"light";case"Sent":return"primary";case"Partial":return"warning";case"Overdue":return"error";case"Void":return"error";default:return"light"}};return e.jsxs("div",{children:[e.jsx(A,{title:"Manage Invoices",description:"View and manage all invoices"}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(R,{pageTitle:"Manage Invoices"}),e.jsxs(x,{variant:"primary",size:"sm",onClick:()=>window.location.href="/finance/generate-invoice",children:[e.jsx(V,{className:"size-4 mr-2"}),"New Invoice"]})]}),e.jsx(L,{title:"All Invoices",children:b?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(E,{})}):m.length===0?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-500",children:"No invoices found for this brand."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3]",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3]",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3]",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3]",children:"Due Date"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3]",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3]",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 leading-[1.3] text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:m.map(t=>{var g;return e.jsxs("tr",{className:"hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800 dark:text-gray-300 font-medium",children:t.invoiceNumber}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800 dark:text-gray-300",children:(g=t.customer)==null?void 0:g.fullName}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:new Date(t.invoiceDate).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:t.dueDate?new Date(t.dueDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-800 dark:text-gray-300",children:t.totalAmount.toLocaleString("en-IN",{style:"currency",currency:"INR"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(z,{variant:P(t.status),children:t.status})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>C(t),className:"border-gray-300 hover:border-brand-500 text-gray-700 hover:text-brand-600 dark:border-gray-600 dark:text-gray-300",title:"View",children:e.jsx(O,{className:"size-4"})}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>v(t._id),className:"border-gray-300 hover:border-brand-500 text-gray-700 hover:text-brand-600 dark:border-gray-600 dark:text-gray-300",disabled:t.status==="Paid",title:"Edit",children:e.jsx(H,{className:"size-4"})}),t.status==="Draft"&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>k(t),className:"border-gray-300 hover:border-blue-500 text-gray-700 hover:text-blue-600 dark:border-gray-600 dark:text-gray-300",title:"Mark as Sent",children:e.jsx(_,{className:"size-4"})}),t.status!=="Paid"&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>S(t),className:"border-gray-300 hover:border-green-500 text-gray-700 hover:text-green-600 dark:border-gray-600 dark:text-gray-300",title:"Record Payment",children:e.jsx(B,{className:"size-4"})})]})})]},t._id)})})]})})}),e.jsx(w,{isOpen:h,onClose:()=>n(!1),className:"max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto my-8 custom-scrollbar",children:e.jsx("div",{className:"py-2",children:o&&e.jsx($,{invoice:o,onEdit:()=>v(o._id),onMarkAsSent:()=>{k(o),n(!1)}})})}),e.jsx(q,{isOpen:f,onClose:()=>l(!1),invoice:d,onPaymentRecorded:I}),e.jsx(Z,{position:"top-right",autoClose:3e3,className:"!z-[999999]",style:{zIndex:999999}})]})};export{K as default};
