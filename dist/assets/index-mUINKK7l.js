import{r as u,A as O,b as _,e as z,j as e,P as U,q as B,w as H,C as w,t as o,I as c,v as k,c as x,y as s}from"./index-Cn8aCYCy.js";const g="http://localhost:3000/api",G=()=>{const{isAdmin:p}=u.useContext(O),[L,v]=u.useState([]),[F,q]=u.useState(!0),[I,f]=u.useState(!1),[A,E]=u.useState(null),[t,j]=u.useState({employeeName:"",employeeId:"",leaveType:"casual",startDate:"",endDate:"",reason:"",status:"pending"});_();const N=z(),h=async()=>{var a;try{q(!0);const r=await x.get(`${g}/leaves`,{withCredentials:!0,timeout:1e4});r.data&&r.data.leaves?v(r.data.leaves):r.data&&Array.isArray(r.data)?v(r.data):v([])}catch(r){console.error("Error fetching leaves:",r),r.response?r.response.status===401?s.error("Authentication required. Please log in again."):r.response.status===403?s.error("Access denied. Admin privileges required."):s.error(((a=r.response.data)==null?void 0:a.message)||"Failed to fetch leaves"):r.request?s.error("Network error. Please check your connection."):s.error("Failed to fetch leaves. Please try again."),v([])}finally{q(!1)}};u.useEffect(()=>{h()},[]);const i=a=>{const{name:r,value:n}=a.target;j(d=>({...d,[r]:n}))},D=(a,r)=>{j(n=>({...n,[a]:r}))},b=()=>{j({employeeName:"",employeeId:"",leaveType:"casual",startDate:"",endDate:"",reason:"",status:"pending"})},T=async a=>{var r,n;try{const d=await x.get(`${g}/leaves/${a}`,{withCredentials:!0,timeout:1e4}),l=((r=d.data)==null?void 0:r.leave)||d.data;if(!l){s.error("Leave not found");return}j({employeeName:l.employeeName||"",employeeId:l.employeeId||"",leaveType:l.leaveType||"casual",startDate:l.startDate?new Date(l.startDate).toISOString().split("T")[0]:"",endDate:l.endDate?new Date(l.endDate).toISOString().split("T")[0]:"",reason:l.reason||"",status:l.status||"pending"}),E(a),f(!0)}catch(d){console.error("Error fetching leave for edit:",d),d.response?d.response.status===404?s.error("Leave not found"):d.response.status===401?s.error("Authentication required"):s.error(((n=d.response.data)==null?void 0:n.message)||"Failed to load leave details"):s.error("Failed to load leave details. Please try again.")}},P=a=>{T(a)},$=async a=>{var l,S;if(a.preventDefault(),!t.employeeName||!t.employeeId||!t.leaveType||!t.startDate||!t.endDate||!t.reason){s.error("Please fill in all required fields");return}const r=new Date(t.startDate),n=new Date(t.endDate),d=new Date;if(d.setHours(0,0,0,0),r>n){s.error("Start date cannot be after end date");return}if(r<d){s.error("Start date cannot be in the past");return}try{const m={employeeName:t.employeeName.trim(),employeeId:t.employeeId.trim(),leaveType:t.leaveType,startDate:r.toISOString(),endDate:n.toISOString(),reason:t.reason.trim()},y=await x.post(`${g}/leaves/create`,m,{timeout:1e4});y.data&&y.data.message?s.success(y.data.message||"Leave request submitted successfully!"):s.success("Leave request submitted successfully!"),b(),N.pathname.includes("/leave-management/requests")||h()}catch(m){if(console.error("Error submitting leave request:",m),m.response){const y=((l=m.response.data)==null?void 0:l.message)||((S=m.response.data)!=null&&S.errors?m.response.data.errors.join(", "):"Failed to submit leave request");s.error(y)}else m.request?s.error("Network error. Please check your connection."):s.error("Failed to submit leave request. Please try again.")}},R=async a=>{var d;if(a.preventDefault(),!p){s.error("Access denied. Admin privileges required.");return}if(!t.employeeName||!t.employeeId||!t.leaveType||!t.startDate||!t.endDate||!t.reason){s.error("Please fill in all required fields");return}const r=new Date(t.startDate),n=new Date(t.endDate);if(r>n){s.error("Start date cannot be after end date");return}try{const l={employeeName:t.employeeName.trim(),employeeId:t.employeeId.trim(),leaveType:t.leaveType,startDate:r.toISOString(),endDate:n.toISOString(),reason:t.reason.trim(),status:t.status};await x.put(`${g}/leaves/update/${A}`,l,{withCredentials:!0,timeout:1e4}),s.success("Leave updated successfully"),f(!1),b(),h()}catch(l){console.error("Error updating leave:",l),l.response?s.error(((d=l.response.data)==null?void 0:d.message)||"Failed to update leave"):s.error("Failed to update leave. Please try again.")}},C=async(a,r)=>{var n;if(!p){s.error("Access denied. Admin privileges required.");return}try{await x.patch(`${g}/leaves/status/${a}`,{status:r},{withCredentials:!0,timeout:1e4}),s.success(`Leave ${r} successfully`),h()}catch(d){console.error(`Error ${r}ing leave:`,d),d.response?s.error(((n=d.response.data)==null?void 0:n.message)||`Failed to ${r} leave`):s.error(`Failed to ${r} leave. Please try again.`)}},M=async a=>{var r;if(!p){s.error("Access denied. Admin privileges required.");return}if(window.confirm("Are you sure you want to delete this leave request?"))try{await x.delete(`${g}/leaves/delete/${a}`,{withCredentials:!0,timeout:1e4}),s.success("Leave deleted successfully"),h()}catch(n){console.error("Error deleting leave:",n),n.response?s.error(((r=n.response.data)==null?void 0:r.message)||"Failed to delete leave"):s.error("Failed to delete leave. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Leave Management - CRM"}),e.jsx(B,{items:[{name:"Dashboard",path:"/"},{name:"Leave Management",path:"/leave-management"},{name:N.pathname.includes("/leave-management/requests")?"Leave Requests":"Manage Leaves"}]}),e.jsx(H,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}}),!p&&e.jsxs("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Access Limited"}),e.jsx("p",{children:"You don't have admin privileges. Some features may be unavailable."})]}),N.pathname.includes("/leave-management/requests")?e.jsx(w,{title:"Request Leave",children:e.jsx("form",{onSubmit:$,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeName",children:"Employee Name *"}),e.jsx(c,{type:"text",id:"employeeName",name:"employeeName",value:t.employeeName,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeId",children:"Employee ID *"}),e.jsx(c,{type:"text",id:"employeeId",name:"employeeId",value:t.employeeId,onChange:i,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsx(k,{options:[{value:"casual",label:"Casual Leave"},{value:"sick",label:"Sick Leave"},{value:"annual",label:"Annual Leave"},{value:"maternity",label:"Maternity Leave"},{value:"paternity",label:"Paternity Leave"}],value:t.leaveType,onChange:a=>D("leaveType",a)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"status",children:"Status"}),e.jsx(c,{type:"text",id:"status",name:"status",value:"pending",readOnly:!0,disabled:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(c,{type:"date",id:"startDate",name:"startDate",value:t.startDate,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",children:"End Date *"}),e.jsx(c,{type:"date",id:"endDate",name:"endDate",value:t.endDate,onChange:i,required:!0})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reason",children:"Reason *"}),e.jsx("textarea",{id:"reason",name:"reason",value:t.reason,onChange:i,rows:"4",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-hidden focus:ring-3 focus:ring-brand-500/20 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 focus:border-brand-300 dark:border-gray-700 dark:focus:border-brand-800 rounded-lg shadow-theme-xs",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"reset",onClick:b,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Reset"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Submit Request"})]})]})})}):e.jsx(e.Fragment,{children:I&&p?e.jsx(w,{title:"Edit Leave Request",children:e.jsx("form",{onSubmit:R,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeName",children:"Employee Name *"}),e.jsx(c,{type:"text",id:"employeeName",name:"employeeName",value:t.employeeName,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeId",children:"Employee ID *"}),e.jsx(c,{type:"text",id:"employeeId",name:"employeeId",value:t.employeeId,onChange:i,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsx(k,{options:[{value:"casual",label:"Casual Leave"},{value:"sick",label:"Sick Leave"},{value:"annual",label:"Annual Leave"},{value:"maternity",label:"Maternity Leave"},{value:"paternity",label:"Paternity Leave"}],value:t.leaveType,onChange:a=>D("leaveType",a)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"status",children:"Status *"}),e.jsx(k,{options:[{value:"pending",label:"Pending"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"}],value:t.status,onChange:a=>D("status",a)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(c,{type:"date",id:"startDate",name:"startDate",value:t.startDate,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",children:"End Date *"}),e.jsx(c,{type:"date",id:"endDate",name:"endDate",value:t.endDate,onChange:i,required:!0})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reason",children:"Reason *"}),e.jsx("textarea",{id:"reason",name:"reason",value:t.reason,onChange:i,rows:"4",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-hidden focus:ring-3 focus:ring-brand-500/20 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 focus:border-brand-300 dark:border-gray-700 dark:focus:border-brand-800 rounded-lg shadow-theme-xs",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),b()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Update Leave"})]})]})})}):e.jsx(w,{title:"Manage Leave Requests",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:F?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading leave requests..."})}):L.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No leave requests found."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Leave Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Dates"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700",children:L.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.employeeName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",a.employeeId]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.leaveType})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[new Date(a.startDate).toLocaleDateString()," - ",new Date(a.endDate).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.status==="approved"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":a.status==="rejected"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P(a._id),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-3",children:"Edit"}),a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>C(a._id,"approved"),className:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 mr-3",children:"Approve"}),e.jsx("button",{onClick:()=>C(a._id,"rejected"),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 mr-3",children:"Reject"})]}),e.jsx("button",{onClick:()=>M(a._id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Delete"})]})})]},a._id))})]})})})})})]})};export{G as default};
