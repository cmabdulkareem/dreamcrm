import{b as I,r as m,c as C,j as e,B as L,T as U,f as B,g as D,h as c,k as z,l as S,S as E,P as M}from"./index-Cn8aCYCy.js";import{E as A,M as O,S as T,a as H,D as $}from"./DemographicCard-YGYNmjuU.js";import{C as q}from"./react-apexcharts.min-C0qS4jIZ.js";import{S as P,D as _,a as V}from"./DropdownItem-CzUxBRpz.js";import{S as Q}from"./bell-DnDT7AFf.js";import{S as F}from"./calender-line-CABFEOny.js";const R="http://localhost:3000/api";function W(){const d=I(),[n,j]=m.useState([]),[p,h]=m.useState(!0);m.useEffect(()=>{f()},[]);const f=async()=>{try{const s=(await C.get(`${R}/customers/all`,{withCredentials:!0})).data.customers.sort((r,i)=>new Date(i.createdAt)-new Date(r.createdAt)).slice(0,5);j(s),h(!1)}catch(t){console.error("Error fetching leads:",t),h(!1)}},w=t=>t?new Date(t).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"N/A",N=t=>({new:"New Lead",contacted:"Contacted",qualified:"Qualified",negotiation:"In Negotiation",converted:"Converted",callBackLater:"Call Back Later",notInterested:"Not Interested",lost:"Lost"})[t]||"New Lead",y=t=>t==="converted"||t==="qualified"?"success":t==="negotiation"||t==="contacted"?"info":t==="callBackLater"||t==="new"?"warning":t==="lost"||t==="notInterested"?"error":"light",b=()=>{d("/lead-management")},g=t=>{sessionStorage.setItem("openLeadId",t),d("/lead-management")};return e.jsx("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6",children:p?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Loading leads..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Recent Enquiries"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Latest 5 leads"})]}),e.jsx(L,{size:"sm",variant:"outline",onClick:b,children:"View All"})]}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs(U,{className:"min-w-[800px]",children:[e.jsx(B,{className:"border-gray-100 dark:border-gray-800 border-y",children:e.jsxs(D,{children:[e.jsx(c,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Name"}),e.jsx(c,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Mobile"}),e.jsx(c,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Lead Status"}),e.jsx(c,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Next Follow-up"}),e.jsx(c,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Actions"})]})}),e.jsx(z,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:n.length===0?e.jsx(D,{children:e.jsx(c,{colSpan:5,className:"py-8 text-center text-gray-500",children:"No leads found."})}):n.map(t=>{var s;return e.jsxs(D,{children:[e.jsx(c,{className:"py-3",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800 text-theme-sm dark:text-white/90",children:t.fullName}),e.jsx("p",{className:"text-gray-400 text-xs",children:((s=t.coursePreference)==null?void 0:s.join(", "))||"N/A"})]})})}),e.jsx(c,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:t.phone1}),e.jsx(c,{className:"py-3",children:e.jsx(S,{size:"sm",color:y(t.leadStatus),children:N(t.leadStatus)})}),e.jsx(c,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:w(t.followUpDate)}),e.jsx(c,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsx(L,{size:"sm",variant:"outline",className:"mr-2",endIcon:e.jsx(E,{className:"size-5"}),onClick:()=>g(t._id)})})]},t._id)})})]})})]})})}const G="http://localhost:3000/api";function J(){const[d,n]=m.useState({categories:[],values:[],colors:[]}),[j,p]=m.useState(!0),[h,f]=m.useState(!1);m.useEffect(()=>{w()},[]);const w=async()=>{try{const s=(await C.get(`${G}/customers/all`,{withCredentials:!0})).data.customers,r={new:{label:"New Lead",color:"#FFA500"},contacted:{label:"Contacted",color:"#3B82F6"},qualified:{label:"Qualified",color:"#10B981"},negotiation:{label:"Negotiation",color:"#8B5CF6"},converted:{label:"Converted",color:"#059669"},callBackLater:{label:"Call Back",color:"#F59E0B"},notInterested:{label:"Not Interested",color:"#EF4444"},lost:{label:"Lost",color:"#DC2626"}},i={};s.forEach(l=>{const u=l.leadStatus||"new";i[u]=(i[u]||0)+1});const a=[],x=[],o=[];Object.entries(i).sort((l,u)=>u[1]-l[1]).forEach(([l,u])=>{r[l]&&(a.push(r[l].label),x.push(u),o.push(r[l].color))}),n({categories:a,values:x,colors:o}),p(!1)}catch(t){console.error("Error fetching status data:",t),p(!1)}},N={colors:d.colors.length>0?d.colors:["#465FFF"],chart:{fontFamily:"Outfit, sans-serif",type:"donut",height:300},labels:d.categories,legend:{show:!0,position:"bottom",horizontalAlign:"center",fontFamily:"Outfit",fontSize:"12px"},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,name:{show:!0,fontSize:"14px",fontWeight:600},value:{show:!0,fontSize:"16px",fontWeight:700,formatter:function(t){return t}},total:{show:!0,label:"Total Leads",fontSize:"14px",fontWeight:600,formatter:function(t){return t.globals.seriesTotals.reduce((s,r)=>s+r,0)}}}}}},dataLabels:{enabled:!0,formatter:function(t,s){const r=s.w.globals.seriesTotals.reduce((a,x)=>a+x,0);return(t/r*100).toFixed(1)+"%"}},tooltip:{y:{formatter:function(t,s){const r=s.w.globals.seriesTotals.reduce((a,x)=>a+x,0),i=(t/r*100).toFixed(1);return`${t} leads (${i}%)`}}}},y=d.values;function b(){f(!h)}function g(){f(!1)}return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white px-5 pt-5 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 sm:pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Lead Status Breakdown"}),e.jsx("p",{className:"mt-1 text-gray-500 text-theme-sm dark:text-gray-400",children:"Distribution of leads by status"})]}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{className:"dropdown-toggle",onClick:b,children:e.jsx(P,{className:"text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 size-6"})}),e.jsx(_,{isOpen:h,onClose:g,className:"w-40 p-2",children:e.jsx(V,{onItemClick:g,className:"flex w-full font-normal text-left text-gray-500 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300",children:"View More"})})]})]}),j?e.jsx("div",{className:"text-center py-20",children:e.jsx("p",{className:"text-gray-500",children:"Loading status data..."})}):y.length===0?e.jsx("div",{className:"text-center py-20",children:e.jsx("p",{className:"text-gray-500",children:"No lead data available"})}):e.jsx(q,{options:N,series:y,type:"donut",height:300})]})}const K="http://localhost:3000/api";function X(){const d=I(),[n,j]=m.useState({today:[],upcoming:[],overdue:[]}),[p,h]=m.useState(!0);m.useEffect(()=>{f()},[]);const f=async()=>{try{const s=(await C.get(`${K}/customers/all`,{withCredentials:!0})).data.customers,r=new Date;r.setHours(0,0,0,0);const i=[],a=[],x=[];s.forEach(o=>{if(o.followUpDate){const l=new Date(o.followUpDate);l.setHours(0,0,0,0);const u=l-r,v=Math.ceil(u/(1e3*60*60*24)),k={_id:o._id,fullName:o.fullName,phone1:o.phone1,followUpDate:o.followUpDate,leadStatus:o.leadStatus,daysDiff:v};v===0?i.push(k):v>0&&v<=7?a.push(k):v<0&&x.push(k)}}),i.sort((o,l)=>new Date(o.followUpDate)-new Date(l.followUpDate)),a.sort((o,l)=>new Date(o.followUpDate)-new Date(l.followUpDate)),x.sort((o,l)=>new Date(o.followUpDate)-new Date(l.followUpDate)),j({today:i.slice(0,5),upcoming:a.slice(0,5),overdue:x.slice(0,5)}),h(!1)}catch(t){console.error("Error fetching follow-ups:",t),h(!1)}},w=t=>t?new Date(t).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"N/A",N=t=>t==="converted"||t==="qualified"?"success":t==="negotiation"||t==="contacted"?"info":t==="callBackLater"||t==="new"?"warning":t==="lost"||t==="notInterested"?"error":"light",y=t=>({new:"New Lead",contacted:"Contacted",qualified:"Qualified",negotiation:"In Negotiation",converted:"Converted",callBackLater:"Call Back Later",notInterested:"Not Interested",lost:"Lost"})[t]||t,b=t=>{sessionStorage.setItem("openLeadId",t),d("/lead-management")},g=(t,s,r,i)=>s.length===0?null:e.jsxs("div",{className:"mb-6 last:mb-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i,e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white/90",children:t}),e.jsx(S,{color:r,size:"sm",children:s.length})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer transition-colors",onClick:()=>b(a._id),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white/90",children:a.fullName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a.phone1," â€¢ ",w(a.followUpDate),a.daysDiff!==0&&e.jsx("span",{className:`ml-2 ${a.daysDiff<0?"text-red-500":"text-blue-500"}`,children:a.daysDiff<0?`${Math.abs(a.daysDiff)} days overdue`:`in ${a.daysDiff} days`})]})]}),e.jsx(S,{size:"sm",color:N(a.leadStatus),children:y(a.leadStatus)})]},a._id))})]});return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white px-5 pt-5 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 sm:pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Follow-ups Due"}),e.jsx("p",{className:"mt-1 text-gray-500 text-theme-sm dark:text-gray-400",children:"Leads requiring attention"})]}),e.jsx(L,{size:"sm",variant:"outline",onClick:()=>d("/lead-management"),children:"View All"})]}),p?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Loading follow-ups..."})}):e.jsxs("div",{className:"max-h-[500px] overflow-y-auto custom-scrollbar",children:[n.overdue.length>0&&g("Overdue",n.overdue,"error",e.jsx(Q,{className:"size-5 text-red-500"})),n.today.length>0&&g("Today",n.today,"warning",e.jsx(F,{className:"size-5 text-orange-500"})),n.upcoming.length>0&&g("Upcoming (7 days)",n.upcoming,"info",e.jsx(F,{className:"size-5 text-blue-500"})),n.today.length===0&&n.upcoming.length===0&&n.overdue.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No follow-ups scheduled"})})]})]})}function re(){return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Leads Dashboard | CRM Dashboard Overview",description:"Comprehensive dashboard for leads, admissions, revenue, and student management"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white/90",children:"Leads Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Overview of your leads, admissions, revenue, and key metrics"})]}),e.jsx(A,{}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 md:gap-6",children:[e.jsxs("div",{className:"col-span-12 space-y-6 xl:col-span-8",children:[e.jsx(O,{}),e.jsx(T,{})]}),e.jsxs("div",{className:"col-span-12 space-y-6 xl:col-span-4",children:[e.jsx(H,{}),e.jsx(X,{})]}),e.jsx("div",{className:"col-span-12 lg:col-span-6",children:e.jsx(J,{})}),e.jsx("div",{className:"col-span-12 lg:col-span-6",children:e.jsx($,{})}),e.jsx("div",{className:"col-span-12",children:e.jsx(W,{})})]})]})]})}export{re as default};
