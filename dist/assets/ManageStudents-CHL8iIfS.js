import{b as Ze,r as s,A as Je,u as Ke,c as P,d as j,y as h,j as e,P as Xe,G as Ye,B as f,C as He,n as Qe,M as et,z as n,I as i,K as y,W as fe,X as ye,Y as tt,Z as at,_ as st,$ as rt,o as nt}from"./index-BRRNp47y.js";import{S as lt}from"./StudentProfileModal-DvVowh50.js";import{D as ve}from"./date-picker-DxGeXKuS.js";import{S as Ne}from"./SearchableCourseSelect-DUB_OBEY.js";import"./calender-line-CMLkAvQj.js";import"./chevron-down-2NhGbJfV.js";function pt(){const be=Ze(),{user:c}=s.useContext(Je),{addNotification:Ce,areToastsEnabled:Se}=Ke(),[B,L]=s.useState([]),[ke,D]=s.useState(!0),[we,A]=s.useState(!1),[Pe,E]=s.useState(null),[De,R]=s.useState(!1),[Ae,Ee]=s.useState(null),[I,T]=s.useState(!1),[v,V]=s.useState(""),[m,U]=s.useState(""),[N,G]=s.useState(""),[W,Z]=s.useState(""),[J,K]=s.useState(""),[X,Y]=s.useState(""),[x,H]=s.useState("Kasaragod"),[p,Q]=s.useState(""),[b,ee]=s.useState(""),[g,te]=s.useState(""),[ae,O]=s.useState(null),[F,M]=s.useState(""),[se,re]=s.useState(""),[ne,le]=s.useState(""),[d,ie]=s.useState(""),[o,C]=s.useState([]),[S,de]=s.useState(""),[k,oe]=s.useState(""),[ce,Ie]=s.useState(""),[xe,ue]=s.useState(""),[$,Oe]=s.useState([]),[Fe,Me]=s.useState([]),[l,q]=s.useState({}),[it,dt]=s.useState(!1),he=s.useRef(null);s.useEffect(()=>{me(),$e(),qe()},[]);const $e=async()=>{try{const t=await P.get(`${j}/courses/all`,{withCredentials:!0});Oe(t.data.courses)}catch(t){console.error("Error fetching courses:",t)}},qe=async()=>{try{const t=await P.get(`${j}/brands`,{withCredentials:!0});Me(t.data.brands||[])}catch(t){console.error("Error fetching brands:",t)}},me=async()=>{try{D(!0);const t=await P.get(`${j}/students/all`,{withCredentials:!0});L(t.data.students),D(!1)}catch(t){console.error("Error fetching students:",t),L([{_id:"1",studentId:"STU001",fullName:"John Doe",email:"john@example.com",phone1:"+1 234 567 8900",coursePreference:"Graphic Design",enrollmentDate:"2025-01-15",status:"Active",photo:null},{_id:"2",studentId:"STU002",fullName:"Jane Smith",email:"jane@example.com",phone1:"+1 234 567 8901",coursePreference:"Interior Design",enrollmentDate:"2025-01-20",status:"Active",photo:null}]),h.info("Using demo data for demonstration"),D(!1)}},_e=()=>{be("/new-student")},pe=t=>{Ee(t),R(!0)},ze=t=>{var r;E(t),V(t.fullName||""),U(t.email||""),G(t.phone1||""),Z(t.phone2||""),K(t.gender||""),Y(t.dob?new Date(t.dob).toISOString().split("T")[0]:""),H(t.place||""),Q(t.otherPlace||""),ee(t.address||""),te(t.aadharCardNumber||""),O(null),M(t.photo?je(t.photo):""),re(t.status||""),le(t.education||""),ie(t.coursePreference||""),C(t.additionalCourses||[]),de(t.discountPercentage||0),oe(t.enrollmentDate?new Date(t.enrollmentDate).toISOString().split("T")[0]:""),Ie(t.studentId||""),ue(((r=t.brand)==null?void 0:r._id)||t.brand||""),q({}),A(!0)},_=()=>{A(!1),E(null),q({})},u=s.useCallback(()=>{let t=0;if(d){const r=$.find(a=>a._id===d);r&&(t+=r.normalFee||0)}return o.forEach(r=>{const a=$.find(z=>z._id===r);a&&(t+=a.normalFee||0)}),t},[d,o,$]),w=s.useCallback(()=>{const t=u(),r=parseFloat(S)||0;return t*r/100},[u,S]),ge=s.useCallback(()=>{const t=u(),r=w();return t-r},[u,w]),Be=s.useCallback(t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){h.error("Please select an image file");return}if(r.size>5*1024*1024){h.error("File size exceeds 5MB limit");return}O(r);const a=new FileReader;a.onloadend=()=>M(a.result),a.readAsDataURL(r)},[]),Le=s.useCallback(()=>{const t={};return v.trim()||(t.fullName="Full Name is required"),m.trim()?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(m)||(t.email="Please enter a valid email address"):t.email="Email is required",N.trim()||(t.phone1="Phone is required"),x?x==="Other"&&!p.trim()&&(t.otherPlace="Please specify the place"):t.place="Place is required",b.trim()||(t.address="Address is required"),g.trim()?/^\d{12}$/.test(g)||(t.aadharCardNumber="Aadhar Card Number must be 12 digits"):t.aadharCardNumber="Aadhar Card Number is required",d||(t.coursePreference="Primary course is required"),k||(t.enrollmentDate="Enrollment date is required"),q(t),Object.keys(t).length===0},[v,m,N,x,p,b,g,d,k]),Re=async()=>{var t,r;if(!Le()){h.error("Please fill in all required fields");return}try{T(!0);const a=new FormData;a.append("fullName",v),a.append("email",m),a.append("phone1",N),a.append("phone2",W),a.append("gender",J),a.append("dob",X),a.append("place",x),a.append("otherPlace",p),a.append("address",b),a.append("aadharCardNumber",g),a.append("status",se),a.append("education",ne),a.append("coursePreference",d),a.append("additionalCourses",JSON.stringify(o.filter(We=>We))),a.append("totalCourseValue",u()),a.append("discountPercentage",S||0),a.append("discountAmount",w()),a.append("finalAmount",ge()),a.append("enrollmentDate",k),a.append("brandId",xe),ae&&a.append("photo",ae);const z=await P.put(`${j}/students/update/${Pe._id}`,a,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});me(),A(!1),E(null),Se()&&h.success("Student updated successfully!"),Ce({type:"student_updated",userName:(c==null?void 0:c.fullName)||"Someone",avatar:(c==null?void 0:c.avatar)||null,action:"updated student",entityName:z.data.student.fullName,module:"Student Management"})}catch(a){console.error("Error updating student:",a),h.error(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update student")}finally{T(!1)}},Te=()=>{C([...o,""])},Ve=t=>{const r=[...o];r.splice(t,1),C(r)},Ue=(t,r)=>{const a=[...o];a[t]=r,C(a)},Ge=()=>{var t;(t=he.current)==null||t.click()},je=t=>t?t.startsWith("http")||t.startsWith("data:")?t:`${j.replace("/api","")}${t}`:"/images/user/user-01.jpg";return e.jsxs("div",{children:[e.jsx(Xe,{title:"Manage Students | DreamCRM",description:"Manage your students here"}),e.jsx(Ye,{pageTitle:"Manage Students"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{variant:"primary",onClick:_e,children:"Add New Student"})}),e.jsx(He,{title:"Student List",children:ke?e.jsx(Qe,{}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Photo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Course"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Enrollment Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700",children:B.length>0?B.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover border-2 border-gray-200 dark:border-gray-700",src:je(t.photo),alt:t.fullName,onError:r=>{r.target.src="/images/user/user-01.jpg"}})})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white cursor-pointer hover:text-indigo-600 transition-colors",onClick:()=>pe(t),children:t.fullName}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.studentId})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:t.email}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.phone1})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"max-w-[200px] break-words",children:[t.courseDetails?`${t.courseDetails.courseCode} - ${t.courseDetails.courseName}`:t.coursePreference,t.additionalCourseDetails&&t.additionalCourseDetails.length>0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["+",t.additionalCourseDetails.length," additional course(s)"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white text-xs",children:["Final: ₹",t.finalAmount||0]}),e.jsxs("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 line-through",children:["Val: ₹",t.totalCourseValue||0]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.enrollmentDate).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100",children:"Active"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>ze(t),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",children:"Edit"}),e.jsx("button",{onClick:()=>pe(t),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",children:"View"})]})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:"No students found"})})})]})})})]}),e.jsxs(et,{isOpen:we,onClose:_,className:"max-w-[1400px] p-6 lg:p-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"mb-2 font-semibold text-gray-800 dark:text-white/90 modal-title text-theme-xl lg:text-2xl",children:["Edit Student: ",e.jsx("span",{className:"text-gray-500",children:ce})]}),e.jsx("button",{onClick:_,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"✕"})]}),e.jsx("div",{className:"overflow-y-auto max-h-[80vh] p-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Full Name *"}),e.jsx(i,{type:"text",value:v,onChange:t=>V(t.target.value),error:!!l.fullName,hint:l.fullName})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Brand *"}),e.jsx(y,{options:Fe.map(t=>({value:t._id,label:`${t.name} (${t.code})`})),value:xe,onChange:ue})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Email *"}),e.jsx(i,{type:"email",value:m,onChange:t=>U(t.target.value),error:!!l.email,hint:l.email})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Student Photo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",ref:he,onChange:Be,accept:"image/*",className:"hidden"}),e.jsx("button",{type:"button",onClick:Ge,className:"w-16 h-16 overflow-hidden border-2 border-dashed border-gray-300 rounded-full cursor-pointer hover:border-brand-500 transition-colors flex items-center justify-center",children:F?e.jsx("img",{src:F,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-xs text-gray-400 text-center",children:"No Photo"})}),F&&e.jsx("button",{type:"button",onClick:()=>{O(null),M("")},className:"text-xs text-red-500 hover:text-red-700",children:"Remove"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Phone 1 *"}),e.jsx(fe,{countries:ye,value:N,onChange:G,error:!!l.phone1})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Phone 2"}),e.jsx(fe,{countries:ye,value:W,onChange:Z})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gender"}),e.jsx(y,{options:tt,value:J,onChange:K})]}),e.jsx("div",{children:e.jsx(ve,{id:"edit-student-dob",label:"Date of Birth",value:X,onChange:(t,r)=>Y(r)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Place *"}),e.jsx(y,{options:at,value:x,onChange:H,error:!!l.place})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Specify other *"}),e.jsx(i,{type:"text",value:p,onChange:t=>Q(t.target.value),error:x==="Other"&&!p.trim()&&!!l.otherPlace})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Address *"}),e.jsx(i,{type:"text",value:b,onChange:t=>ee(t.target.value),error:!!l.address})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Aadhar Number *"}),e.jsx(i,{type:"text",value:g,onChange:t=>te(t.target.value.replace(/\D/g,"")),maxLength:"12",error:!!l.aadharCardNumber})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Current Status"}),e.jsx(y,{options:st,value:se,onChange:re})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Education"}),e.jsx(y,{options:rt,value:ne,onChange:le})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(n,{children:"Primary Course *"}),e.jsx(Ne,{value:d,onChange:ie,error:!!l.coursePreference})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded",children:[e.jsx(n,{className:"!mb-0",children:"Additional Courses"}),e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:Te,children:"Add Course"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map((t,r)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(Ne,{value:t,onChange:a=>Ue(r,a)})}),e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:()=>Ve(r),children:"Remove"})]},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Total Value (₹)"}),e.jsx(i,{type:"text",value:u(),readOnly:!0,className:"bg-white dark:bg-gray-900"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Discount (%)"}),e.jsx(i,{type:"number",value:S,onChange:t=>de(t.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Discount (₹)"}),e.jsx(i,{type:"text",value:w(),readOnly:!0,className:"bg-white dark:bg-gray-900"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Final Amount (₹)"}),e.jsx(i,{type:"text",value:ge(),readOnly:!0,className:"bg-white dark:bg-gray-900 font-bold text-brand-600"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(ve,{id:"edit-student-enrollment-date",label:"Enrollment Date *",value:k,onChange:(t,r)=>oe(r),error:!!l.enrollmentDate})}),e.jsxs("div",{children:[e.jsx(n,{children:"Student ID (Locked)"}),e.jsx(i,{type:"text",value:ce,readOnly:!0,className:"bg-gray-100 dark:bg-gray-700 font-mono"})]})]})]})})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-100 dark:border-gray-800",children:[e.jsx(f,{variant:"outline",onClick:_,disabled:I,children:"Cancel"}),e.jsx(f,{variant:"primary",onClick:Re,disabled:I,children:I?"Saving...":"Save Changes"})]})]}),e.jsx(lt,{isOpen:De,onClose:()=>R(!1),student:Ae}),e.jsx(nt,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{pt as default};
