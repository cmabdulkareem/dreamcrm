import{r as n,A as me,b as A,c as L,y as P,j as e,P as he,E as ge,L as pe,B as R,C as ue,x as m,H as f,a8 as ye,a2 as je,aa as fe,m as E,T as U,o as I,p as u,q as a,s as O,t as _,a6 as B,n as be}from"./index-BNEGGE57.js";import{R as M,P as Ne}from"./RangeDatePicker-quGvPJGm.js";import{S as ve}from"./shooting-star-B8F1DdHT.js";import{S as Se}from"./chevron-down-BH7m1aFk.js";import{S as Ce}from"./chevron-up-D72zhKQL.js";import{E as we}from"./jspdf.es.min-C1kKzVV0.js";import"./jspdf.plugin.autotable-Ctn9oCMc.js";import{f as h}from"./leadHelpers-DM4gjVXH.js";import"./index-B_JH6AFf.js";import"./calender-line-DQbsZUHO.js";function Ee(){const{user:ke}=n.useContext(me),[d,F]=n.useState("leads"),[b,G]=n.useState(!0),[y,V]=n.useState([]),[N,q]=n.useState(""),[v,Y]=n.useState(""),[S,J]=n.useState(""),[T,K]=n.useState([]),[Q,D]=n.useState(!1),[j,W]=n.useState([]),[C,X]=n.useState(""),[w,Z]=n.useState(""),[$,ee]=n.useState([]),[te,z]=n.useState(!1),[se,ae]=n.useState([]),[re,le]=n.useState([]);n.useEffect(()=>{ne(),oe(),d==="leads"?de():ie()},[d]);const ne=async()=>{try{const t=await A.get(`${L}/campaigns/active`,{withCredentials:!0}),s=[{value:"",label:"All Campaigns"},...t.data.campaigns.map(r=>({value:r.value,label:r.name}))];ae(s)}catch(t){console.error("Error fetching campaigns:",t)}},oe=async()=>{try{const t=await A.get(`${L}/users/dropdown`,{withCredentials:!0}),s=[{value:"",label:"All Users"},...t.data.users.map(r=>({value:r._id,label:r.fullName}))];le(s)}catch(t){console.error("Error fetching users:",t)}},de=async()=>{D(!0);try{const t=await A.get(`${L}/customers/all`,{withCredentials:!0});K(t.data.customers)}catch(t){console.error("Error fetching leads:",t),P.error("Failed to fetch leads")}finally{D(!1)}},ie=async()=>{z(!0);try{const t=await A.get(`${L}/call-lists`,{withCredentials:!0});ee(t.data.callLists)}catch(t){console.error("Error fetching call lists:",t),P.error("Failed to fetch call lists")}finally{z(!1)}},c=n.useMemo(()=>T.filter(t=>{if(y&&y.length===2){const s=new Date(t.createdAt),[r,i]=y;if(s<r||s>i)return!1}return!(N&&t.leadStatus!==N||v&&t.leadPotential!==v||S&&t.campaign!==S)}),[T,y,N,v,S]),x=n.useMemo(()=>$.filter(t=>{var s;if(j&&j.length===2){const r=new Date(t.createdAt),[i,l]=j;if(r<i||r>l)return!1}return!(C&&t.status!==C||w&&(((s=t.assignedTo)==null?void 0:s._id)||t.assignedTo)!==w)}),[$,j,C,w]),g=n.useMemo(()=>{const t=c.length,s=c.filter(i=>i.leadStatus==="converted").length,r=t>0?(s/t*100).toFixed(2):0;return{total:t,converted:s,conversionRate:r}},[c]),p=n.useMemo(()=>{const t=x.length,s=x.filter(i=>i.status&&!["pending","no-answer","busy","switched-off"].includes(i.status)).length,r=t>0?(s/t*100).toFixed(2):0;return{total:t,completed:s,completionRate:r}},[x]),ce=()=>{const t=d==="leads"?c:x;let s;d==="leads"?s=t.map(o=>({"Full Name":o.fullName,Email:o.email||"N/A",Phone:o.phone1,"Lead Status":o.leadStatus,"Lead Potential":o.leadPotential,Campaign:o.campaign||"N/A","Contact Point":o.contactPoint||"N/A","Created Date":h(o.createdAt),"Follow-up Date":o.followUpDate?h(o.followUpDate):"N/A"})):s=t.map(o=>{var H;return{"Full Name":o.fullName,Phone:o.phone,Status:o.status||"Pending","Assigned To":((H=o.assignedTo)==null?void 0:H.fullName)||"Unassigned",Remarks:o.remarks||"N/A","Created Date":h(o.createdAt)}});const r=Ne.unparse(s),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),k=URL.createObjectURL(i);l.setAttribute("href",k),l.setAttribute("download",`${d}_report_${new Date().toISOString().split("T")[0]}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),P.success("Report exported successfully!")},xe=()=>{const t=new we,s=d==="leads"?c:x;t.setFontSize(18),t.text(`${d==="leads"?"Lead":"Cold Call"} Report`,14,22),t.setFontSize(11),t.text(`Generated: ${new Date().toLocaleString()}`,14,30),d==="leads"?(t.text(`Total Leads: ${g.total}`,14,38),t.text(`Converted: ${g.converted}`,14,44),t.text(`Conversion Rate: ${g.conversionRate}%`,14,50)):(t.text(`Total Calls: ${p.total}`,14,38),t.text(`Completed: ${p.completed}`,14,44),t.text(`Completion Rate: ${p.completionRate}%`,14,50));let r,i;d==="leads"?(i=[["Name","Phone","Status","Potential","Campaign","Created"]],r=s.map(l=>[l.fullName,l.phone1,l.leadStatus,l.leadPotential||"N/A",l.campaign||"N/A",h(l.createdAt)])):(i=[["Name","Phone","Status","Assigned To","Created"]],r=s.map(l=>{var k;return[l.fullName,l.phone,l.status||"Pending",((k=l.assignedTo)==null?void 0:k.fullName)||"Unassigned",h(l.createdAt)]})),t.autoTable({head:i,body:r,startY:60,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),t.save(`${d}_report_${new Date().toISOString().split("T")[0]}.pdf`),P.success("PDF exported successfully!")};return e.jsxs("div",{children:[e.jsx(he,{title:"Reports | DreamCRM",description:"Generate reports for leads and cold call lists"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(ge,{pageTitle:"Reports"}),e.jsx(pe,{to:"/support-dashboard",children:e.jsx(R,{size:"sm",variant:"primary",startIcon:e.jsx(ve,{className:"size-4"}),className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 border-0 shadow-lg hover:shadow-xl transition-all duration-200",children:"Share Idea"})})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200 dark:border-gray-800",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>F("leads"),className:`pb-3 px-4 font-medium transition-colors ${d==="leads"?"text-brand-500 border-b-2 border-brand-500":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Lead Reports"}),e.jsx("button",{onClick:()=>F("calls"),className:`pb-3 px-4 font-medium transition-colors ${d==="calls"?"text-brand-500 border-b-2 border-brand-500":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Cold Call Reports"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:d==="leads"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Leads"}),e.jsx("p",{className:"text-3xl font-bold text-gray-800 dark:text-white mt-2",children:g.total})]}),e.jsxs("div",{className:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Converted"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-2",children:g.converted})]}),e.jsxs("div",{className:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Conversion Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-brand-500 mt-2",children:[g.conversionRate,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Calls"}),e.jsx("p",{className:"text-3xl font-bold text-gray-800 dark:text-white mt-2",children:p.total})]}),e.jsxs("div",{className:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-2",children:p.completed})]}),e.jsxs("div",{className:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Completion Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-brand-500 mt-2",children:[p.completionRate,"%"]})]})]})}),e.jsxs(ue,{title:d==="leads"?"Lead Report":"Cold Call Report",headerAction:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{size:"sm",variant:"outline",onClick:()=>G(!b),endIcon:b?e.jsx(Ce,{className:"size-4"}):e.jsx(Se,{className:"size-4"}),children:[b?"Hide":"Show"," Filters"]}),e.jsx(R,{size:"sm",variant:"outline",onClick:ce,endIcon:e.jsx(B,{className:"size-4"}),children:"Export CSV"}),e.jsx(R,{size:"sm",variant:"primary",onClick:xe,endIcon:e.jsx(B,{className:"size-4"}),children:"Export PDF"})]}),children:[b&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-800",children:d==="leads"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Date Range"}),e.jsx(M,{value:y,onChange:V,placeholder:"Select date range"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Lead Status"}),e.jsx(f,{options:[{value:"",label:"All Statuses"},...ye],value:N,onChange:q,placeholder:"Select status"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Lead Potential"}),e.jsx(f,{options:[{value:"",label:"All Potentials"},...je],value:v,onChange:Y,placeholder:"Select potential"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Campaign"}),e.jsx(f,{options:se,value:S,onChange:J,placeholder:"Select campaign"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Date Range"}),e.jsx(M,{value:j,onChange:W,placeholder:"Select date range"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Status"}),e.jsx(f,{options:[{value:"",label:"All Statuses"},...fe],value:C,onChange:X,placeholder:"Select status"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Assigned To"}),e.jsx(f,{options:re,value:w,onChange:Z,placeholder:"Select user"})]})]})}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:d==="leads"?Q?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(E,{})}):e.jsxs(U,{children:[e.jsx(I,{className:"border-gray-100 dark:border-gray-800 border-y",children:e.jsxs(u,{children:[e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Name"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Phone"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Status"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Potential"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Campaign"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Created"})]})}),e.jsx(O,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:c.length===0?e.jsx(u,{children:e.jsx(a,{colSpan:6,className:"py-8 text-center text-gray-500",children:"No leads found matching the filters"})}):c.map(t=>e.jsxs(u,{children:[e.jsx(a,{className:"py-3",children:t.fullName}),e.jsx(a,{className:"py-3",children:t.phone1}),e.jsx(a,{className:"py-3",children:e.jsx(_,{size:"sm",color:"primary",children:t.leadStatus})}),e.jsx(a,{className:"py-3",children:t.leadPotential||"N/A"}),e.jsx(a,{className:"py-3",children:t.campaign||"N/A"}),e.jsx(a,{className:"py-3",children:h(t.createdAt)})]},t._id))})]}):te?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(E,{})}):e.jsxs(U,{children:[e.jsx(I,{className:"border-gray-100 dark:border-gray-800 border-y",children:e.jsxs(u,{children:[e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Name"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Phone"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Status"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Assigned To"}),e.jsx(a,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs",children:"Created"})]})}),e.jsx(O,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:x.length===0?e.jsx(u,{children:e.jsx(a,{colSpan:5,className:"py-8 text-center text-gray-500",children:"No call lists found matching the filters"})}):x.map(t=>{var s;return e.jsxs(u,{children:[e.jsx(a,{className:"py-3",children:t.fullName}),e.jsx(a,{className:"py-3",children:t.phone}),e.jsx(a,{className:"py-3",children:e.jsx(_,{size:"sm",color:"light",children:t.status||"Pending"})}),e.jsx(a,{className:"py-3",children:((s=t.assignedTo)==null?void 0:s.fullName)||"Unassigned"}),e.jsx(a,{className:"py-3",children:h(t.createdAt)})]},t._id)})})]})})]}),e.jsx(be,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{Ee as default};
