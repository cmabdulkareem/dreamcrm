const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-9Il3u9WL.js","assets/index-BTKtjo01.js","assets/index.GgCX6cZQ.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,H as y,C as Pe,a5 as Ze,a6 as ra,d as X,e as B,k as I,a0 as Ge,a2 as Je,Y as De,a7 as Ga,y as k,A as Ja,K as Xa,u as Ka,G as je,i as ye,s as Qa,q as es,B as N,I as J,U as F,a8 as ts,a4 as na,T as as,v as ss,w as Ye,x as S,z as rs,F as ns,S as ls,a9 as os,M as be,Z as la,_ as oa,$ as is,a1 as ds,a3 as cs,D as us,t as ms,X as ia}from"./index-BTKtjo01.js";import{S as xs}from"./chevron-down-CFaGwoTk.js";import{f as ps,D as da}from"./date-picker-DAovfHJc.js";import{S as hs}from"./calender-line-BOFzFji2.js";const ca=t=>s.createElement("svg",{className:"size-6",width:"1em",height:"1em",viewBox:"0 0 24 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},s.createElement("path",{d:"M12.814 4.75L4.78516 16.0352H11.1859L11.1859 23.25L19.2148 11.9648L12.814 11.9648V4.75Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),gs=t=>s.createElement("svg",{className:"fill-current",width:"1em",height:"1em",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.8335 19.75C19.8335 20.9926 18.8261 22 17.5835 22H7.0835C5.84086 22 4.8335 20.9926 4.8335 19.75V9.62105C4.8335 9.02455 5.07036 8.45247 5.49201 8.03055L10.8597 2.65951C11.2817 2.23725 11.8542 2 12.4512 2H17.5835C18.8261 2 19.8335 3.00736 19.8335 4.25V19.75ZM17.5835 20.5C17.9977 20.5 18.3335 20.1642 18.3335 19.75V4.25C18.3335 3.83579 17.9977 3.5 17.5835 3.5H12.5815L12.5844 7.49913C12.5853 8.7424 11.5776 9.75073 10.3344 9.75073H6.3335V19.75C6.3335 20.1642 6.66928 20.5 7.0835 20.5H17.5835ZM7.39262 8.25073L11.0823 4.55876L11.0844 7.5002C11.0847 7.91462 10.7488 8.25073 10.3344 8.25073H7.39262ZM8.5835 14.5C8.5835 14.0858 8.91928 13.75 9.3335 13.75H15.3335C15.7477 13.75 16.0835 14.0858 16.0835 14.5C16.0835 14.9142 15.7477 15.25 15.3335 15.25H9.3335C8.91928 15.25 8.5835 14.9142 8.5835 14.5ZM8.5835 17.5C8.5835 17.0858 8.91928 16.75 9.3335 16.75H12.3335C12.7477 16.75 13.0835 17.0858 13.0835 17.5C13.0835 17.9142 12.7477 18.25 12.3335 18.25H9.3335C8.91928 18.25 8.5835 17.9142 8.5835 17.5Z",fill:"currentColor"})),ua=t=>s.createElement("svg",{className:"fill-current",width:"1em",height:"1em",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.6686 16.75C12.4526 16.75 12.2579 16.6587 12.1211 16.5126L7.5115 11.9059C7.21851 11.6131 7.21836 11.1382 7.51116 10.8452C7.80396 10.5523 8.27883 10.5521 8.57182 10.8449L11.9186 14.1896V4C11.9186 3.58579 12.2544 3.25 12.6686 3.25C13.0828 3.25 13.4186 3.58579 13.4186 4V14.1854L16.7615 10.8449C17.0545 10.5521 17.5294 10.5523 17.8222 10.8453C18.115 11.1383 18.1148 11.6131 17.8218 11.9059L13.2469 16.4776C13.1093 16.644 12.9013 16.75 12.6686 16.75ZM5.41663 16C5.41663 15.5858 5.08084 15.25 4.66663 15.25C4.25241 15.25 3.91663 15.5858 3.91663 16V18.5C3.91663 19.7426 4.92399 20.75 6.16663 20.75H19.1675C20.4101 20.75 21.4175 19.7426 21.4175 18.5V16C21.4175 15.5858 21.0817 15.25 20.6675 15.25C20.2533 15.25 19.9175 15.5858 19.9175 16V18.5C19.9175 18.9142 19.5817 19.25 19.1675 19.25H6.16663C5.75241 19.25 5.41663 18.9142 5.41663 18.5V16Z",fill:"currentColor"})),fs=t=>s.createElement("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},s.createElement("path",{d:"M15.8333 12.7083L10.6249 7.5L5.41658 12.7083",stroke:"currentColor",strokeWidth:1.25,strokeLinecap:"round",strokeLinejoin:"round"}));function ys({id:t,onChange:n,label:l,value:i,placeholder:u="Select date range",className:d=""}){const m=s.useRef(null);return s.useEffect(()=>(m.current=ps(`#${t}-wrapper`,{mode:"range",appendTo:window.document.body,monthSelectorType:"static",dateFormat:"Y-m-d",wrap:!0,allowInput:!0,defaultDate:i,onChange:(x,C)=>{n&&n(x,C)}}),()=>{m.current&&(m.current.destroy(),m.current=null)}),[t]),s.useEffect(()=>{m.current&&i!==void 0&&m.current.setDate(i,!1)},[i]),e.jsxs("div",{className:"w-full",children:[l&&e.jsx(y,{htmlFor:t,children:l}),e.jsxs("div",{className:"relative",id:`${t}-wrapper`,children:[e.jsx("input",{id:t,placeholder:u,"data-input":!0,readOnly:!0,className:`h-9 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2 text-sm text-gray-800 shadow-theme-xs transition-colors placeholder:text-gray-400 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/20 focus:outline-none dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 ${d}`}),e.jsx("span",{"data-toggle":!0,className:"absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-500 transition-colors hover:text-brand-500 dark:text-gray-400",children:e.jsx(hs,{className:"size-6"})})]})]})}const bs=({name:t,datetime:n,callback:l,note:i,status:u})=>{const d=m=>{const x=(m==null?void 0:m.toLowerCase())||"";return x.includes("converted")||x==="qualified"?"success":x.includes("negotiation")||x.includes("contacted")?"info":x.includes("call")||x==="new"?"warning":x.includes("lost")||x.includes("not interested")?"error":"light"};return e.jsxs("div",{className:"rounded-lg border border-gray-50 bg-gray-100 p-4 dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-white",children:t}),e.jsx("span",{children:n}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:e.jsx(Pe,{size:"sm",color:d(u),children:u||"N/A"})})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-200",children:i}),l&&e.jsxs("div",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:["Next Follow-up: ",l]})]})},we=t=>t?new Date(t).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"N/A",Ne=t=>{if(!t)return"New Lead";const n=Ze.find(l=>l.value===t);return n?n.label:t},ma=t=>t==="converted"||t==="qualified"?"success":t==="negotiation"||t==="contacted"?"info":t==="callBackLater"||t==="new"?"warning":t==="lost"||t==="notInterested"?"error":"light",vs=t=>t&&t.length>0?t[t.length-1].remark:"No remarks yet",js=(t,n)=>!t||t.length===0?!1:t.some(l=>l.isUnread),Ns=async(t,n,l)=>{if(t.length===0){l.warning("Please select at least one lead to download.");return}try{const i=(await ra(async()=>{const{default:c}=await import("./jspdf.es.min-9Il3u9WL.js").then(D=>D.j);return{default:c}},__vite__mapDeps([0,1,2]))).default,u=(await ra(async()=>{const{default:c}=await import("./jspdf.plugin.autotable-Ctn9oCMc.js");return{default:c}},[])).default,d=new i("landscape");d.setFontSize(18),d.text("Lead Report",14,20),d.setFontSize(10),d.text(`Generated on: ${new Date().toLocaleDateString("en-IN")}`,14,28);const x=n.filter(c=>t.includes(c._id)).map(c=>{const D=c.remarks&&c.remarks.length>0?c.remarks[c.remarks.length-1].remark:"No remarks";return[c.fullName,we(c.createdAt),c.phone1,c.contactPoint||"N/A",c.campaign||"N/A",Ne(c.leadStatus),D.substring(0,30)+(D.length>30?"...":""),we(c.followUpDate)]});u(d,{head:[["Name","Date Added","Mobile","Contact Point","Campaign","Lead Status","Latest Remark","Follow-up"]],body:x,startY:35,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[70,95,255],textColor:255},alternateRowStyles:{fillColor:[245,247,250]},margin:{top:35}});const C=d.internal.getNumberOfPages();for(let c=1;c<=C;c++)d.setPage(c),d.setFontSize(8),d.text(`Page ${c} of ${C}`,d.internal.pageSize.getWidth()/2,d.internal.pageSize.getHeight()-10,{align:"center"});d.save(`leads-report-${new Date().toISOString().split("T")[0]}.pdf`),l.success(`PDF downloaded with ${t.length} lead(s)!`)}catch(i){console.error("Error generating PDF:",i),l.error("Failed to generate PDF. Please try again.")}},xa=async(t,n)=>{var l;try{const i=await X.get(`${B}/customers/all`,{withCredentials:!0});return typeof t=="function"&&t(i.data.customers),typeof n=="function"&&n(!1),i.data.customers}catch(i){return console.error("Error fetching customers:",i),typeof n=="function"&&n(!1),((l=i.response)==null?void 0:l.status)===401&&alert("Please login to view leads."),[]}},pa=async(t,n,l)=>{try{const u=(await X.get(`${B}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(d=>({value:d.value,label:d.name}));return I(l)&&u.push({value:"__add_new__",label:"+ Add New Campaign"}),typeof t=="function"&&t(u),u}catch(i){console.error("Error fetching campaigns:",i);const u=[...n];return I(l)&&u.push({value:"__add_new__",label:"+ Add New Campaign"}),typeof t=="function"&&t(u),u}},ws=async(t,n,l,i,u,d,m,x,C,c,D,V,se,E)=>{var W,M;if(!t.trim()){E.error("Campaign name is required");return}try{const H=await X.post(`${B}/campaigns/create`,{name:t,description:n,discountPercentage:l?parseFloat(l):0,cashback:i?parseFloat(i):0,isActive:u},{withCredentials:!0});E.success("Campaign created successfully!"),typeof d=="function"&&d(H.data.campaign.value),typeof m=="function"&&await m(),typeof x=="function"&&x(),typeof C=="function"&&C(""),typeof c=="function"&&c(""),typeof D=="function"&&D(""),typeof V=="function"&&V(""),typeof se=="function"&&se(!0)}catch(H){console.error("Error creating campaign:",H),E.error(((M=(W=H.response)==null?void 0:W.data)==null?void 0:M.message)||"Failed to create campaign")}},ks=(t,n)=>{var A;const{setSelectedRow:l,setEditName:i,setEditPhone:u,setEditEmail:d,setEditStatus:m,setEditFollowUp:x,setFullName:C,setEmail:c,setPhone1:D,setPhone2:V,setGender:se,setDob:E,setPlace:W,setOtherPlace:M,setStatus:H,setEducation:q,setOtherEducation:z,setContactPoint:Y,setOtherContactPoint:w,setCampaign:me,setHandledByPerson:_,setFollowUpDate:le,setRemarks:$,setLeadStatus:R,setLeadPotential:oe,setSelectedValues:Z}=n;if(typeof l=="function"&&l(t),typeof i=="function"&&i(t.fullName),typeof u=="function"&&u(t.phone1),typeof d=="function"&&d(t.email),typeof m=="function"&&m(t.status),typeof x=="function"&&x(t.followUpDate?new Date(t.followUpDate).toISOString().split("T")[0]:""),typeof C=="function"&&C(t.fullName),typeof c=="function"&&c(t.email),typeof D=="function"&&D(t.phone1),typeof V=="function"&&V(t.phone2||""),typeof se=="function"&&se(t.gender||""),typeof E=="function"&&E(t.dob?new Date(t.dob).toISOString().split("T")[0]:""),typeof W=="function"&&(Ge.find(b=>b.value===t.place)||!t.place?W(t.place||""):W("Other")),typeof M=="function"){const v=!Ge.some(b=>b.value===t.place);M(v&&t.place||"")}typeof H=="function"&&H(t.status||""),typeof q=="function"&&(Je.find(b=>b.value===t.education)||!t.education?q(t.education||""):q("Other")),typeof z=="function"&&(t.education==="Other"?z(t.otherEducation||""):!Je.find(b=>b.value===t.education)&&t.education?z(t.education):z("")),typeof Y=="function"&&(De.find(b=>b.value===t.contactPoint)||!t.contactPoint?Y(t.contactPoint||""):Y("other")),typeof w=="function"&&(t.contactPoint==="other"?w(t.otherContactPoint||""):!De.find(b=>b.value===t.contactPoint)&&t.contactPoint?w(t.contactPoint):w("")),typeof me=="function"&&me(t.campaign||""),typeof _=="function"&&_(t.handledBy||""),typeof le=="function"&&(t.leadStatus==="converted"||t.leadStatus==="lost"?le(""):le(t.followUpDate?new Date(t.followUpDate).toISOString().split("T")[0]:"")),typeof $=="function"&&$(""),typeof R=="function"&&R(t.leadStatus||""),typeof oe=="function"&&oe(t.leadPotential||"");const f=((A=t.coursePreference)==null?void 0:A.map(v=>{const b=n.courseOptions||Ga;if(typeof v=="string"){if(b.some(U=>U.value===v))return v;const ie=b.find(U=>U.label===v);return ie?ie.value:v}return v}))||[];typeof Z=="function"&&Z(f)},Cs=async(t,n,l,i,u,d,m,x,C,c,D,V,se,E,W,M,H,q,z,Y,w,me,_,le,$,R,oe,Z,f,A,v)=>{try{let b=t;const xe=n.trim(),ie=(t==null?void 0:t.leadStatus)!==l;if(xe||ie){const re={remark:xe?n:`Status changed to ${_(l||"new")}`,handledBy:(w==null?void 0:w.fullName)||"Unknown",nextFollowUpDate:l==="converted"?null:z||null,leadStatus:l||"new"},L=await X.post(`${B}/customers/remark/${t._id}`,re,{withCredentials:!0});L.data.customer&&(b=L.data.customer)}const U={fullName:u,phone1:d,phone2:m,email:x,gender:C,dob:c,place:D,otherPlace:V,status:se,education:E,otherEducation:E==="Other"?W:"",contactPoint:M,otherContactPoint:H,campaign:q,handledBy:(w==null?void 0:w.fullName)||me,followUpDate:l==="converted"?null:z,leadStatus:l,leadPotential:i,coursePreference:Y},pe=await X.put(`${B}/customers/update/${t._id}`,U,{withCredentials:!0});if(l==="converted")try{const O=R.find(re=>{var L;return((L=re.extendedProps)==null?void 0:L.leadId)===t._id})}catch(O){console.error("Error managing calendar event:",O)}else if(z)try{const O=R.find(ke=>{var T;return((T=ke.extendedProps)==null?void 0:T.leadId)===t._id}),re=z,L={title:`Follow-up: ${u}`,start:re,end:re,allDay:!0,extendedProps:{calendar:"Warning",leadId:t._id,phone:d,email:x,status:l||"new"}};O?$(O.id,L):le(L)}catch(O){console.error("Error managing calendar event:",O)}return typeof oe=="function"&&await oe(),pe.data.customer?typeof Z=="function"&&Z(pe.data.customer):typeof Z=="function"&&Z(b),typeof f=="function"&&f(""),typeof A=="function"&&A({type:"lead_updated",userName:(w==null?void 0:w.fullName)||"Someone",avatar:(w==null?void 0:w.avatar)||null,action:"updated lead",entityName:u,module:"Lead Management"}),typeof v=="function"&&v()&&k.success("Updated lead status",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),!0}catch(b){return console.error("Error updating lead:",b),typeof v=="function"&&v()&&k.error("Failed to update lead. Please try again.",{position:"top-center",autoClose:3e3}),!1}},Ss=async(t,n,l,i,u,d,m,x)=>{if(!n){x.error("Only managers can delete leads.",{position:"top-center",autoClose:3e3}),typeof l=="function"&&l();return}try{await X.delete(`${B}/customers/delete/${t._id}`,{withCredentials:!0}),typeof u=="function"&&u(C=>C.filter(c=>c._id!==t._id)),typeof l=="function"&&l(),typeof i=="function"&&i(),typeof d=="function"&&d({type:"lead_deleted",userName:t.handledBy||"Someone",avatar:t.avatar||null,action:"deleted lead",entityName:t.fullName,module:"Lead Management"}),typeof m=="function"&&m()&&x.success("Lead deleted successfully!",{position:"top-center",autoClose:3e3})}catch(C){console.error("Error deleting lead:",C),typeof m=="function"&&m()&&x.error("Failed to delete lead. Please try again.",{position:"top-center",autoClose:3e3})}},Ps=async(t,n,l,i,u)=>{if(!(t!=null&&t.followUpDate)){u.error("No follow-up date set for this lead."),typeof n=="function"&&n();return}try{const m=new Date(t.followUpDate).toISOString().split("T")[0];typeof i=="function"&&i({title:`Follow-up: ${t.fullName}`,start:m,end:m,allDay:!0,extendedProps:{calendar:"Warning",leadId:t._id,phone:t.phone1,email:t.email,status:t.status}}),u.success(`Calendar reminder added for ${t.fullName}!`),typeof n=="function"&&n(),typeof l=="function"&&l()}catch(d){console.error("Error creating calendar event:",d),u.error("Failed to create calendar event.")}},Ds=async(t,n)=>{try{return(await X.put(`${B}/customers/mark-remark-read/${t}/${n}`,{},{withCredentials:!0})).data.customer}catch(l){throw console.error("Error marking remark as read:",l),l}},Ls=t=>{switch(t){case"strongProspect":return{bar:"bg-green-500"};case"potentialProspect":return{bar:"bg-blue-500"};case"weakProspect":return{bar:"bg-orange-500"};case"notAProspect":return{bar:"bg-gray-400"};default:return{bar:"bg-transparent"}}},Es=t=>{if(!t)return"light";const n=new Date;n.setHours(0,0,0,0);const l=new Date(n);l.setDate(l.getDate()+1);const i=new Date(n);i.setDate(i.getDate()+2);const u=new Date(t);return u.setHours(0,0,0,0),u<=n?"error":u.getTime()===l.getTime()?"warning":u.getTime()===i.getTime()?"success":"light"},_s=t=>t?we(t):"No Date";function Bs(){var Qt;const{user:t,selectedBrand:n}=s.useContext(Ja),{addEvent:l,events:i,updateEvent:u}=Xa(),{addNotification:d,areToastsEnabled:m}=Ka(),[x,C]=s.useState(""),[c,D]=s.useState("followup_latest"),[V,se]=s.useState(""),[E,W]=s.useState(""),[M,H]=s.useState(""),[q,z]=s.useState(""),[Y,w]=s.useState(!1),me=()=>{const a=new Date,r=new Date(a.getFullYear(),a.getMonth(),1),o=new Date(a.getFullYear(),a.getMonth()+1,0);return[r,o]},[_,le]=s.useState(me()),[$,R]=s.useState([]),[oe,Z]=s.useState(!0),[f,A]=s.useState(null),[v,b]=s.useState([]),[xe,ie]=s.useState([]),[U,pe]=s.useState([]),[O,re]=s.useState([]),[L,ke]=s.useState(null),[T,Xe]=s.useState({top:0,left:0,arrowLeft:0}),[Le,Ke]=s.useState(!1),K=s.useRef(null),ha=s.useRef(null),{isOpen:ga,openModal:fa,closeModal:Ee}=je(),{isOpen:ya,openModal:ba,closeModal:_e}=je(),{isOpen:va,openModal:ja,closeModal:Fe}=je(),{isOpen:Na,openModal:wa,closeModal:Ae}=je(),{isOpen:ka,openModal:Ca,closeModal:Ue}=je(),[Fs,Qe]=s.useState(""),[As,et]=s.useState(""),[Us,tt]=s.useState(""),[Os,at]=s.useState(""),[Ts,st]=s.useState(""),[rt,nt]=s.useState(""),[lt,ot]=s.useState(""),[it,dt]=s.useState(""),[Oe,ct]=s.useState(""),[ut,mt]=s.useState(""),[xt,pt]=s.useState(""),[ht,gt]=s.useState(""),[ft,yt]=s.useState(""),[bt,vt]=s.useState(""),[jt,Sa]=s.useState(!1),[Te,Nt]=s.useState(""),[wt,kt]=s.useState(""),[Ie,Me]=s.useState(""),[He,Ct]=s.useState(""),[St,Pt]=s.useState(""),[Dt,ze]=s.useState(""),[Pa,Da]=s.useState(""),[Is,Ms]=s.useState(""),[$e,Re]=s.useState(""),[Lt,Et]=s.useState([]),[Q,_t]=s.useState(""),[Be,Ft]=s.useState(""),[At,Ut]=s.useState(""),[Ot,Tt]=s.useState(""),[It,Mt]=s.useState(""),[Ht,zt]=s.useState(""),[$t,Rt]=s.useState(!0),[La,Bt]=s.useState(!1),Ea=I(t);(Qt=t==null?void 0:t.roles)!=null&&Qt.includes("Counsellor");const Vt=ye(t)||I(t),Wt=!ye(t)&&!Ea,he=ye(t)||I(t);s.useEffect(()=>{xa(R,Z),pa(b,ia,t),qa()},[t]),s.useEffect(()=>{t&&(()=>{const r=t==null?void 0:t.isAdmin,o=I(t);(r||o)&&Ce((n==null?void 0:n._id)||(n==null?void 0:n.id))})()},[t,n]);const Ce=async(a=null)=>{try{const r=a?`${B}/users/dropdown?brandId=${a}`:`${B}/users/dropdown`,o=await X.get(r,{withCredentials:!0});re(o.data.users||[])}catch(r){console.error("Error fetching users:",r),k.error("Failed to fetch users for assignment")}};s.useEffect(()=>{he&&n&&Ce((n==null?void 0:n._id)||(n==null?void 0:n.id))},[n,he]),s.useEffect(()=>{const a=sessionStorage.getItem("openLeadId");if(a&&$.length>0){const r=$.find(o=>o._id===a);r&&(Zt(r),sessionStorage.removeItem("openLeadId"))}},[$]);const qt=a=>{const p=window.innerWidth,h=window.innerHeight,P=85;let g=a.left,j=a.width/2;g+384>p-20&&(g=p-384-20),g<20&&(g=20),j=a.left+a.width/2-g,j=Math.max(20,Math.min(364,j));const ee=a.top-P-20,ne=h-a.bottom-20,ce=350;let te=0,ge="",fe=0;return ee>ce||ee>ne?(te=a.top,ge="translateY(-100%) translateY(-10px)",fe=ee):(te=a.bottom,ge="translateY(10px)",fe=ne),{top:te,left:g,arrowLeft:j,transform:ge,maxHeight:fe}},_a=(a,r)=>{if(r.remarks&&r.remarks.length>0){K.current&&clearTimeout(K.current);const o=a.currentTarget.getBoundingClientRect(),p=qt(o);Xe(p),ke(r._id),K.current=setTimeout(()=>{Ke(!0)},150)}},Yt=()=>{K.current&&(clearTimeout(K.current),K.current=null),K.current=setTimeout(()=>{ke(null),Ke(!1)},100)};s.useEffect(()=>{if(!L)return;const a=()=>{const r=document.querySelector(`[data-row-id="${L}"]`);if(r){const o=r.getBoundingClientRect(),p=qt(o);Xe(p)}};return window.addEventListener("resize",a),window.addEventListener("scroll",a,!0),()=>{window.removeEventListener("resize",a),window.removeEventListener("scroll",a,!0)}},[L]);const Fa=a=>{const r=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a);return Sa(!r),r},Aa=a=>{const r=a.target.value;ot(r),Fa(r)},de=$.filter(a=>{var ee,ne,ce,te,ge,fe,ea,ta,aa,sa;const r=((ee=a.fullName)==null?void 0:ee.toLowerCase().includes(x.toLowerCase()))||((ne=a.phone1)==null?void 0:ne.includes(x)),o=V?a.status===V:!0,p=E?a.leadStatus===E:!0,h=M?a.leadPotential===M:!0;let P=!0;if(he&&q){const G=((te=(ce=a.assignedTo)==null?void 0:ce._id)==null?void 0:te.toString())||((ge=a.assignedTo)==null?void 0:ge.toString());q==="unassigned"?P=!G:P=G===q}let g=!0;if(!he){const G=((ea=(fe=a.assignedTo)==null?void 0:fe._id)==null?void 0:ea.toString())||((ta=a.assignedTo)==null?void 0:ta.toString()),ae=((aa=t==null?void 0:t.id)==null?void 0:aa.toString())||((sa=t==null?void 0:t._id)==null?void 0:sa.toString());(!G||G!==ae)&&(g=!1)}let j=!0;if(_&&_.length>0){const G=new Date(a.createdAt);G.setHours(0,0,0,0);const ae=a.followUpDate?new Date(a.followUpDate):null;if(ae&&ae.setHours(0,0,0,0),_.length===2){const ue=new Date(_[0]),ve=new Date(_[1]);ue.setHours(0,0,0,0),ve.setHours(0,0,0,0);const qe=G>=ue&&G<=ve,Za=ae&&ae>=ue&&ae<=ve;j=qe||Za}else if(_.length===1){const ue=new Date(_[0]);ue.setHours(0,0,0,0);const ve=G.getTime()===ue.getTime(),qe=ae&&ae.getTime()===ue.getTime();j=ve||qe}}return r&&o&&p&&h&&P&&g&&j}).sort((a,r)=>{const o=g=>({strongProspect:4,potentialProspect:3,weakProspect:2,notAProspect:1})[g]||0,p=g=>["converted","lost","notInterested"].includes(g)?2:1;if(c==="followup_latest"||c==="followup_oldest"){const g=a.followUpDate?new Date(a.followUpDate):null,j=r.followUpDate?new Date(r.followUpDate):null;if(g&&g.setHours(0,0,0,0),j&&j.setHours(0,0,0,0),(g==null?void 0:g.getTime())!==(j==null?void 0:j.getTime()))return!g&&!j?0:g?j?c==="followup_latest"?g-j:j-g:-1:1;const ee=p(a.leadStatus),ne=p(r.leadStatus);if(ee!==ne)return ee-ne;const ce=o(a.leadPotential),te=o(r.leadPotential);return ce!==te?te-ce:new Date(r.createdAt)-new Date(a.createdAt)}const h=new Date(a.createdAt),P=new Date(r.createdAt);return c==="asc"?h-P:P-h}),Ua=a=>{pe(r=>r.includes(a)?r.filter(o=>o!==a):[...r,a])},Oa=a=>{a.target.checked?pe(de.map(r=>r._id)):pe([])},Ta=async()=>{await Ns(U,$,k)},Zt=async a=>{if(a.remarks&&a.remarks.length>0){const o=a.remarks.map((p,h)=>({remark:p,index:h})).filter(({remark:p})=>p.isUnread);for(const{index:p}of o)try{await Ds(a._id,p)}catch(h){console.error("Error marking remark as read:",h)}o.length>0&&R(p=>p.map(h=>{if(h._id===a._id){const P=[...h.remarks];return o.forEach(({index:g})=>{P[g].isUnread=!1}),{...h,remarks:P}}return h}))}ks(a,{setSelectedRow:A,setEditName:Qe,setEditPhone:et,setEditEmail:tt,setEditStatus:at,setEditFollowUp:st,setFullName:nt,setEmail:ot,setPhone1:gt,setPhone2:yt,setGender:vt,setDob:dt,setPlace:ct,setOtherPlace:mt,setStatus:pt,setEducation:Nt,setOtherEducation:kt,setContactPoint:Ct,setOtherContactPoint:Pt,setCampaign:ze,setHandledByPerson:Da,setFollowUpDate:Re,setRemarks:Me,setLeadStatus:_t,setLeadPotential:Ft,setSelectedValues:Et,courseOptions:xe}),fa()},Ia=a=>{if(!Vt){k.error("Only managers and admins can delete leads.",{position:"top-center",autoClose:3e3});return}A(a),ba()},Ma=a=>{A(a),ja()},Ha=async()=>{if(!Q){k.error("Lead Status is required");return}if(!Be){k.error("Lead Potential is required");return}if(Q!=="converted"&&Q!=="lost"&&!$e){k.error("Next Follow Up Date is required");return}if(!Ie.trim()){k.error("Remarks are required");return}Bt(!0);try{await Cs(f,Ie,Q,Be,rt,ht,ft,lt,bt,it,Oe,ut,xt,Te,wt,He,St,Dt,Q==="converted"||Q==="lost"?null:$e,Lt,t,Pa,Ne,l,u,i,()=>xa(R,Z),A,Me,d,m)}finally{Bt(!1)}},za=async()=>{await Ss(f,Vt,_e,Se,R,d,m,k)},$a=async()=>{await Ps(f,Fe,Se,l,k)},Ra=a=>{a==="__add_new__"?wa():ze(a)},Ba=async()=>{await ws(At,Ot,It,Ht,$t,ze,()=>pa(b,ia,t),Ae,Ut,Tt,Mt,zt,Rt,k)},Se=()=>{A(null),Qe(""),et(""),tt(""),at(""),st("")},[Va,Gt]=s.useState(!1),[Ve,Jt]=s.useState(""),[Xt,Kt]=s.useState(""),Wa=a=>{A(a),Gt(!0),a.brand?Ce(a.brand._id||a.brand):Ce()},We=()=>{Gt(!1),Jt(""),Kt("")},qa=async()=>{try{const r=(await X.get(`${B}/course-categories/all`,{withCredentials:!0})).data.categories.filter(o=>o.isActive).map(o=>({value:o.name,label:o.name}));ie(r)}catch(a){console.error("Error fetching course categories:",a),ie([{value:"General",label:"General"}])}},Ya=async()=>{var a,r;if(!Ve){k.error("Please select a user to assign the lead to");return}try{const o=await X.put(`${B}/customers/assign/${f._id}`,{assignedTo:Ve,assignmentRemark:Xt},{withCredentials:!0});o.data.customer&&(R(p=>p.map(h=>h._id===f._id?o.data.customer:h)),k.success("Lead assigned successfully!"),We(),typeof d=="function"&&d({type:"lead_assigned",userName:(t==null?void 0:t.fullName)||"Someone",avatar:(t==null?void 0:t.avatar)||null,action:"assigned lead",entityName:f.fullName,module:"Lead Management"}))}catch(o){console.error("Error assigning lead:",o),k.error(((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to assign lead")}};return e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6",children:[oe?e.jsx(Qa,{className:"py-20"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between border-b border-gray-100 dark:border-gray-800 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Enquiries"}),Wt&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Showing only leads assigned to you"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[U.length>0&&e.jsxs("p",{className:"text-xs text-brand-500 font-medium",children:[U.length," lead(s) selected"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Total: ",de.length," records"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-800/60",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Lead Potential:"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Strong"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Potential"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Weak"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Not a prospect"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"w-full sm:w-56",children:e.jsx(ys,{id:"leadDateFilter",value:_,onChange:a=>le(a),placeholder:"Filter by date range"})}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>w(!Y),startIcon:Y?e.jsx(fs,{className:"size-5"}):e.jsx(xs,{className:"size-5"}),children:Y?"Hide Filters":"Show Filters"}),e.jsx(N,{size:"sm",variant:"outline",onClick:Ca,startIcon:e.jsx(gs,{className:"size-5"}),children:"Import"}),e.jsx(N,{size:"sm",variant:"outline",onClick:Ta,endIcon:e.jsx(ua,{className:"size-5"}),disabled:U.length===0,children:"PDF"})]})]}),Y&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-gray-50/50 dark:bg-white/[0.02] p-4 rounded-xl border border-gray-100 dark:border-gray-800 transition-all duration-300",children:[e.jsx(J,{type:"text",placeholder:"Search by name or phone...",value:x,onChange:a=>C(a.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"}),e.jsx(F,{options:ts,value:c,placeholder:"Sort by date",onChange:a=>D(a)}),e.jsx(F,{options:[{value:"",label:"All Lead Statuses"},...Ze],value:E,placeholder:"Filter by lead status",onChange:a=>W(a)}),e.jsx(F,{options:[{value:"",label:"All Lead Potentials"},...na],value:M,placeholder:"Filter by lead potential",onChange:a=>H(a)}),he&&e.jsx(F,{options:[{value:"",label:"All Users"},{value:"unassigned",label:"Unassigned"},...O.map(a=>({value:a._id,label:a.fullName}))],value:q,placeholder:"Filter by assigned user",onChange:a=>z(a)})]})]}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs(as,{className:"min-w-[1200px]",children:[e.jsx(ss,{className:"border-gray-100 dark:border-gray-800 border-y",children:e.jsxs(Ye,{children:[e.jsx(S,{isHeader:!0,className:"py-3 pl-8 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:de.length>0&&U.length===de.length,onChange:Oa,className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx("div",{className:"size-6 invisible shrink-0"})]})}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Name"}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Date Added"}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Contact Point"}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Campaign"}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Status & Remark"}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Next Follow-up"}),e.jsx(S,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Actions"})]})}),e.jsx(rs,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:de.length===0?e.jsx(Ye,{children:e.jsx(S,{colSpan:10,className:"py-8 text-center text-gray-500",children:Wt?"No leads assigned to you.":"No leads found. Create your first lead!"})}):de.map(a=>{var h,P;const r=vs(a.remarks),o=js(a.remarks),p=Ls(a.leadPotential);return e.jsxs(Ye,{className:"group overflow-hidden transition-colors even:bg-gray-50/40 even:dark:bg-white/[0.01] hover:bg-gray-50/50 dark:hover:bg-white/[0.02]",children:[e.jsxs(S,{className:"py-4 pl-8 relative",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-[6px] ${p.bar}`}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:U.includes(a._id),onChange:()=>Ua(a._id),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),o?e.jsx("div",{className:"size-6 shrink-0 rounded-full bg-red-600 flex items-center justify-center shadow-md",title:"New Remark",children:e.jsx(ca,{className:"size-3.5 text-white"})}):e.jsx("div",{className:"size-6 invisible shrink-0"})]})]}),e.jsx(S,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-theme-sm dark:text-white/90 truncate",children:a.fullName}),e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:((h=a.coursePreference)==null?void 0:h.join(", "))||"N/A"}),e.jsx("p",{className:"text-brand-500/80 text-[11px] font-medium mt-0.5",children:a.phone1})]})}),e.jsx(S,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{children:we(a.createdAt)}),e.jsxs("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:["By: ",a.handledBy||"N/A"]})]})}),e.jsx(S,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{children:a.contactPoint||"N/A"}),((P=a.contactPoint)==null?void 0:P.toLowerCase())==="other"&&a.otherContactPoint&&e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[150px]",children:a.otherContactPoint})]})}),e.jsx(S,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:a.campaign||"N/A"}),e.jsx(S,{className:"py-3",children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Pe,{size:"sm",color:ma(a.leadStatus),children:Ne(a.leadStatus)})}),e.jsxs("div",{className:"relative group/remark","data-row-id":a._id,onMouseEnter:g=>_a(g,a),onMouseLeave:Yt,children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 max-w-[180px] truncate cursor-help leading-relaxed",children:r||"No remarks yet"}),a.assignmentRemark&&e.jsxs("p",{className:"text-[10px] text-red-500 dark:text-red-400 mt-0.5 truncate animate-pulse duration-100",children:["Suggestion: ",a.assignmentRemark]})]})]})}),e.jsx(S,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx(Pe,{size:"sm",color:Es(a.followUpDate),children:_s(a.followUpDate)}),a.assignedTo&&e.jsxs("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:["Assigned To: ",a.assignedTo.fullName]})]})}),e.jsx(S,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{size:"sm",variant:"outline",className:"mr-2",endIcon:e.jsx(ls,{className:"size-5"}),onClick:()=>Zt(a)}),ns(t)&&e.jsx(N,{size:"sm",variant:"outline",className:"text-red-500 mr-2",endIcon:e.jsx(os,{className:"size-5"}),onClick:()=>Ia(a)}),he&&e.jsx(N,{size:"sm",variant:"outline",className:"text-blue-500 mr-2",onClick:()=>Wa(a),children:"Assign"}),e.jsx(N,{size:"sm",variant:"outline",className:"text-yellow-500",title:"Follow-up Alarm",endIcon:e.jsx(ca,{className:"size-5"}),onClick:()=>Ma(a)})]})})]},a._id)})})]})}),L&&Le&&es.createPortal((()=>{const a=de.find(o=>o._id===L);if(!a||!a.remarks||a.remarks.length===0)return null;const r=T.transform.includes("-100%")||T.transform==="translateY(-10px)";return e.jsxs("div",{ref:ha,className:`fixed w-96 max-w-[90vw] bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 z-[100000] transition-all duration-200 ${Le?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{top:`${T.top}px`,left:`${T.left}px`,maxHeight:`${T.maxHeight}px`,transform:`${T.transform} ${Le?"scale(1)":"scale(0.95)"}`},onMouseEnter:()=>{K.current&&clearTimeout(K.current)},onMouseLeave:Yt,children:[T.arrowLeft>0&&e.jsx("div",{className:`absolute ${r?"bottom-0":"top-0"} left-0 w-0 h-0`,style:{left:`${T.arrowLeft}px`,transform:r?"translateY(100%) translateX(-50%)":"translateY(-100%) translateX(-50%)"},children:e.jsx("div",{className:`w-0 h-0 border-l-[8px] border-r-[8px] ${r?"border-t-[8px] border-t-white dark:border-t-gray-800 border-l-transparent border-r-transparent":"border-b-[8px] border-b-white dark:border-b-gray-800 border-l-transparent border-r-transparent"}`,style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"}})}),e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10 rounded-t-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:"Remark History"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.remarks.length," remark",a.remarks.length!==1?"s":""]})]}),e.jsx("div",{className:"overflow-y-auto p-3 space-y-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-700 hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-gray-600",style:{maxHeight:`${T.maxHeight-60}px`},children:[...a.remarks].reverse().map((o,p)=>e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-900 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-800 dark:text-white",children:o.handledBy||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.updatedOn?new Date(o.updatedOn).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{size:"sm",color:ma(o.leadStatus||"new"),children:Ne(o.leadStatus||"new")}),o.isUnread&&e.jsx("span",{className:"text-xs text-red-500 dark:text-red-400",children:"Unread"})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words",children:o.remark||"No remarks"}),o.nextFollowUpDate&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:["Next Follow-up: ",new Date(o.nextFollowUpDate).toLocaleDateString()]})]},p))})]})})(),document.body),e.jsxs(be,{isOpen:ga,onClose:Ee,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[1480px] p-6 lg:p-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"mb-2 font-semibold text-gray-800 dark:text-white/90 modal-title text-theme-xl lg:text-2xl",children:"Edit Lead"}),e.jsx("button",{onClick:Ee,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(J,{type:"text",id:"firstName",value:rt,onChange:a=>nt(a.target.value),disabled:!ye(t)&&!I(t)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Email"}),e.jsx(J,{type:"email",value:lt,error:jt,onChange:Aa,placeholder:"Enter email",hint:jt?"This is an invalid email address.":"",disabled:!ye(t)&&!I(t)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Phone *"}),e.jsx(la,{selectPosition:"end",countries:oa,placeholder:"+91 98765 43210",value:ht,onChange:gt,disabled:!ye(t)&&!I(t)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Phone (optional)"}),e.jsx(la,{selectPosition:"end",countries:oa,placeholder:"+91 98765 43210",value:ft,onChange:yt})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Gender"}),e.jsx(F,{options:is,value:bt,placeholder:"Select Gender",onChange:vt})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(da,{id:"dob",label:"DoB",placeholder:"Select a date",value:it,onChange:(a,r)=>dt(r)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Place *"}),e.jsx(F,{options:Ge,value:Oe,placeholder:"Select Place",onChange:ct})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(J,{type:"text",id:"otherPlace",value:ut,onChange:a=>mt(a.target.value),disabled:Oe!=="Other"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Current Status"}),e.jsx(F,{options:ds,value:xt,placeholder:"Select Status",onChange:pt})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Education *"}),e.jsx(F,{options:Je,value:Te,placeholder:"Select Education",onChange:Nt})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(J,{type:"text",id:"otherEducation",value:wt,onChange:a=>kt(a.target.value),disabled:Te!=="Other"})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Contact Point"}),e.jsx(F,{options:I(t)?De:De.filter(a=>a.value!=="__add_new__"),value:He,onChange:Ct,disabled:!I(t)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{htmlFor:"otherContactPoint",children:"Specify other"}),e.jsx(J,{type:"text",id:"otherContactPoint",value:St,onChange:a=>Pt(a.target.value),disabled:He!=="other"})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:e.jsx("div",{className:"w-full",children:e.jsx(cs,{label:"Course Preference",options:xe,selectedValues:Lt,onChange:Et})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Campaign"}),e.jsx(F,{options:v,value:Dt,placeholder:"Campaigns",onChange:Ra,disabled:!I(t)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Lead Status *"}),e.jsx(F,{id:"leadStatus",label:"Lead Status",options:Ze,value:Q,onChange:a=>{_t(a),(a==="converted"||a==="lost")&&Re("")},required:!0})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(y,{children:"Lead Potential *"}),e.jsx(F,{options:na,value:Be,placeholder:"Select Lead Potential",onChange:Ft})]}),Q!=="converted"&&Q!=="lost"&&e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(da,{id:"followupDate",label:"Next Follow Up Date *",value:$e,disablePastDates:!0,onChange:(a,r)=>Re(r)})})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:e.jsxs("div",{className:"w-full",children:[e.jsx(y,{htmlFor:"remarks",children:"Remarks *"}),e.jsx(J,{type:"text",id:"remarks",value:Ie,onChange:a=>Me(a.target.value)})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(N,{variant:"outline",onClick:Ee,children:"Cancel"}),e.jsx(N,{variant:"primary",onClick:Ha,loading:La,children:"Update"})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(us,{title:"History & Remarks",children:e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-700 hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-gray-600",children:f!=null&&f.remarks&&f.remarks.length>0?[...f.remarks].reverse().map((a,r)=>e.jsx(bs,{name:a.handledBy||(t==null?void 0:t.fullName)||"Unknown",datetime:a.updatedOn?new Date(a.updatedOn).toLocaleString():"N/A",callback:a.nextFollowUpDate?new Date(a.nextFollowUpDate).toLocaleDateString():"",note:a.remark||"No remarks",status:Ne(a.leadStatus||"new")},r)):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"No history available yet."}),e.jsx("p",{className:"text-sm mt-2",children:"Remarks and updates will appear here."})]})})})})]})]}),e.jsxs(be,{isOpen:ya,onClose:_e,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[700px] p-6 lg:p-10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Confirm Delete"}),e.jsxs("p",{children:["Are you sure you want to delete enquiry ",e.jsx("strong",{children:f==null?void 0:f.name}),"?"]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(N,{variant:"outline",onClick:()=>{_e(),Se()},children:" Cancel"}),e.jsx(N,{variant:"danger",onClick:za,children:"Delete"})]})]}),e.jsxs(be,{isOpen:va,onClose:Fe,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[700px] p-6 lg:p-10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Set Follow-up Reminder"}),e.jsxs("p",{children:["Set a reminder for ",e.jsx("strong",{children:f==null?void 0:f.fullName})," on ",f?we(f.followUpDate):"","."]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(N,{variant:"outline",onClick:()=>{Fe(),Se()},children:"Close"}),e.jsx(N,{variant:"warning",onClick:$a,children:"Set Reminder"})]})]}),e.jsxs(be,{isOpen:Na,onClose:Ae,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(J,{id:"newCampaignName",type:"text",value:At,onChange:a=>Ut(a.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:Ot,onChange:a=>Tt(a.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 shadow-theme-xs"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(J,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:It,onChange:a=>Mt(a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{htmlFor:"newCampaignCashback",children:"Cashback (₹)"}),e.jsx(J,{id:"newCampaignCashback",type:"number",min:"0",value:Ht,onChange:a=>zt(a.target.value),placeholder:"0"})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:$t,onChange:a=>Rt(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(y,{htmlFor:"newCampaignActive",className:"mb-0",children:"Active"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(N,{variant:"outline",onClick:Ae,children:"Cancel"}),e.jsx(N,{variant:"primary",onClick:Ba,children:"Create Campaign"})]})]})]}),e.jsxs(be,{isOpen:ka,onClose:Ue,className:"max-w-xl p-0 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90",children:"Import Leads"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Upload a CSV file to bulk import your leads into the system."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-brand-50/50 dark:bg-brand-500/5 p-4 rounded-xl border border-brand-100 dark:border-brand-500/20 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-brand-700 dark:text-brand-400",children:"Step 1: Get the template"}),e.jsx("p",{className:"text-xs text-brand-600/80 dark:text-brand-400/60 mt-0.5",children:"Use our CSV template to ensure correct data formatting."})]}),e.jsx(N,{size:"sm",variant:"outline",className:"bg-white dark:bg-gray-900",onClick:()=>{const o="data:text/csv;charset=utf-8,"+[["Full Name","Phone","Email","Place","Education","Course Preference","Contact Point","Campaign","Next Follow Up Date","Remarks","Lead Potential"],...[["John Doe","9876543210","john@example.com","New York","Bachelor's","Python;Java","Website","Summer 2024","2024-07-15","Interested in backend","strongProspect"],["Jane Smith","9123456789","jane@test.com","London","Master's","AWS","LinkedIn","Winter Sale","2024-07-20","Wants to switch career","potentialProspect"]]].map(P=>P.join(",")).join(`
`),p=encodeURI(o),h=document.createElement("a");h.setAttribute("href",p),h.setAttribute("download","lead_import_template.csv"),document.body.appendChild(h),h.click(),document.body.removeChild(h)},children:"Download Sample"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Step 2: Upload your file"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-2xl p-10 flex flex-col items-center justify-center text-center hover:border-brand-300 dark:hover:border-brand-800 transition-colors cursor-pointer group",onClick:()=>document.getElementById("csv-upload").click(),children:[e.jsx("div",{className:"size-12 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center mb-4 group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10 transition-colors",children:e.jsx(ua,{className:"size-6 text-gray-400 group-hover:text-brand-500 rotate-180"})}),e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Only CSV files are supported (max 5MB)"}),e.jsx("input",{type:"file",id:"csv-upload",className:"hidden",accept:".csv",onChange:a=>{const r=a.target.files[0];if(r){if(r.type!=="text/csv"&&!r.name.endsWith(".csv")){k.error("Please upload a valid CSV file");return}k.info(`Processing ${r.name}...`)}}})]})]}),e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-white/[0.02] rounded-xl border border-gray-100 dark:border-gray-800",children:[e.jsx("div",{className:"size-5 rounded-full bg-blue-500 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[10px] text-white font-bold",children:"i"})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Ensure dates are in YYYY-MM-DD format."}),e.jsx("li",{children:'"Full Name" and "Phone" are required fields.'}),e.jsx("li",{children:'"Course Preference" can be multiple items separated by semi-colons.'})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-white/[0.02] border-t border-gray-100 dark:border-gray-800 flex items-center justify-end gap-3",children:[e.jsx(N,{variant:"outline",onClick:Ue,children:"Cancel"}),e.jsx(N,{variant:"primary",onClick:()=>{if(document.getElementById("csv-upload").files.length===0){k.error("Please select a file first");return}k.success("Lead import started! This may take a few moments."),Ue()},children:"Confirm Import"})]})]}),e.jsxs(be,{isOpen:Va,onClose:We,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Assign Lead"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"assignToUser",children:"Assign To"}),e.jsx(F,{options:O.map(a=>({value:a._id,label:a.fullName})),value:Ve,placeholder:"Select User",onChange:Jt})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"assignmentRemark",children:"Assignment Remark (Optional)"}),e.jsx("textarea",{id:"assignmentRemark",value:Xt,onChange:a=>Kt(a.target.value),placeholder:"Add a remark for the assignment...",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(N,{variant:"outline",onClick:We,children:"Cancel"}),e.jsx(N,{onClick:Ya,children:"Assign Lead"})]})]})]})]}),e.jsx(ms,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{Bs as R};
