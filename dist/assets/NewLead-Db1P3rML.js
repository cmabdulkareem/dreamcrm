import{r,A as ta,D as sa,a as ra,u as na,w as _e,b as h,c as p,f as S,V as la,W as ia,j as e,P as oa,E as ca,C as Oe,x as i,I as c,X as Ae,Y as Fe,H as m,Z as da,_ as ua,$ as ma,a0 as ha,a1 as pa,a2 as xa,B as x,M as Le,n as ga,y as d}from"./index-BNEGGE57.js";import{D as Me}from"./date-picker-BeppTpDh.js";import"./index-B_JH6AFf.js";import"./calender-line-DQbsZUHO.js";function ja(){const{user:o}=r.useContext(ta),{addEvent:Re}=sa(),Ie=ra(),{addNotification:$e,areToastsEnabled:Be}=na(),[j,V]=r.useState(!1),[g,k]=r.useState(""),[f,D]=r.useState(""),[N,W]=r.useState(""),[Z,H]=r.useState(""),[T,J]=r.useState(""),[K,X]=r.useState(""),[C,Y]=r.useState("Kasaragod"),[y,Q]=r.useState(""),[E,ee]=r.useState(""),[b,ae]=r.useState(""),[q,te]=r.useState(""),[_,se]=r.useState(["General"]),[t,O]=r.useState(""),[w,re]=r.useState(""),[A,F]=r.useState(""),[L,ne]=r.useState(""),[v,le]=r.useState(""),[M,ie]=r.useState(""),[oe,R]=r.useState(!1),[Ge,ce]=r.useState([]),[ze,de]=r.useState([]),[Ue,ue]=r.useState([]),[n,me]=r.useState({}),{isOpen:Ve,openModal:We,closeModal:I}=_e(),[$,he]=r.useState(""),[pe,xe]=r.useState(""),[B,ge]=r.useState(""),[G,fe]=r.useState(""),[Ce,we]=r.useState(!0),{isOpen:Ze,openModal:He,closeModal:z}=_e(),[U,ve]=r.useState(""),[je,Ne]=r.useState(""),[ye,be]=r.useState(!0);r.useEffect(()=>{const a=sessionStorage.getItem("prefillLeadData");if(a){const{fullName:s,email:l}=JSON.parse(a);k(s||""),D(l||""),sessionStorage.removeItem("prefillLeadData")}Pe(),Se(),Te()},[]);const Te=async()=>{try{const s=(await h.get(`${p}/course-categories/all`,{withCredentials:!0})).data.categories.filter(l=>l.isActive).map(l=>({value:l.name,label:l.name}));ue(s)}catch(a){console.error("Error fetching course categories:",a),ue([{value:"General",label:"General"}])}},Pe=async()=>{try{const s=(await h.get(`${p}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(l=>({value:l.value,label:l.name}));S(o)&&s.push({value:"__add_new__",label:"+ Add New Campaign"}),ce(s)}catch(a){console.error("Error fetching campaigns:",a);const s=[...la];S(o)&&s.push({value:"__add_new__",label:"+ Add New Campaign"}),ce(s)}},Se=async()=>{try{const s=(await h.get(`${p}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(l=>({value:l.value,label:l.name}));s.push({value:"other",label:"Other"}),S(o)&&s.push({value:"__add_new__",label:"+ Add New Contact Point"}),de(s)}catch(a){console.error("Error fetching contact points:",a);const s=[...ia];S(o)&&s.push({value:"__add_new__",label:"+ Add New Contact Point"}),de(s)}},ke=a=>{if(!a||!a.trim())return R(!1),!0;const s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a);return R(!s),s},Je=a=>{const s=a.target.value;D(s),ke(s)},Ke=a=>{a==="__add_new__"?We():F(a)},Xe=a=>{a==="__add_new__"?He():O(a)},Ye=async()=>{var a,s;if(!$.trim()){d.error("Campaign name is required");return}try{const l=await h.post(`${p}/campaigns/create`,{name:$,description:pe,discountPercentage:B?parseFloat(B):0,cashback:G?parseFloat(G):0,isActive:Ce},{withCredentials:!0});d.success("Campaign created successfully!"),F(l.data.campaign.value),await Pe(),I(),he(""),xe(""),ge(""),fe(""),we(!0)}catch(l){console.error("Error creating campaign:",l),d.error(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create campaign")}},Qe=async()=>{var a,s;if(!U.trim()){d.error("Contact point name is required");return}try{const l=await h.post(`${p}/contact-points/create`,{name:U,description:je,isActive:ye},{withCredentials:!0});d.success("Contact point created successfully!"),O(l.data.contactPoint.value),await Se(),z(),ve(""),Ne(""),be(!0)}catch(l){console.error("Error creating contact point:",l),d.error(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create contact point")}},ea=()=>{const a={};return g.trim()||(a.fullName="Full Name is required"),f.trim()&&!ke(f)&&(a.email="Please enter a valid email address"),N.trim()||(a.phone1="Phone is required"),C?C==="Other"&&!y.trim()&&(a.otherPlace="Please specify the place"):a.place="Place is required",E||(a.status="Current Status is required"),b?b==="Other"&&!q.trim()&&(a.otherEducation="Please specify the education"):a.education="Education is required",_.length===0&&(a.coursePreference="Course preference is required"),t||(a.contactPoint="Contact point is required"),(t==="other"||(t==null?void 0:t.toLowerCase())==="reference"||(t==null?void 0:t.toLowerCase())==="referance")&&!w.trim()&&(a.otherContactPoint="Please specify details"),A||(a.campaign="Campaign is required"),v||(a.followUpDate="Next follow up date is required"),L.trim()||(a.leadRemarks="Remarks are required"),M||(a.leadPotential="Lead Potential is required"),me(a),Object.keys(a).length===0},De=()=>{k(""),D(""),W(""),H(""),J(""),X(""),Y(""),Q(""),ee(""),ae(""),te(""),se(["General"]),O(""),re(""),F(""),ne(""),le(""),ie(""),R(!1),me({})},aa=async a=>{var l,Ee,qe;if(a.preventDefault(),j)return;if(!ea()){d.error("Please fill in all required fields");return}V(!0);const s={fullName:g,email:f.trim()||null,phone1:N,phone2:Z,gender:T,dob:K,place:C==="Other"?y:C,otherPlace:y,status:E,education:b,otherEducation:q,coursePreference:_,contactPoint:t,otherContactPoint:t==="other"||(t==null?void 0:t.toLowerCase())==="reference"||(t==null?void 0:t.toLowerCase())==="referance"?w:"",campaign:A,handledBy:(o==null?void 0:o.fullName)||"Unknown",leadRemarks:L,followUpDate:v,leadPotential:M};try{const u=await h.post(`${p}/customers/create`,s,{withCredentials:!0});if(u.status===201){if(v)try{const P=v;Re({title:`Follow-up: ${g}`,start:P,end:P,allDay:!0,extendedProps:{calendar:"Warning",leadId:u.data.customer._id,phone:N,email:f,status:u.data.customer.leadStatus||"new"}})}catch(P){console.error("Error creating calendar event:",P)}$e({type:"lead_created",userName:(o==null?void 0:o.fullName)||"Someone",avatar:(o==null?void 0:o.avatar)||null,action:"added new lead",entityName:g,module:"Lead Management"}),Be()&&d.success("Lead created successfully!",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),De(),Ie("/lead-management")}}catch(u){console.error("Error creating lead:",u),((l=u.response)==null?void 0:l.status)===401?d.error("Please login to create a lead."):d.error(((qe=(Ee=u.response)==null?void 0:Ee.data)==null?void 0:qe.message)||"Failed to create lead. Please try again.")}finally{V(!1)}};return e.jsxs("div",{children:[e.jsx(oa,{title:"New Lead | DreamCRM",description:"Add new enquiry here"}),e.jsx(ca,{pageTitle:"New Enquiry"}),e.jsxs("form",{onSubmit:aa,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(Oe,{title:"Basic Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{htmlFor:"firstName",required:!0,children:"Full Name"}),e.jsx(c,{type:"text",id:"firstName",value:g,onChange:a=>k(a.target.value),error:!!n.fullName,hint:n.fullName})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{children:"Email"}),e.jsx(c,{type:"email",id:"new-lead-email",value:f,error:oe||!!n.email,onChange:Je,placeholder:"Enter your email (optional)",hint:n.email||(oe?"This is an invalid email address.":"")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{required:!0,children:"Phone"}),e.jsx(Ae,{id:"new-lead-phone",selectPosition:"end",countries:Fe,placeholder:"+91 98765 43210",value:N,onChange:W,error:!!n.phone1,hint:n.phone1})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{children:"Phone (optional)"}),e.jsx(Ae,{selectPosition:"end",countries:Fe,placeholder:"+91 98765 43210",value:Z,onChange:H})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(i,{children:"Gender"}),e.jsx(m,{options:da,value:T,placeholder:"Select Gender",onChange:J})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Me,{id:"dob",label:"DoB",value:K,onChange:(a,s)=>X(s)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(i,{required:!0,children:"Place"}),e.jsx(m,{options:ua,value:C,placeholder:"Select Place",onChange:Y,error:!!n.place,hint:n.place})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(i,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(c,{type:"text",id:"otherPlace",value:y,onChange:a=>Q(a.target.value),placeholder:"Specify details"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(i,{required:!0,children:"Current Status"}),e.jsx(m,{options:ma,value:E,placeholder:"Select Status",onChange:ee,error:!!n.status,hint:n.status})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(i,{required:!0,children:"Education"}),e.jsx(m,{options:ha,value:b,placeholder:"Select Education",onChange:ae,error:!!n.education,hint:n.education})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(i,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(c,{type:"text",id:"otherEducation",value:q,onChange:a=>te(a.target.value),placeholder:"Specify details"})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(Oe,{title:"Enquiry / Lead Information",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(pa,{label:"Course Preference",required:!0,id:"new-lead-course-preference",options:Ue,selectedValues:_,onChange:se,error:!!n.coursePreference,hint:n.coursePreference})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(i,{required:!0,children:"Contact Point"}),e.jsx(m,{options:ze,value:t,placeholder:"Contact Point",onChange:Xe,error:!!n.contactPoint,hint:n.contactPoint})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(i,{htmlFor:"otherContactPoint",required:t==="other"||(t==null?void 0:t.toLowerCase())==="reference"||(t==null?void 0:t.toLowerCase())==="referance",children:"Specify other"}),e.jsx(c,{type:"text",id:"otherContactPoint",value:w,onChange:a=>re(a.target.value),disabled:t!=="other"&&(t==null?void 0:t.toLowerCase())!=="reference"&&(t==null?void 0:t.toLowerCase())!=="referance",error:(t==="other"||(t==null?void 0:t.toLowerCase())==="reference"||(t==null?void 0:t.toLowerCase())==="referance")&&!w.trim()&&!!n.otherContactPoint,hint:(t==="other"||(t==null?void 0:t.toLowerCase())==="reference"||(t==null?void 0:t.toLowerCase())==="referance")&&!w.trim()?n.otherContactPoint:""})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(i,{required:!0,children:"Campaign"}),e.jsx(m,{options:Ge,value:A,placeholder:"Campaigns",id:"new-lead-campaign",onChange:Ke,error:!!n.campaign,hint:n.campaign})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsx(Me,{id:"followupDate",label:"Next Follow Up Date",required:!0,value:v,disablePastDates:!0,onChange:(a,s)=>le(s),error:!!n.followUpDate,hint:n.followUpDate})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(i,{htmlFor:"leadRemarks",required:!0,children:"Remarks"}),e.jsx(c,{type:"text",id:"leadRemarks",value:L,onChange:a=>ne(a.target.value),error:!!n.leadRemarks,hint:n.leadRemarks})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx(i,{required:!0,children:"Lead Potential"}),e.jsx(m,{options:xa,value:M,placeholder:"Select Lead Potential",onChange:ie,error:!!n.leadPotential,hint:n.leadPotential})]})})]})})})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-6",children:[e.jsx(x,{type:"button",onClick:De,variant:"outline",disabled:j,children:"Clear"}),e.jsx(x,{variant:"primary",type:"submit",disabled:j,id:"new-lead-submit-btn",children:j?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"})]})]}),e.jsxs(Le,{isOpen:Ve,onClose:I,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(c,{id:"newCampaignName",type:"text",value:$,onChange:a=>he(a.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:pe,onChange:a=>xe(a.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(c,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:B,onChange:a=>ge(a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"newCampaignCashback",children:"Cashback (â‚¹)"}),e.jsx(c,{id:"newCampaignCashback",type:"number",min:"0",value:G,onChange:a=>fe(a.target.value),placeholder:"0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:Ce,onChange:a=>we(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(i,{htmlFor:"newCampaignActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active campaigns will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:I,children:"Cancel"}),e.jsx(x,{type:"button",onClick:Ye,children:"Create Campaign"})]})]})]}),e.jsxs(Le,{isOpen:Ze,onClose:z,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Contact Point"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newContactPointName",children:"Contact Point Name *"}),e.jsx(c,{id:"newContactPointName",type:"text",value:U,onChange:a=>ve(a.target.value),placeholder:"e.g., Walk In"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newContactPointDesc",children:"Description"}),e.jsx("textarea",{id:"newContactPointDesc",value:je,onChange:a=>Ne(a.target.value),placeholder:"Contact point description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newContactPointActive",checked:ye,onChange:a=>be(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(i,{htmlFor:"newContactPointActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active contact points will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:z,children:"Cancel"}),e.jsx(x,{type:"button",onClick:Qe,children:"Create Contact Point"})]})]})]}),e.jsx(ga,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{ja as default};
