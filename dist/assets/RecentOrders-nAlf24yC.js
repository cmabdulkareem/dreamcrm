const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-CkwwK0Cl.js","assets/index-BRRNp47y.js","assets/index.DwceQDK3.css"])))=>i.map(i=>d[i]);
import{r,j as e,z as N,v as ve,a2 as nt,a3 as ba,c as B,d as I,h as F,Z as lt,$ as ot,V as it,a4 as ms,y as k,A as us,F as xs,u as ps,x as Ue,i as be,n as hs,E as gs,B as v,a5 as ja,I as Q,K as _,a6 as fs,a1 as va,T as ys,p as bs,q as at,s as D,t as js,w as Na,S as ka,a7 as wa,M as je,W as Ca,X as Sa,Y as vs,_ as Ns,a0 as ks,C as ws,o as Cs,U as Pa}from"./index-BRRNp47y.js";import{P as Ss}from"./papaparse.min-BTrlYlEl.js";import{S as Ps}from"./file-Bn9R9aj5.js";import{S as Ds}from"./chevron-down-2NhGbJfV.js";import{f as Ls,D as Da}from"./date-picker-DxGeXKuS.js";import{S as Es}from"./calender-line-CMLkAvQj.js";const ze=a=>r.createElement("svg",{className:"size-6",width:"1em",height:"1em",viewBox:"0 0 24 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},r.createElement("path",{d:"M12.814 4.75L4.78516 16.0352H11.1859L11.1859 23.25L19.2148 11.9648L12.814 11.9648V4.75Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),As=a=>r.createElement("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},r.createElement("path",{d:"M15.8333 12.7083L10.6249 7.5L5.41658 12.7083",stroke:"currentColor",strokeWidth:1.25,strokeLinecap:"round",strokeLinejoin:"round"}));function _s({id:a,onChange:o,label:d,value:c,placeholder:p="Select date range",className:m=""}){const f=r.useRef(null);return r.useEffect(()=>(f.current=Ls(`#${a}-wrapper`,{mode:"range",appendTo:window.document.body,monthSelectorType:"static",dateFormat:"Y-m-d",wrap:!0,allowInput:!0,defaultDate:c,onChange:(y,P)=>{o&&o(y,P)}}),()=>{f.current&&(f.current.destroy(),f.current=null)}),[a]),r.useEffect(()=>{f.current&&c!==void 0&&f.current.setDate(c,!1)},[c]),e.jsxs("div",{className:"w-full",children:[d&&e.jsx(N,{htmlFor:a,children:d}),e.jsxs("div",{className:"relative",id:`${a}-wrapper`,children:[e.jsx("input",{id:a,placeholder:p,"data-input":!0,readOnly:!0,className:`h-9 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2 text-sm text-gray-800 shadow-theme-xs transition-colors placeholder:text-gray-400 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/20 focus:outline-none dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 ${m}`}),e.jsx("span",{"data-toggle":!0,className:"absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-500 transition-colors hover:text-brand-500 dark:text-gray-400",children:e.jsx(Es,{className:"size-6"})})]})]})}const Fs=({name:a,datetime:o,callback:d,note:c,status:p})=>{const m=f=>{const y=(f==null?void 0:f.toLowerCase())||"";return y.includes("converted")||y==="qualified"?"success":y.includes("negotiation")||y.includes("contacted")?"info":y.includes("call")||y==="new"?"warning":y.includes("lost")||y.includes("not interested")?"error":"light"};return e.jsxs("div",{className:"rounded-lg border border-gray-50 bg-gray-100 p-4 dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-white",children:a}),e.jsx("span",{children:o}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:e.jsx(ve,{size:"sm",color:m(p),children:p||"N/A"})})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-200",children:c}),d&&e.jsxs("div",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:["Next Follow-up: ",d]})]})},ke=a=>a?new Date(a).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"N/A",Ne=a=>{if(!a)return"New Lead";const o=nt.find(d=>d.value===a);return o?o.label:a},st=a=>a==="converted"||a==="qualified"?"success":a==="negotiation"||a==="contacted"?"info":a==="callBackLater"||a==="new"?"warning":a==="lost"||a==="notInterested"?"error":"light",La=a=>a&&a.length>0?a[a.length-1].remark:"No remarks yet",Ea=(a,o)=>!a||a.length===0?!1:a.some(d=>d.isUnread),Us=async(a,o,d)=>{if(a.length===0){d.warning("Please select at least one lead to download.");return}try{const c=(await ba(async()=>{const{default:u}=await import("./jspdf.es.min-CkwwK0Cl.js").then(E=>E.j);return{default:u}},__vite__mapDeps([0,1,2]))).default,p=(await ba(async()=>{const{default:u}=await import("./jspdf.plugin.autotable-Ctn9oCMc.js");return{default:u}},[])).default,m=new c("landscape");m.setFontSize(18),m.text("Lead Report",14,20),m.setFontSize(10),m.text(`Generated on: ${new Date().toLocaleDateString("en-IN")}`,14,28);const y=o.filter(u=>a.includes(u._id)).map(u=>{const E=u.remarks&&u.remarks.length>0?u.remarks[u.remarks.length-1].remark:"No remarks";return[u.fullName,ke(u.createdAt),u.phone1,u.contactPoint||"N/A",u.campaign||"N/A",Ne(u.leadStatus),E.substring(0,30)+(E.length>30?"...":""),ke(u.followUpDate)]});p(m,{head:[["Name","Date Added","Mobile","Contact Point","Campaign","Lead Status","Latest Remark","Follow-up"]],body:y,startY:35,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[70,95,255],textColor:255},alternateRowStyles:{fillColor:[245,247,250]},margin:{top:35}});const P=m.internal.getNumberOfPages();for(let u=1;u<=P;u++)m.setPage(u),m.setFontSize(8),m.text(`Page ${u} of ${P}`,m.internal.pageSize.getWidth()/2,m.internal.pageSize.getHeight()-10,{align:"center"});m.save(`leads-report-${new Date().toISOString().split("T")[0]}.pdf`),d.success(`PDF downloaded with ${a.length} lead(s)!`)}catch(c){console.error("Error generating PDF:",c),d.error("Failed to generate PDF. Please try again.")}},rt=async(a,o)=>{var d;try{const c=await B.get(`${I}/customers/all`,{withCredentials:!0});return typeof a=="function"&&a(c.data.customers),typeof o=="function"&&o(!1),c.data.customers}catch(c){return console.error("Error fetching customers:",c),typeof o=="function"&&o(!1),((d=c.response)==null?void 0:d.status)===401&&alert("Please login to view leads."),[]}},Aa=async(a,o,d)=>{try{const p=(await B.get(`${I}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(m=>({value:m.value,label:m.name}));return F(d)&&p.push({value:"__add_new__",label:"+ Add New Campaign"}),typeof a=="function"&&a(p),p}catch(c){console.error("Error fetching campaigns:",c);const p=[...o];return F(d)&&p.push({value:"__add_new__",label:"+ Add New Campaign"}),typeof a=="function"&&a(p),p}},Os=async(a,o,d,c,p,m,f,y,P,u,E,ee,ce,$)=>{var G,M;if(!a.trim()){$.error("Campaign name is required");return}try{const V=await B.post(`${I}/campaigns/create`,{name:a,description:o,discountPercentage:d?parseFloat(d):0,cashback:c?parseFloat(c):0,isActive:p},{withCredentials:!0});$.success("Campaign created successfully!"),typeof m=="function"&&m(V.data.campaign.value),typeof f=="function"&&await f(),typeof y=="function"&&y(),typeof P=="function"&&P(""),typeof u=="function"&&u(""),typeof E=="function"&&E(""),typeof ee=="function"&&ee(""),typeof ce=="function"&&ce(!0)}catch(V){console.error("Error creating campaign:",V),$.error(((M=(G=V.response)==null?void 0:G.data)==null?void 0:M.message)||"Failed to create campaign")}},Ts=(a,o)=>{var se;const{setSelectedRow:d,setEditName:c,setEditPhone:p,setEditEmail:m,setEditStatus:f,setEditFollowUp:y,setFullName:P,setEmail:u,setPhone1:E,setPhone2:ee,setGender:ce,setDob:$,setPlace:G,setOtherPlace:M,setStatus:V,setEducation:Z,setOtherEducation:W,setContactPoint:te,setOtherContactPoint:S,setCampaign:ae,setHandledByPerson:fe,setFollowUpDate:ue,setRemarks:C,setLeadStatus:xe,setLeadPotential:q,setSelectedValues:A}=o;if(typeof d=="function"&&d(a),typeof c=="function"&&c(a.fullName),typeof p=="function"&&p(a.phone1),typeof m=="function"&&m(a.email),typeof f=="function"&&f(a.status),typeof y=="function"&&y(a.followUpDate?new Date(a.followUpDate).toISOString().split("T")[0]:""),typeof P=="function"&&P(a.fullName),typeof u=="function"&&u(a.email),typeof E=="function"&&E(a.phone1),typeof ee=="function"&&ee(a.phone2||""),typeof ce=="function"&&ce(a.gender||""),typeof $=="function"&&$(a.dob?new Date(a.dob).toISOString().split("T")[0]:""),typeof G=="function"&&(lt.find(b=>b.value===a.place)||!a.place?G(a.place||""):G("Other")),typeof M=="function"){const x=!lt.some(b=>b.value===a.place);M(a.otherPlace||x&&a.place||"")}typeof V=="function"&&V(a.status||""),typeof Z=="function"&&(ot.find(b=>b.value===a.education)||!a.education?Z(a.education||""):Z("Other")),typeof W=="function"&&(a.education==="Other"?W(a.otherEducation||""):!ot.find(b=>b.value===a.education)&&a.education?W(a.education):W("")),typeof te=="function"&&((o.contactPointOptions||it).find(J=>J.value===a.contactPoint)||!a.contactPoint?te(a.contactPoint||""):te("other")),typeof S=="function"&&(a.contactPoint==="other"?S(a.otherContactPoint||""):!(o.contactPointOptions||it).find(J=>J.value===a.contactPoint)&&a.contactPoint?S(a.contactPoint):S("")),typeof ae=="function"&&ae(a.campaign||""),typeof fe=="function"&&fe(a.handledBy||""),typeof ue=="function"&&(a.leadStatus==="converted"||a.leadStatus==="lost"?ue(""):ue(a.followUpDate?new Date(a.followUpDate).toISOString().split("T")[0]:"")),typeof C=="function"&&C(""),typeof xe=="function"&&xe(a.leadStatus||""),typeof q=="function"&&q(a.leadPotential||"");const ye=((se=a.coursePreference)==null?void 0:se.map(x=>{const b=o.courseOptions||ms;if(typeof x=="string"){if(b.some(me=>me.value===x))return x;const pe=b.find(me=>me.label===x);return pe?pe.value:x}return x}))||[];typeof A=="function"&&A(ye)},zs=async(a,o,d,c,p,m,f,y,P,u,E,ee,ce,$,G,M,V,Z,W,te,S,ae,fe,ue,C,xe,q,A,ye,se,x)=>{try{let b=a;const J=o.trim(),pe=(a==null?void 0:a.leadStatus)!==d;if(J||pe){const re={remark:J?o:`Status changed to ${fe(d||"new")}`,handledBy:(S==null?void 0:S.fullName)||"Unknown",nextFollowUpDate:d==="converted"?null:W||null,leadStatus:d||"new"},L=await B.post(`${I}/customers/remark/${a._id}`,re,{withCredentials:!0});L.data.customer&&(b=L.data.customer)}const me={fullName:p,phone1:m,phone2:f,email:y,gender:P,dob:u,place:E,status:ce,education:$,otherEducation:G,contactPoint:M,otherContactPoint:M==="other"?V:"",campaign:Z,handledBy:(S==null?void 0:S.fullName)||ae,followUpDate:d==="converted"?null:W,leadStatus:d,leadPotential:c,coursePreference:te},we=await B.put(`${I}/customers/update/${a._id}`,me,{withCredentials:!0});if(d==="converted")try{const U=xe.find(re=>{var L;return((L=re.extendedProps)==null?void 0:L.leadId)===a._id})}catch(U){console.error("Error managing calendar event:",U)}else if(W)try{const U=xe.find(Ce=>{var Se;return((Se=Ce.extendedProps)==null?void 0:Se.leadId)===a._id}),re=W,L={title:`Follow-up: ${p}`,start:re,end:re,allDay:!0,extendedProps:{calendar:"Warning",leadId:a._id,phone:m,email:y,status:d||"new"}};U?C(U.id,L):ue(L)}catch(U){console.error("Error managing calendar event:",U)}return typeof q=="function"&&await q(),we.data.customer?typeof A=="function"&&A(we.data.customer):typeof A=="function"&&A(b),typeof ye=="function"&&ye(""),typeof se=="function"&&se({type:"lead_updated",userName:(S==null?void 0:S.fullName)||"Someone",avatar:(S==null?void 0:S.avatar)||null,action:"updated lead",entityName:p,module:"Lead Management"}),typeof x=="function"&&x()&&k.success("Updated lead status",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),!0}catch(b){return console.error("Error updating lead:",b),typeof x=="function"&&x()&&k.error("Failed to update lead. Please try again.",{position:"top-center",autoClose:3e3}),!1}},Is=async(a,o,d,c,p,m,f,y)=>{if(!o){y.error("Only managers can delete leads.",{position:"top-center",autoClose:3e3}),typeof d=="function"&&d();return}try{await B.delete(`${I}/customers/delete/${a._id}`,{withCredentials:!0}),typeof p=="function"&&p(P=>P.filter(u=>u._id!==a._id)),typeof d=="function"&&d(),typeof c=="function"&&c(),typeof m=="function"&&m({type:"lead_deleted",userName:a.handledBy||"Someone",avatar:a.avatar||null,action:"deleted lead",entityName:a.fullName,module:"Lead Management"}),typeof f=="function"&&f()&&y.success("Lead deleted successfully!",{position:"top-center",autoClose:3e3})}catch(P){console.error("Error deleting lead:",P),typeof f=="function"&&f()&&y.error("Failed to delete lead. Please try again.",{position:"top-center",autoClose:3e3})}},$s=async(a,o,d,c,p)=>{if(!(a!=null&&a.followUpDate)){p.error("No follow-up date set for this lead."),typeof o=="function"&&o();return}try{const f=new Date(a.followUpDate).toISOString().split("T")[0];typeof c=="function"&&c({title:`Follow-up: ${a.fullName}`,start:f,end:f,allDay:!0,extendedProps:{calendar:"Warning",leadId:a._id,phone:a.phone1,email:a.email,status:a.status}}),p.success(`Calendar reminder added for ${a.fullName}!`),typeof o=="function"&&o(),typeof d=="function"&&d()}catch(m){console.error("Error creating calendar event:",m),p.error("Failed to create calendar event.")}},Ms=async(a,o)=>{try{return(await B.put(`${I}/customers/mark-remark-read/${a}/${o}`,{},{withCredentials:!0})).data.customer}catch(d){throw console.error("Error marking remark as read:",d),d}},_a=a=>{switch(a){case"strongProspect":return{bar:"bg-green-500"};case"potentialProspect":return{bar:"bg-blue-500"};case"weakProspect":return{bar:"bg-orange-500"};case"notAProspect":return{bar:"bg-gray-400"};default:return{bar:"bg-transparent"}}},Fa=a=>{if(!a)return"light";const o=new Date;o.setHours(0,0,0,0);const d=new Date(o);d.setDate(d.getDate()+1);const c=new Date(o);c.setDate(c.getDate()+2);const p=new Date(a);return p.setHours(0,0,0,0),p<=o?"error":p.getTime()===d.getTime()?"warning":p.getTime()===c.getTime()?"success":"light"},Ua=a=>a?ke(a):"No Date";function er(){var fa;const{user:a,selectedBrand:o}=r.useContext(us),{addEvent:d,events:c,updateEvent:p}=xs(),{addNotification:m,areToastsEnabled:f}=ps(),[y,P]=r.useState(""),[u,E]=r.useState("followup_latest"),[ee,ce]=r.useState(""),[$,G]=r.useState(""),[M,V]=r.useState(""),[Z,W]=r.useState(""),[te,S]=r.useState(""),[ae,fe]=r.useState(!1),ue=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,0);return[s,n]},[C,xe]=r.useState(ue()),[q,A]=r.useState([]),[ye,se]=r.useState(!0),[x,b]=r.useState(null),[J,pe]=r.useState([]),[me,we]=r.useState([]),[U,re]=r.useState([]),[L,Ce]=r.useState([]),[Se,Oa]=r.useState([]),[Pe,dt]=r.useState(null),[ne,ct]=r.useState({top:0,left:0,arrowLeft:0}),[Ie,mt]=r.useState(!1),le=r.useRef(null),Ta=r.useRef(null),{isOpen:za,openModal:Ia,closeModal:$e}=Ue(),{isOpen:$a,openModal:Ma,closeModal:Me}=Ue(),{isOpen:Ha,openModal:Ra,closeModal:He}=Ue(),{isOpen:Ba,openModal:Va,closeModal:Re}=Ue(),{isOpen:Wa,openModal:qa,closeModal:Be}=Ue(),[Hs,ut]=r.useState(""),[Rs,xt]=r.useState(""),[Bs,pt]=r.useState(""),[Vs,ht]=r.useState(""),[Ws,gt]=r.useState(""),[ft,yt]=r.useState(""),[bt,jt]=r.useState(""),[vt,Nt]=r.useState(""),[kt,wt]=r.useState(""),[Ct,St]=r.useState(""),[Pt,Dt]=r.useState(""),[Lt,Et]=r.useState(""),[At,_t]=r.useState(""),[Ft,Ut]=r.useState(""),[Ot,Ya]=r.useState(!1),[Tt,zt]=r.useState(""),[It,$t]=r.useState(""),[Ve,We]=r.useState(""),[qe,Mt]=r.useState(""),[Ht,Rt]=r.useState(""),[Bt,Ye]=r.useState(""),[Ka,Ga]=r.useState(""),[qs,Ys]=r.useState(""),[Ke,Ge]=r.useState(""),[Vt,Wt]=r.useState([]),[oe,qt]=r.useState(""),[Ze,Yt]=r.useState(""),[Kt,Gt]=r.useState(""),[Zt,Jt]=r.useState(""),[Xt,Qt]=r.useState(""),[ea,ta]=r.useState(""),[aa,sa]=r.useState(!0),[ra,he]=r.useState(!1),Za=F(a);(fa=a==null?void 0:a.roles)!=null&&fa.includes("Counsellor");const na=be(a)||F(a),Je=!be(a)&&!Za,ge=be(a)||F(a);r.useEffect(()=>{rt(A,se),Aa(pe,Pa,a),ds(),Ja()},[a]),r.useEffect(()=>{a&&(()=>{const s=a==null?void 0:a.isAdmin,n=F(a);(s||n)&&Oe((o==null?void 0:o._id)||(o==null?void 0:o.id))})()},[a,o]);const Oe=async(t=null)=>{try{const s=t?`${I}/users/dropdown?brandId=${t}`:`${I}/users/dropdown`,n=await B.get(s,{withCredentials:!0});Oa(n.data.users||[])}catch(s){console.error("Error fetching users:",s),k.error("Failed to fetch users for assignment")}},Ja=async()=>{try{const s=(await B.get(`${I}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(n=>({value:n.value,label:n.name}));s.push({value:"other",label:"Other"}),F(a)&&s.push({value:"__add_new__",label:"+ Add New Contact Point"}),re(s)}catch(t){console.error("Error fetching contact points:",t);const s=[...it];F(a)&&s.push({value:"__add_new__",label:"+ Add New Contact Point"}),re(s)}};r.useEffect(()=>{ge&&o&&Oe((o==null?void 0:o._id)||(o==null?void 0:o.id))},[o,ge]),r.useEffect(()=>{const t=sessionStorage.getItem("openLeadId");if(t&&q.length>0){const s=q.find(n=>n._id===t);s&&(Xe(s),sessionStorage.removeItem("openLeadId"))}},[q]);const la=t=>{const l=window.innerWidth,i=window.innerHeight,w=85;let h=t.left,j=t.width/2;h+384>l-20&&(h=l-384-20),h<20&&(h=20),j=t.left+t.width/2-h,j=Math.max(20,Math.min(364,j));const O=t.top-w-20,K=i-t.bottom-20,X=350;let H=0,ie="",de=0;return O>X||O>K?(H=t.top,ie="translateY(-100%) translateY(-10px)",de=O):(H=t.bottom,ie="translateY(10px)",de=K),{top:H,left:h,arrowLeft:j,transform:ie,maxHeight:de}},Xa=(t,s)=>{if(s.remarks&&s.remarks.length>0){le.current&&clearTimeout(le.current);const n=t.currentTarget.getBoundingClientRect(),l=la(n);ct(l),dt(s._id),le.current=setTimeout(()=>{mt(!0)},150)}},oa=()=>{le.current&&(clearTimeout(le.current),le.current=null),le.current=setTimeout(()=>{dt(null),mt(!1)},100)};r.useEffect(()=>{if(!Pe)return;const t=()=>{const s=document.querySelector(`[data-row-id="${Pe}"]`);if(s){const n=s.getBoundingClientRect(),l=la(n);ct(l)}};return window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[Pe]);const Qa=t=>{const s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t);return Ya(!s),s},es=t=>{const s=t.target.value;jt(s),Qa(s)},Y=q.filter(t=>{var K,X,H,ie,de,De,Le,Ee,tt,Ae;const s=((K=t.fullName)==null?void 0:K.toLowerCase().includes(y.toLowerCase()))||((X=t.phone1)==null?void 0:X.includes(y)),n=ee?t.status===ee:!0,l=$?t.leadStatus===$:!0,i=M?t.leadPotential===M:!0,w=te?t.campaign===te:!0;let h=!0;if(ge&&Z){const T=((ie=(H=t.assignedTo)==null?void 0:H._id)==null?void 0:ie.toString())||((de=t.assignedTo)==null?void 0:de.toString());Z==="unassigned"?h=!T:h=T===Z}let j=!0;if(!ge){const T=((Le=(De=t.assignedTo)==null?void 0:De._id)==null?void 0:Le.toString())||((Ee=t.assignedTo)==null?void 0:Ee.toString()),R=((tt=a==null?void 0:a.id)==null?void 0:tt.toString())||((Ae=a==null?void 0:a._id)==null?void 0:Ae.toString());(!T||T!==R)&&(j=!1)}let O=!0;if(C&&C.length>0){const T=new Date(t.createdAt);T.setHours(0,0,0,0);const R=t.followUpDate?new Date(t.followUpDate):null;if(R&&R.setHours(0,0,0,0),C.length===2){const g=new Date(C[0]),z=new Date(C[1]);g.setHours(0,0,0,0),z.setHours(0,0,0,0);const _e=T>=g&&T<=z,Fe=R&&R>=g&&R<=z;O=_e||Fe}else if(C.length===1){const g=new Date(C[0]);g.setHours(0,0,0,0);const z=T.getTime()===g.getTime(),_e=R&&R.getTime()===g.getTime();O=z||_e}}return s&&n&&l&&i&&w&&h&&j&&O}).sort((t,s)=>{const n=h=>({strongProspect:4,potentialProspect:3,weakProspect:2,notAProspect:1})[h]||0,l=h=>["converted","lost","notInterested"].includes(h)?2:1;if(u==="followup_latest"||u==="followup_oldest"){const h=t.followUpDate?new Date(t.followUpDate):null,j=s.followUpDate?new Date(s.followUpDate):null;if(h&&h.setHours(0,0,0,0),j&&j.setHours(0,0,0,0),(h==null?void 0:h.getTime())!==(j==null?void 0:j.getTime()))return!h&&!j?0:h?j?u==="followup_latest"?h-j:j-h:-1:1;const O=l(t.leadStatus),K=l(s.leadStatus);if(O!==K)return O-K;const X=n(t.leadPotential),H=n(s.leadPotential);return X!==H?H-X:new Date(s.createdAt)-new Date(t.createdAt)}const i=new Date(t.createdAt),w=new Date(s.createdAt);return u==="asc"?i-w:w-i}),ia=r.useMemo(()=>{const t={};return Y.filter(n=>{if(!C||C.length===0)return!0;const l=new Date(n.createdAt);if(l.setHours(0,0,0,0),C.length===2){const i=new Date(C[0]),w=new Date(C[1]);return i.setHours(0,0,0,0),w.setHours(0,0,0,0),l>=i&&l<=w}else if(C.length===1){const i=new Date(C[0]);return i.setHours(0,0,0,0),l.getTime()===i.getTime()}return!0}).forEach(n=>{let l=n.contactPoint||"Not Specified";l&&l!=="Not Specified"&&(l=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()),t[l]=(t[l]||0)+1}),Object.entries(t).sort((n,l)=>l[1]-n[1]).reduce((n,[l,i])=>(n[l]=i,n),{})},[Y,C]),da=t=>{Ce(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},ts=t=>{t.target.checked?Ce(Y.map(s=>s._id)):Ce([])},as=async()=>{await Us(L,q,k)},Xe=async t=>{if(t.remarks&&t.remarks.length>0){const n=t.remarks.map((l,i)=>({remark:l,index:i})).filter(({remark:l})=>l.isUnread);for(const{index:l}of n)try{await Ms(t._id,l)}catch(i){console.error("Error marking remark as read:",i)}n.length>0&&A(l=>l.map(i=>{if(i._id===t._id){const w=[...i.remarks];return n.forEach(({index:h})=>{w[h].isUnread=!1}),{...i,remarks:w}}return i}))}Ts(t,{setSelectedRow:b,setEditName:ut,setEditPhone:xt,setEditEmail:pt,setEditStatus:ht,setEditFollowUp:gt,setFullName:yt,setEmail:jt,setPhone1:Et,setPhone2:_t,setGender:Ut,setDob:Nt,setPlace:wt,setOtherPlace:St,setStatus:Dt,setEducation:zt,setOtherEducation:$t,setContactPoint:Mt,setOtherContactPoint:Rt,setCampaign:Ye,setHandledByPerson:Ga,setFollowUpDate:Ge,setRemarks:We,setLeadStatus:qt,setLeadPotential:Yt,setSelectedValues:Wt,courseOptions:me,contactPointOptions:U}),Ia()},ca=t=>{if(!na){k.error("Only managers and admins can delete leads.",{position:"top-center",autoClose:3e3});return}b(t),Ma()},ma=t=>{b(t),Ra()},ss=async()=>{if(!oe){k.error("Lead Status is required");return}if(!Ze){k.error("Lead Potential is required");return}if(oe!=="converted"&&oe!=="lost"&&!Ke){k.error("Next Follow Up Date is required");return}if(!Ve.trim()){k.error("Remarks are required");return}he(!0);try{await zs(x,Ve,oe,Ze,ft,Lt,At,bt,Ft,vt,kt,Ct,Pt,Tt,It,qe,Ht,Bt,oe==="converted"||oe==="lost"?null:Ke,Vt,a,Ka,Ne,d,p,c,()=>rt(A,se),b,We,m,f)}finally{he(!1)}},rs=async()=>{await Is(x,na,Me,Te,A,m,f,k)},ns=async()=>{await $s(x,He,Te,d,k)},ls=t=>{t==="__add_new__"?Va():Ye(t)},os=async()=>{await Os(Kt,Zt,Xt,ea,aa,Ye,()=>Aa(pe,Pa,a),Re,Gt,Jt,Qt,ta,sa,k)},Te=()=>{b(null),ut(""),xt(""),pt(""),ht(""),gt("")},[is,ua]=r.useState(!1),[Qe,xa]=r.useState(""),[pa,ha]=r.useState(""),ga=t=>{b(t),ua(!0),t.brand?Oe(t.brand._id||t.brand):Oe()},et=()=>{ua(!1),xa(""),ha("")},ds=async()=>{try{const s=(await B.get(`${I}/course-categories/all`,{withCredentials:!0})).data.categories.filter(n=>n.isActive).map(n=>({value:n.name,label:n.name}));we(s)}catch(t){console.error("Error fetching course categories:",t),we([{value:"General",label:"General"}])}},cs=async()=>{var t,s;if(!Qe){k.error("Please select a user to assign the lead to");return}try{const n=await B.put(`${I}/customers/assign/${x._id}`,{assignedTo:Qe,assignmentRemark:pa},{withCredentials:!0});n.data.customer&&(A(l=>l.map(i=>i._id===x._id?n.data.customer:i)),k.success("Lead assigned successfully!"),et(),typeof m=="function"&&m({type:"lead_assigned",userName:(a==null?void 0:a.fullName)||"Someone",avatar:(a==null?void 0:a.avatar)||null,action:"assigned lead",entityName:x.fullName,module:"Lead Management"}))}catch(n){console.error("Error assigning lead:",n),k.error(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to assign lead")}};return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6",children:[ye?e.jsx(hs,{className:"py-20"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between border-b border-gray-100 dark:border-gray-800 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Enquiries"}),Je&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Showing only leads assigned to you"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[L.length>0&&e.jsxs("p",{className:"text-xs text-brand-500 font-medium",children:[L.length," lead(s) selected"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Total: ",Y.length," records"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-800/60",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Lead Potential:"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Strong"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Potential"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Weak"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"size-2 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Not a prospect"})]})]}),Object.keys(ia).length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-800/60",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"This Month:"}),Object.entries(ia).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[t,":"]}),e.jsx("span",{className:"text-xs font-semibold text-brand-600 dark:text-brand-400",children:s})]},t))]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"w-full sm:w-56",children:e.jsx(_s,{id:"leadDateFilter",value:C,onChange:t=>xe(t),placeholder:"Filter by date range"})}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>fe(!ae),startIcon:ae?e.jsx(As,{className:"size-5"}):e.jsx(Ds,{className:"size-5"}),children:ae?"Hide Filters":"Show Filters"}),e.jsx(v,{size:"sm",variant:"outline",onClick:qa,startIcon:e.jsx(Ps,{className:"size-5"}),children:"Import"}),e.jsx(v,{size:"sm",variant:"outline",onClick:as,endIcon:e.jsx(ja,{className:"size-5"}),disabled:L.length===0,children:"PDF"})]})]}),ae&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-gray-50/50 dark:bg-white/[0.02] p-4 rounded-xl border border-gray-100 dark:border-gray-800 transition-all duration-300",children:[e.jsx(Q,{type:"text",placeholder:"Search by name or phone...",value:y,onChange:t=>P(t.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"}),e.jsx(_,{options:fs,value:u,placeholder:"Sort by date",onChange:t=>E(t)}),e.jsx(_,{options:[{value:"",label:"All Lead Statuses"},...nt],value:$,placeholder:"Filter by lead status",onChange:t=>G(t)}),e.jsx(_,{options:[{value:"",label:"All Lead Potentials"},...va],value:M,placeholder:"Filter by lead potential",onChange:t=>V(t)}),e.jsx(_,{options:[{value:"",label:"All Campaigns"},...J],value:te,placeholder:"Filter by campaign",onChange:t=>S(t)}),ge&&e.jsx(_,{options:[{value:"",label:"All Users"},{value:"unassigned",label:"Unassigned"},...Se.map(t=>({value:t._id,label:t.fullName}))],value:Z,placeholder:"Filter by assigned user",onChange:t=>W(t)})]})]}),e.jsx("div",{className:"hidden md:block max-w-full overflow-x-auto",children:e.jsxs(ys,{children:[e.jsx(bs,{className:"border-gray-100 dark:border-gray-800 border-y",children:e.jsxs(at,{children:[e.jsx(D,{isHeader:!0,className:"py-3 pl-8 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:Y.length>0&&L.length===Y.length,onChange:ts,className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx("div",{className:"size-6 invisible shrink-0"})]})}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Name"}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Date Added"}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Contact Point"}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Campaign"}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Status & Remark"}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Next Follow-up"}),e.jsx(D,{isHeader:!0,className:"py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Actions"})]})}),e.jsx(js,{className:"divide-y divide-gray-100 dark:divide-gray-800",children:Y.length===0?e.jsx(at,{children:e.jsx(D,{colSpan:10,className:"py-8 text-center text-gray-500",children:Je?"No leads assigned to you.":"No leads found. Create your first lead!"})}):Y.map(t=>{var i,w,h;const s=La(t.remarks),n=Ea(t.remarks),l=_a(t.leadPotential);return e.jsxs(at,{className:"group overflow-hidden transition-colors even:bg-gray-50/40 even:dark:bg-white/[0.01] hover:bg-gray-50/50 dark:hover:bg-white/[0.02]",children:[e.jsxs(D,{className:"py-4 pl-8 relative",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-[6px] ${l.bar}`}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:L.includes(t._id),onChange:()=>da(t._id),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),n?e.jsx("div",{className:"size-5 shrink-0 rounded-full bg-red-600 flex items-center justify-center shadow-md",title:"New Remark",children:e.jsx(ze,{className:"size-3.5 text-white"})}):e.jsx("div",{className:"size-6 invisible shrink-0"})]})]}),e.jsx(D,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-theme-sm dark:text-white/90 truncate",children:t.fullName}),e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:((i=t.coursePreference)==null?void 0:i.join(", "))||"N/A"}),e.jsx("a",{href:`tel:${t.phone1}`,className:"text-brand-500 hover:underline text-[12px] font-medium mt-0.5",children:t.phone1})]})}),e.jsx(D,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{children:ke(t.createdAt)}),e.jsxs("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:["By: ",((w=t.createdBy)==null?void 0:w.fullName)||t.handledBy||"N/A"]})]})}),e.jsx(D,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{children:t.contactPoint||"N/A"}),((h=t.contactPoint)==null?void 0:h.toLowerCase())==="other"&&t.otherContactPoint&&e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[150px]",children:t.otherContactPoint})]})}),e.jsx(D,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:t.campaign||"N/A"}),e.jsx(D,{className:"py-3",children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ve,{size:"sm",color:st(t.leadStatus),children:Ne(t.leadStatus)})}),e.jsxs("div",{className:"relative group/remark","data-row-id":t._id,onMouseEnter:j=>Xa(j,t),onMouseLeave:oa,children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 max-w-[180px] truncate cursor-help leading-relaxed",children:s||"No remarks yet"}),t.assignmentRemark&&e.jsxs("p",{className:"text-[10px] text-red-500 dark:text-red-400 mt-0.5 truncate animate-pulse duration-100",children:["Suggestion: ",t.assignmentRemark]})]})]})}),e.jsx(D,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx(ve,{size:"sm",color:Fa(t.followUpDate),children:Ua(t.followUpDate)}),t.assignedTo&&e.jsxs("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:["Assigned To: ",t.assignedTo.fullName]})]})}),e.jsx(D,{className:"py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{size:"sm",variant:"outline",className:"mr-2",endIcon:e.jsx(ka,{className:"size-5"}),onClick:()=>Xe(t)}),Na(a)&&e.jsx(v,{size:"sm",variant:"outline",className:"text-red-500 mr-2",endIcon:e.jsx(wa,{className:"size-5"}),onClick:()=>ca(t)}),ge&&e.jsx(v,{size:"sm",variant:"outline",className:"text-blue-500 mr-2",onClick:()=>ga(t),children:"Assign"}),e.jsx(v,{size:"sm",variant:"outline",className:"text-yellow-500",title:"Follow-up Alarm",endIcon:e.jsx(ze,{className:"size-5"}),onClick:()=>ma(t)})]})})]},t._id)})})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:hidden",children:Y.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500 bg-white dark:bg-white/[0.03] rounded-xl border border-gray-100 dark:border-gray-800",children:Je?"No leads assigned to you.":"No leads found."}):Y.map(t=>{var i,w;const s=La(t.remarks),n=_a(t.leadPotential),l=Ea(t.remarks);return e.jsxs("div",{className:"relative overflow-hidden bg-white dark:bg-white/[0.03] border border-gray-100 dark:border-gray-800 rounded-xl p-4 shadow-sm",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-[4px] ${n.bar}`}),e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:L.includes(t._id),onChange:()=>da(t._id),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white/90",children:t.fullName}),e.jsx("a",{href:`tel:${t.phone1}`,className:"text-brand-500 text-sm font-medium hover:underline",children:t.phone1})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(ve,{size:"sm",color:st(t.leadStatus),children:Ne(t.leadStatus)}),l&&e.jsx("div",{className:"size-5 rounded-full bg-red-600 flex items-center justify-center shadow-sm",children:e.jsx(ze,{className:"size-3 text-white"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Course Preference:"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200 text-right max-w-[150px] truncate",children:((i=t.coursePreference)==null?void 0:i.join(", "))||"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Added:"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-200",children:[ke(t.createdAt)," by ",((w=t.createdBy)==null?void 0:w.fullName)||t.handledBy||"N/A"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Next Follow-up:"}),e.jsx(ve,{size:"sm",color:Fa(t.followUpDate),children:Ua(t.followUpDate)})]}),t.assignedTo&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Assigned To:"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200 font-medium",children:t.assignedTo.fullName})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Latest Remark:"}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 line-clamp-2",children:s||"No remarks yet"}),t.assignmentRemark&&e.jsxs("p",{className:"text-[10px] text-red-500 dark:text-red-400 mt-2 font-medium",children:["Suggestion: ",t.assignmentRemark]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-3 border-t border-gray-100 dark:border-gray-800",children:[e.jsx(v,{size:"sm",variant:"outline",className:"p-2",onClick:()=>ma(t),children:e.jsx(ze,{className:"size-5 text-yellow-500"})}),ge&&e.jsx(v,{size:"sm",variant:"outline",className:"text-blue-500 px-3",onClick:()=>ga(t),children:"Assign"}),Na(a)&&e.jsx(v,{size:"sm",variant:"outline",className:"p-2 text-red-500",onClick:()=>ca(t),children:e.jsx(wa,{className:"size-5"})}),e.jsxs(v,{size:"sm",variant:"primary",className:"px-3",onClick:()=>Xe(t),children:[e.jsx(ka,{className:"size-4 mr-2"})," Edit"]})]})]},t._id)})}),Pe&&Ie&&gs.createPortal((()=>{const t=Y.find(n=>n._id===Pe);if(!t||!t.remarks||t.remarks.length===0)return null;const s=ne.transform.includes("-100%")||ne.transform==="translateY(-10px)";return e.jsxs("div",{ref:Ta,className:`fixed w-96 max-w-[90vw] bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 z-[100000] transition-all duration-200 ${Ie?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{top:`${ne.top}px`,left:`${ne.left}px`,maxHeight:`${ne.maxHeight}px`,transform:`${ne.transform} ${Ie?"scale(1)":"scale(0.95)"}`},onMouseEnter:()=>{le.current&&clearTimeout(le.current)},onMouseLeave:oa,children:[ne.arrowLeft>0&&e.jsx("div",{className:`absolute ${s?"bottom-0":"top-0"} left-0 w-0 h-0`,style:{left:`${ne.arrowLeft}px`,transform:s?"translateY(100%) translateX(-50%)":"translateY(-100%) translateX(-50%)"},children:e.jsx("div",{className:`w-0 h-0 border-l-[8px] border-r-[8px] ${s?"border-t-[8px] border-t-white dark:border-t-gray-800 border-l-transparent border-r-transparent":"border-b-[8px] border-b-white dark:border-b-gray-800 border-l-transparent border-r-transparent"}`,style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"}})}),e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10 rounded-t-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:"Remark History"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t.remarks.length," remark",t.remarks.length!==1?"s":""]})]}),e.jsx("div",{className:"overflow-y-auto p-3 space-y-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-700 hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-gray-600",style:{maxHeight:`${ne.maxHeight-60}px`},children:[...t.remarks].reverse().map((n,l)=>e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-900 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-800 dark:text-white",children:n.handledBy||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.updatedOn?new Date(n.updatedOn).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{size:"sm",color:st(n.leadStatus||"new"),children:Ne(n.leadStatus||"new")}),n.isUnread&&e.jsx("span",{className:"text-xs text-red-500 dark:text-red-400",children:"Unread"})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words",children:n.remark||"No remarks"}),n.nextFollowUpDate&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:["Next Follow-up: ",new Date(n.nextFollowUpDate).toLocaleDateString()]})]},l))})]})})(),document.body),e.jsxs(je,{isOpen:za,onClose:$e,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[1480px] p-6 lg:p-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"mb-2 font-semibold text-gray-800 dark:text-white/90 modal-title text-theme-xl lg:text-2xl",children:"Edit Lead"}),e.jsx("button",{onClick:$e,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(Q,{type:"text",id:"firstName",value:ft,onChange:t=>yt(t.target.value),disabled:!be(a)&&!F(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Email"}),e.jsx(Q,{type:"email",value:bt,error:Ot,onChange:es,placeholder:"Enter email",hint:Ot?"This is an invalid email address.":"",disabled:!be(a)&&!F(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Phone *"}),e.jsx(Ca,{selectPosition:"end",countries:Sa,placeholder:"+91 98765 43210",value:Lt,onChange:Et,disabled:!be(a)&&!F(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Phone (optional)"}),e.jsx(Ca,{selectPosition:"end",countries:Sa,placeholder:"+91 98765 43210",value:At,onChange:_t})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Gender"}),e.jsx(_,{options:vs,value:Ft,placeholder:"Select Gender",onChange:Ut})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Da,{id:"dob",label:"DoB",placeholder:"Select a date",value:vt,onChange:(t,s)=>Nt(s)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Place *"}),e.jsx(_,{options:lt,value:kt,placeholder:"Select Place",onChange:wt})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(Q,{type:"text",id:"otherPlace",value:Ct,onChange:t=>St(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Current Status"}),e.jsx(_,{options:Ns,value:Pt,placeholder:"Select Status",onChange:Dt})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Education *"}),e.jsx(_,{options:ot,value:Tt,placeholder:"Select Education",onChange:zt})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(Q,{type:"text",id:"otherEducation",value:It,onChange:t=>$t(t.target.value)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Contact Point"}),e.jsx(_,{options:F(a)?U:U.filter(t=>t.value!=="__add_new__"),value:qe,onChange:Mt,disabled:!F(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{htmlFor:"otherContactPoint",children:"Specify other"}),e.jsx(Q,{type:"text",id:"otherContactPoint",value:Ht,onChange:t=>Rt(t.target.value),disabled:qe!=="other"})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:e.jsx("div",{className:"w-full",children:e.jsx(ks,{label:"Course Preference",options:me,selectedValues:Vt,onChange:Wt})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Campaign"}),e.jsx(_,{options:J,value:Bt,placeholder:"Campaigns",onChange:ls,disabled:!F(a)})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Lead Status *"}),e.jsx(_,{id:"leadStatus",label:"Lead Status",options:nt,value:oe,onChange:t=>{qt(t),(t==="converted"||t==="lost")&&Ge("")},required:!0})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(N,{children:"Lead Potential *"}),e.jsx(_,{options:va,value:Ze,placeholder:"Select Lead Potential",onChange:Yt})]}),oe!=="converted"&&oe!=="lost"&&e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Da,{id:"followupDate",label:"Next Follow Up Date *",value:Ke,disablePastDates:!0,onChange:(t,s)=>Ge(s)})})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:e.jsxs("div",{className:"w-full",children:[e.jsx(N,{htmlFor:"remarks",children:"Remarks *"}),e.jsx(Q,{type:"text",id:"remarks",value:Ve,onChange:t=>We(t.target.value)})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(v,{variant:"outline",onClick:$e,children:"Cancel"}),e.jsx(v,{variant:"primary",onClick:ss,loading:ra,children:"Update"})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(ws,{title:"History & Remarks",children:e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-700 hover:scrollbar-thumb-gray-400 dark:hover:scrollbar-thumb-gray-600",children:x!=null&&x.remarks&&x.remarks.length>0?[...x.remarks].reverse().map((t,s)=>e.jsx(Fs,{name:t.handledBy||(a==null?void 0:a.fullName)||"Unknown",datetime:t.updatedOn?new Date(t.updatedOn).toLocaleString():"N/A",callback:t.nextFollowUpDate?new Date(t.nextFollowUpDate).toLocaleDateString():"",note:t.remark||"No remarks",status:Ne(t.leadStatus||"new")},s)):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"No history available yet."}),e.jsx("p",{className:"text-sm mt-2",children:"Remarks and updates will appear here."})]})})})})]})]}),e.jsxs(je,{isOpen:$a,onClose:Me,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[700px] p-6 lg:p-10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Confirm Delete"}),e.jsxs("p",{children:["Are you sure you want to delete enquiry ",e.jsx("strong",{children:x==null?void 0:x.name}),"?"]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(v,{variant:"outline",onClick:()=>{Me(),Te()},children:" Cancel"}),e.jsx(v,{variant:"danger",onClick:rs,children:"Delete"})]})]}),e.jsxs(je,{isOpen:Ha,onClose:He,overlayClassName:"bg-black/5 backdrop-blur-none",className:"max-w-[700px] p-6 lg:p-10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-white/90",children:"Set Follow-up Reminder"}),e.jsxs("p",{children:["Set a reminder for ",e.jsx("strong",{children:x==null?void 0:x.fullName})," on ",x?ke(x.followUpDate):"","."]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(v,{variant:"outline",onClick:()=>{He(),Te()},children:"Close"}),e.jsx(v,{variant:"warning",onClick:ns,children:"Set Reminder"})]})]}),e.jsxs(je,{isOpen:Ba,onClose:Re,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(Q,{id:"newCampaignName",type:"text",value:Kt,onChange:t=>Gt(t.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:Zt,onChange:t=>Jt(t.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 shadow-theme-xs"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(Q,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:Xt,onChange:t=>Qt(t.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{htmlFor:"newCampaignCashback",children:"Cashback (₹)"}),e.jsx(Q,{id:"newCampaignCashback",type:"number",min:"0",value:ea,onChange:t=>ta(t.target.value),placeholder:"0"})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:aa,onChange:t=>sa(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(N,{htmlFor:"newCampaignActive",className:"mb-0",children:"Active"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(v,{variant:"outline",onClick:Re,children:"Cancel"}),e.jsx(v,{variant:"primary",onClick:os,children:"Create Campaign"})]})]})]}),e.jsxs(je,{isOpen:Wa,onClose:Be,className:"max-w-xl p-0 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90",children:"Import Leads"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Upload a CSV file to bulk import your leads into the system."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-brand-50/50 dark:bg-brand-500/5 p-4 rounded-xl border border-brand-100 dark:border-brand-500/20 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-brand-700 dark:text-brand-400",children:"Step 1: Get the template"}),e.jsx("p",{className:"text-xs text-brand-600/80 dark:text-brand-400/60 mt-0.5",children:"Use our CSV template to ensure correct data formatting."})]}),e.jsx(v,{size:"sm",variant:"outline",className:"bg-white dark:bg-gray-900",onClick:()=>{const n="data:text/csv;charset=utf-8,"+[["Full Name","Phone","Email","Place","Education","Course Preference","Contact Point","Campaign","Next Follow Up Date","Remarks","Lead Potential"],...[["John Doe","9876543210","john@example.com","New York","Bachelor's","Python;Java","Website","Summer 2024","2024-07-15","Interested in backend","strongProspect"],["Jane Smith","9123456789","jane@test.com","London","Master's","AWS","LinkedIn","Winter Sale","2024-07-20","Wants to switch career","potentialProspect"]]].map(w=>w.join(",")).join(`
`),l=encodeURI(n),i=document.createElement("a");i.setAttribute("href",l),i.setAttribute("download","lead_import_template.csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},children:"Download Sample"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Step 2: Upload your file"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-2xl p-10 flex flex-col items-center justify-center text-center hover:border-brand-300 dark:hover:border-brand-800 transition-colors cursor-pointer group",onClick:()=>document.getElementById("csv-upload").click(),children:[e.jsx("div",{className:"size-12 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center mb-4 group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10 transition-colors",children:e.jsx(ja,{className:"size-6 text-gray-400 group-hover:text-brand-500 rotate-180"})}),e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white/90",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Only CSV files are supported (max 5MB)"}),e.jsx("input",{type:"file",id:"csv-upload",className:"hidden",accept:".csv",onChange:t=>{const s=t.target.files[0];if(s){if(s.type!=="text/csv"&&!s.name.endsWith(".csv")){k.error("Please upload a valid CSV file");return}k.info(`Processing ${s.name}...`)}}})]})]}),e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-white/[0.02] rounded-xl border border-gray-100 dark:border-gray-800",children:[e.jsx("div",{className:"size-5 rounded-full bg-blue-500 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[10px] text-white font-bold",children:"i"})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Ensure dates are in YYYY-MM-DD format."}),e.jsx("li",{children:'"Full Name" and "Phone" are required fields.'}),e.jsx("li",{children:'"Course Preference" can be multiple items separated by semi-colons.'})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-white/[0.02] border-t border-gray-100 dark:border-gray-800 flex items-center justify-end gap-3",children:[e.jsx(v,{variant:"outline",onClick:Be,children:"Cancel"}),e.jsx(v,{variant:"primary",loading:ra,onClick:()=>{const t=document.getElementById("csv-upload");if(t.files.length===0){k.error("Please select a file first");return}he(!0);const s=t.files[0];Ss.parse(s,{header:!0,skipEmptyLines:!0,complete:async n=>{var T,R;const l=(g,z)=>{if(!g)return null;const _e=g.map(Fe=>Fe.toLowerCase().trim());for(const Fe of z){const ya=_e.indexOf(Fe.toLowerCase());if(ya!==-1)return g[ya]}return null},i=n.meta.fields||[];console.log("Details found in CSV:",i);const w=l(i,["Full Name","Name","Student Name","Lead Name","Enquiry Name"]),h=l(i,["Phone","Phone Number","Mobile","Contact","Phone 1","Contact Number"]),j=l(i,["Email","Email Address","Email ID"]),O=l(i,["Place","City","Location","Address"]),K=l(i,["Education","Qualification"]),X=l(i,["Course Preference","Course","Interest","Subject"]),H=l(i,["Contact Point","Source"]),ie=l(i,["Campaign"]),de=l(i,["Next Follow Up Date","Follow Up Date","Follow Up","Date"]),De=l(i,["Remarks","Note","Comment"]),Le=l(i,["Lead Potential","Potential","Status"]),Ee=l(i,["Date Created","Created At","Creation Date","Date Added"]);if(!w||!h){console.error("Missing headers. Found:",i),k.error(`Missing required columns! Found: ${i.join(", ")}. Need at least 'Name' and 'Phone'.`,{autoClose:1e4}),he(!1);return}const Ae=n.data.map(g=>({fullName:g[w],phone1:g[h],email:j?g[j]:"",place:O?g[O]:"",education:K?g[K]:"Other",coursePreference:X?g[X]:"",contactPoint:H?g[H]:"Other",campaign:ie?g[ie]:"",nextFollowUpDate:de?g[de]:"",remarks:De?g[De]:"",leadStatus:"new",leadPotential:Le&&g[Le]||"potentialProspect",createdAt:Ee?g[Ee]:null})).filter(g=>g.fullName&&g.phone1);if(Ae.length===0){k.error("No valid leads found in file. Check Name and Phone columns."),he(!1);return}try{const g=await B.post(`${I}/customers/import-leads`,{leads:Ae},{withCredentials:!0}),{summary:z}=g.data;z.success>0&&(k.success(`Successfully imported ${z.success} leads!`),rt(A,se)),z.failed>0&&(k.warn(`${z.failed} leads failed to import. Check console for details.`),console.warn("Import Errors:",z.errors)),Be()}catch(g){console.error("Import failed:",g),k.error(((R=(T=g.response)==null?void 0:T.data)==null?void 0:R.message)||"Import failed. Please try again.")}finally{he(!1)}},error:n=>{console.error("CSV Parse Error:",n),k.error("Failed to parse CSV file."),he(!1)}})},children:"Confirm Import"})]})]}),e.jsxs(je,{isOpen:is,onClose:et,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Assign Lead"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"assignToUser",children:"Assign To"}),e.jsx(_,{options:Se.map(t=>({value:t._id,label:t.fullName})),value:Qe,placeholder:"Select User",onChange:xa})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"assignmentRemark",children:"Assignment Remark (Optional)"}),e.jsx("textarea",{id:"assignmentRemark",value:pa,onChange:t=>ha(t.target.value),placeholder:"Add a remark for the assignment...",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(v,{variant:"outline",onClick:et,children:"Cancel"}),e.jsx(v,{onClick:cs,children:"Assign Lead"})]})]})]})]}),e.jsx(Cs,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{er as R};
