import{r as x,A as z,b as U,f as Y,j as e,P as G,w as J,E as K,C as L,z as o,I as u,D as C,h as c,c as g,d as y,y as s}from"./index-WGrFNeZR.js";const V=()=>{const{user:i,isAdmin:S}=x.useContext(z),[q,f]=x.useState([]),[F,A]=x.useState(""),[E,I]=x.useState(!0),[R,N]=x.useState(!1),[P,O]=x.useState(null),[r,b]=x.useState({employeeName:"",employeeId:"",leaveType:"casual",startDate:"",endDate:"",reason:"",status:"pending"});U();const D=Y(),h=async()=>{var a;if(c(i,"Owner")||c(i,"HR")||c(i,"Manager"))try{I(!0);const t=await g.get(`${y}/leaves`,{withCredentials:!0,timeout:1e4});t.data&&t.data.leaves?f(t.data.leaves):t.data&&Array.isArray(t.data)?f(t.data):f([])}catch(t){console.error("Error fetching leaves:",t),t.response?t.response.status===401?s.error("Authentication required. Please log in again."):t.response.status===403?s.error("Access denied. Admin privileges required."):s.error(((a=t.response.data)==null?void 0:a.message)||"Failed to fetch leaves"):t.request?s.error("Network error. Please check your connection."):s.error("Failed to fetch leaves. Please try again."),f([])}finally{I(!1)}};x.useEffect(()=>{h()},[]);const m=a=>{const{name:t,value:d}=a.target;b(n=>({...n,[t]:d}))},k=(a,t)=>{b(d=>({...d,[a]:t}))},w=()=>{b({employeeName:"",employeeId:"",leaveType:"casual",startDate:"",endDate:"",reason:"",status:"pending"})},$=async a=>{var t,d;try{const n=await g.get(`${y}/leaves/${a}`,{withCredentials:!0,timeout:1e4}),l=((t=n.data)==null?void 0:t.leave)||n.data;if(!l){s.error("Leave not found");return}b({employeeName:l.employeeName||"",employeeId:l.employeeId||"",leaveType:l.leaveType||"casual",startDate:l.startDate?new Date(l.startDate).toISOString().split("T")[0]:"",endDate:l.endDate?new Date(l.endDate).toISOString().split("T")[0]:"",reason:l.reason||"",status:l.status||"pending"}),O(a),N(!0)}catch(n){console.error("Error fetching leave for edit:",n),n.response?n.response.status===404?s.error("Leave not found"):n.response.status===401?s.error("Authentication required"):s.error(((d=n.response.data)==null?void 0:d.message)||"Failed to load leave details"):s.error("Failed to load leave details. Please try again.")}},M=a=>{$(a)},H=async a=>{var l,v;if(a.preventDefault(),!r.employeeName||!r.employeeId||!r.leaveType||!r.startDate||!r.endDate||!r.reason){s.error("Please fill in all required fields");return}const t=new Date(r.startDate),d=new Date(r.endDate),n=new Date;if(n.setHours(0,0,0,0),t>d){s.error("Start date cannot be after end date");return}if(t<n){s.error("Start date cannot be in the past");return}try{const p={employeeName:r.employeeName.trim(),employeeId:r.employeeId.trim(),leaveType:r.leaveType,startDate:t.toISOString(),endDate:d.toISOString(),reason:r.reason.trim()},j=await g.post(`${y}/leaves/create`,p,{timeout:1e4});j.data&&j.data.message?s.success(j.data.message||"Leave request submitted successfully!"):s.success("Leave request submitted successfully!"),w(),D.pathname.includes("/leave-management/requests")||h()}catch(p){if(console.error("Error submitting leave request:",p),p.response){const j=((l=p.response.data)==null?void 0:l.message)||((v=p.response.data)!=null&&v.errors?p.response.data.errors.join(", "):"Failed to submit leave request");s.error(j)}else p.request?s.error("Network error. Please check your connection."):s.error("Failed to submit leave request. Please try again.")}},B=async a=>{var n;if(a.preventDefault(),!(c(i,"Owner")||c(i,"HR"))){s.error("Access denied. Owner or HR privileges required.");return}if(!r.employeeName||!r.employeeId||!r.leaveType||!r.startDate||!r.endDate||!r.reason){s.error("Please fill in all required fields");return}const t=new Date(r.startDate),d=new Date(r.endDate);if(t>d){s.error("Start date cannot be after end date");return}try{const l={employeeName:r.employeeName.trim(),employeeId:r.employeeId.trim(),leaveType:r.leaveType,startDate:t.toISOString(),endDate:d.toISOString(),reason:r.reason.trim(),status:r.status};await g.put(`${y}/leaves/update/${P}`,l,{withCredentials:!0,timeout:1e4}),s.success("Leave updated successfully"),N(!1),w(),h()}catch(l){console.error("Error updating leave:",l),l.response?s.error(((n=l.response.data)==null?void 0:n.message)||"Failed to update leave"):s.error("Failed to update leave. Please try again.")}},T=async(a,t)=>{var d;if(!(c(i,"Owner")||c(i,"HR"))){s.error("Access denied. Owner or HR privileges required.");return}try{await g.patch(`${y}/leaves/status/${a}`,{status:t},{withCredentials:!0,timeout:1e4}),s.success(`Leave ${t} successfully`),h()}catch(n){console.error(`Error ${t}ing leave:`,n),n.response?s.error(((d=n.response.data)==null?void 0:d.message)||`Failed to ${t} leave`):s.error(`Failed to ${t} leave. Please try again.`)}},_=async a=>{var t;if(!(c(i,"Owner")||c(i,"HR"))){s.error("Access denied. Owner or HR privileges required.");return}if(window.confirm("Are you sure you want to delete this leave request?"))try{await g.delete(`${y}/leaves/delete/${a}`,{withCredentials:!0,timeout:1e4}),s.success("Leave deleted successfully"),h()}catch(d){console.error("Error deleting leave:",d),d.response?s.error(((t=d.response.data)==null?void 0:t.message)||"Failed to delete leave"):s.error("Failed to delete leave. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Leave Management - CRM"}),e.jsx(J,{items:[{name:"Dashboard",path:"/"},{name:"Leave Management",path:"/leave-management"},{name:D.pathname.includes("/leave-management/requests")?"Leave Requests":"Manage Leaves"}]}),e.jsx(K,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}}),!S&&e.jsxs("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Access Limited"}),e.jsx("p",{children:"You don't have admin privileges. Some features may be unavailable."})]}),D.pathname.includes("/leave-management/requests")?e.jsx(L,{title:"Request Leave",children:e.jsx("form",{onSubmit:H,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeName",children:"Employee Name *"}),e.jsx(u,{type:"text",id:"employeeName",name:"employeeName",value:r.employeeName,onChange:m,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeId",children:"Employee ID *"}),e.jsx(u,{type:"text",id:"employeeId",name:"employeeId",value:r.employeeId,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsx(C,{options:[{value:"casual",label:"Casual Leave"},{value:"sick",label:"Sick Leave"},{value:"annual",label:"Annual Leave"},{value:"maternity",label:"Maternity Leave"},{value:"paternity",label:"Paternity Leave"}],value:r.leaveType,onChange:a=>k("leaveType",a)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"status",children:"Status"}),e.jsx(u,{type:"text",id:"status",name:"status",value:"pending",readOnly:!0,disabled:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(u,{type:"date",id:"startDate",name:"startDate",value:r.startDate,onChange:m,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",children:"End Date *"}),e.jsx(u,{type:"date",id:"endDate",name:"endDate",value:r.endDate,onChange:m,required:!0})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reason",children:"Reason *"}),e.jsx("textarea",{id:"reason",name:"reason",value:r.reason,onChange:m,rows:"4",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-hidden focus:ring-3 focus:ring-brand-500/20 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 focus:border-brand-300 dark:border-gray-700 dark:focus:border-brand-800 rounded-lg shadow-theme-xs",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"reset",onClick:w,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Reset"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Submit Request"})]})]})})}):e.jsx(e.Fragment,{children:R&&S?e.jsx(L,{title:"Edit Leave Request",children:e.jsx("form",{onSubmit:B,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeName",children:"Employee Name *"}),e.jsx(u,{type:"text",id:"employeeName",name:"employeeName",value:r.employeeName,onChange:m,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"employeeId",children:"Employee ID *"}),e.jsx(u,{type:"text",id:"employeeId",name:"employeeId",value:r.employeeId,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsx(C,{options:[{value:"casual",label:"Casual Leave"},{value:"sick",label:"Sick Leave"},{value:"annual",label:"Annual Leave"},{value:"maternity",label:"Maternity Leave"},{value:"paternity",label:"Paternity Leave"}],value:r.leaveType,onChange:a=>k("leaveType",a)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"status",children:"Status *"}),e.jsx(C,{options:[{value:"pending",label:"Pending"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"}],value:r.status,onChange:a=>k("status",a)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(u,{type:"date",id:"startDate",name:"startDate",value:r.startDate,onChange:m,required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",children:"End Date *"}),e.jsx(u,{type:"date",id:"endDate",name:"endDate",value:r.endDate,onChange:m,required:!0})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reason",children:"Reason *"}),e.jsx("textarea",{id:"reason",name:"reason",value:r.reason,onChange:m,rows:"4",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-hidden focus:ring-3 focus:ring-brand-500/20 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 focus:border-brand-300 dark:border-gray-700 dark:focus:border-brand-800 rounded-lg shadow-theme-xs",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),w()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Update Leave"})]})]})})}):e.jsx(L,{title:"Manage Leave Requests",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:"Search by Name or Brand...",value:F,onChange:a=>A(a.target.value),className:"w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"})}),E?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading leave requests..."})}):q.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No leave requests found."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Applied On"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Leave Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Dates"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700",children:q.filter(a=>{var l,v;const t=F.toLowerCase(),d=((l=a.userId)==null?void 0:l.fullName)||a.employeeName||"",n=((v=a.brand)==null?void 0:v.name)||"";return d.toLowerCase().includes(t)||n.toLowerCase().includes(t)}).map(a=>{var t,d;return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((t=a.userId)==null?void 0:t.fullName)||a.employeeName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Code: ",((d=a.userId)==null?void 0:d.employeeCode)||a.employeeCode]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.leaveType})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[new Date(a.startDate).toLocaleDateString()," - ",new Date(a.endDate).toLocaleDateString()]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.status==="approved"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":a.status==="rejected"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100"}`,children:a.status}),a.actionBy&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["By: ",a.actionBy.fullName]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(c(i,"Owner")||c(i,"HR"))&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(a._id),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-3",children:"Edit"}),a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(a._id,"approved"),className:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 mr-3",children:"Approve"}),e.jsx("button",{onClick:()=>T(a._id,"rejected"),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 mr-3",children:"Reject"})]}),e.jsx("button",{onClick:()=>_(a._id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Delete"})]})})]},a._id)})})]})})]})})})]})};export{V as default};
