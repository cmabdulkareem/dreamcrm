import{af as Y,r as c,w as P,j as e,am as G,P as J,E as K,B as g,C as Q,T as W,o as X,p as N,q as n,s as Z,t as _,M as E,x as f,I as ee,b as h,c as m,y as o}from"./index-BNEGGE57.js";import{S as H}from"./chevron-up-D72zhKQL.js";const re=()=>{var B,T,D;const{user:x}=Y(),[w,k]=c.useState([]),[U,z]=c.useState(!0),[t,y]=c.useState(null),[v,C]=c.useState(""),[L,R]=c.useState(!1),b=P(),p=P(),[l,u]=c.useState({title:"",description:"",type:"issue",priority:"medium"}),[A,S]=c.useState(!1),j=async()=>{try{const s=await h.get(`${m}/support`,{withCredentials:!0});k(s.data)}catch(s){console.error("Error fetching support requests:",s),o.error("Failed to load requests.")}finally{z(!1)}};c.useEffect(()=>{j()},[]);const I=async s=>{var i,a;if(s.preventDefault(),!l.title.trim()||!l.description.trim()){o.error("Title and description are required.");return}S(!0);try{await h.post(`${m}/support`,l,{withCredentials:!0}),o.success("Request submitted successfully!"),u({title:"",description:"",type:"issue",priority:"medium"}),p.closeModal(),j()}catch(r){console.error("Error submitting support request:",r),o.error(((a=(i=r.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to submit request.")}finally{S(!1)}},O=async(s,i,a)=>{try{await h.patch(`${m}/support/${s}/status`,{status:i},{withCredentials:!0}),o.success(`Status updated to ${i}`),j(),(t==null?void 0:t._id)===s&&y(r=>({...r,status:i}))}catch(r){console.error("Error updating status:",r),o.error("Failed to update status.")}},V=async()=>{if(!(!v.trim()||!t)){R(!0);try{const s=await h.post(`${m}/support/${t._id}/responses`,{message:v},{withCredentials:!0});o.success("Response sent!"),C(""),y(s.data.support),j()}catch(s){console.error("Error sending response:",s),o.error("Failed to send response.")}finally{R(!1)}}},M=async(s,i)=>{i&&i.stopPropagation();try{const a=await h.post(`${m}/support/${s}/upvote`,{},{withCredentials:!0});k(r=>r.map(d=>d._id===s?{...d,upvotes:a.data.upvotes}:d)),(t==null?void 0:t._id)===s&&y(r=>({...r,upvotes:a.data.upvotes})),o.success(a.data.message)}catch(a){console.error("Error upvoting:",a),o.error("Failed to upvote.")}},q=s=>{y(s),b.openModal()},F=s=>{switch(s){case"pending":return"warning";case"developing":return"info";case"fixing":return"primary";case"done":return"success";default:return"light"}};if(U)return e.jsx("div",{className:"p-6 text-center",children:"Loading requests..."});const $=G(x);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Feature Request & Support | DreamCRM"}),e.jsx(K,{pageTitle:"Feature Request & Support"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{variant:"primary",size:"sm",onClick:p.openModal,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 border-0 shadow-lg hover:shadow-xl transition-all duration-200",children:"+ New Request"})}),e.jsx(Q,{title:"Recent Requests",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(X,{className:"border-b border-gray-100 dark:border-gray-800",children:e.jsxs(N,{children:[e.jsx(n,{isHeader:!0,className:"px-5 py-3 text-left font-semibold text-gray-500 text-xs uppercase",children:"Request"}),e.jsx(n,{isHeader:!0,className:"px-5 py-3 text-left font-semibold text-gray-500 text-xs uppercase",children:"Votes"}),e.jsx(n,{isHeader:!0,className:"px-5 py-3 text-left font-semibold text-gray-500 text-xs uppercase",children:"Status"}),e.jsx(n,{isHeader:!0,className:"px-5 py-3 text-left font-semibold text-gray-500 text-xs uppercase",children:"Priority"}),e.jsx(n,{isHeader:!0,className:"px-5 py-3 text-right font-semibold text-gray-500 text-xs uppercase",children:"Action"})]})}),e.jsx(Z,{children:w.length===0?e.jsx(N,{children:e.jsx(n,{colSpan:6,className:"px-5 py-10 text-center text-gray-500",children:"No requests found."})}):w.map(s=>{var i,a,r;return e.jsxs(N,{className:"hover:bg-gray-50 dark:hover:bg-white/[0.02] cursor-pointer",onClick:()=>q(s),children:[e.jsx(n,{className:"px-5 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-800 dark:text-white mb-0.5 line-clamp-1",children:["#",s._id.slice(-6).toUpperCase()]}),e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-white mb-0.5 line-clamp-1",children:s.title}),e.jsxs("span",{className:"text-xs text-gray-400",children:["By ",(i=s.createdBy)==null?void 0:i.fullName]})]})}),e.jsx(n,{className:"px-5 py-4",children:e.jsxs("button",{onClick:d=>M(s._id,d),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg border transition-all ${(a=s.upvotes)!=null&&a.includes(x==null?void 0:x.id)?"bg-brand-50 border-brand-200 text-brand-600":"bg-white border-gray-100 text-gray-500 hover:border-brand-200 hover:text-brand-600 dark:bg-gray-900 dark:border-gray-800"}`,children:[e.jsx(H,{className:"size-4"}),e.jsx("span",{className:"text-xs font-bold",children:((r=s.upvotes)==null?void 0:r.length)||0})]})}),e.jsx(n,{className:"px-5 py-4",children:e.jsx(_,{color:F(s.status),className:"uppercase text-[10px] font-bold",children:s.status})}),e.jsx(n,{className:"px-5 py-4",children:e.jsx("span",{className:`text-[10px] font-bold uppercase ${s.priority==="critical"?"text-red-500":"text-gray-400"}`,children:s.priority})}),e.jsx(n,{className:"px-5 py-4 text-right",children:e.jsx("button",{onClick:()=>q(s),className:"text-brand-500 hover:text-brand-600 text-xs font-bold uppercase tracking-wider",children:"View"})})]},s._id)})})]})})}),t&&e.jsx(E,{isOpen:b.isOpen,onClose:b.closeModal,className:"max-w-3xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(_,{color:F(t.status),className:"uppercase text-[10px] font-bold",children:t.status}),e.jsxs("span",{className:"text-xs text-gray-400 font-medium",children:["#",t._id.slice(-6).toUpperCase()]}),e.jsxs("span",{className:`text-xs font-bold uppercase ${t.priority==="critical"?"text-red-500":"text-gray-400"}`,children:["[",t.priority,"]"]})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Submitted by ",e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:(B=t.createdBy)==null?void 0:B.fullName}),$&&t.brand&&e.jsxs("span",{className:"ml-2",children:["â€¢ Brand: ",e.jsx("span",{className:"font-semibold text-brand-500",children:t.brand.name})]})]}),e.jsxs("button",{onClick:s=>M(t._id,s),className:`flex items-center gap-1.5 px-3 py-1 rounded-full border text-xs font-bold transition-all ${(T=t.upvotes)!=null&&T.includes(x==null?void 0:x.id)?"bg-brand-500 border-brand-500 text-white shadow-lg shadow-brand-500/20":"bg-white border-gray-200 text-gray-500 hover:border-brand-500 hover:text-brand-500 dark:bg-gray-800 dark:border-gray-700"}`,children:[e.jsx(H,{className:"size-3.5"}),e.jsxs("span",{children:[((D=t.upvotes)==null?void 0:D.length)||0," Upvotes"]})]})]})]}),$&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"text-xs rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-1.5 outline-none focus:ring-2 focus:ring-brand-500",value:t.status,onChange:s=>O(t._id,s.target.value),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"developing",children:"Developing"}),e.jsx("option",{value:"fixing",children:"Fixing"}),e.jsx("option",{value:"done",children:"Done"})]})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-white/[0.02] rounded-xl p-5 mb-8",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap",children:t.description})]}),e.jsxs("div",{className:"space-y-6 pt-6 border-t border-gray-100 dark:border-gray-800",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Responses & Updates"}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto space-y-4 pr-2 custom-scrollbar",children:t.responses.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"No responses yet."}):t.responses.map((s,i)=>{var a,r,d;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"size-8 rounded-full bg-brand-500/10 flex items-center justify-center shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-brand-600 uppercase",children:(r=(a=s.sender)==null?void 0:a.fullName)==null?void 0:r[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700 dark:text-white",children:(d=s.sender)==null?void 0:d.fullName}),e.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.message})]})]},i)})}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("textarea",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-3 text-sm outline-none focus:ring-2 focus:ring-brand-500",rows:3,placeholder:"Type your response...",value:v,onChange:s=>C(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:b.closeModal,children:"Close"}),e.jsx(g,{size:"sm",variant:"primary",loading:L,onClick:V,children:"Send Response"})]})]})]})]})}),e.jsx(E,{isOpen:p.isOpen,onClose:p.closeModal,className:"max-w-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-2",children:"New Support Request"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6 font-medium",children:"Have a suggestion or found a bug? Let us know! Your feedback helps us improve the system."}),e.jsxs("form",{onSubmit:I,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"title",required:!0,children:"Title"}),e.jsx(ee,{id:"title",placeholder:"Brief title of your request",value:l.title,onChange:s=>u({...l,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"type",children:"Type"}),e.jsxs("select",{id:"type",className:"w-full h-11 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 outline-none focus:ring-2 focus:ring-brand-500",value:l.type,onChange:s=>u({...l,type:s.target.value}),children:[e.jsx("option",{value:"issue",children:"Issue / Problem"}),e.jsx("option",{value:"feature-request",children:"Feature Request"}),e.jsx("option",{value:"bug",children:"Bug Report"})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"priority",children:"Priority"}),e.jsxs("select",{id:"priority",className:"w-full h-11 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 outline-none focus:ring-2 focus:ring-brand-500",value:l.priority,onChange:s=>u({...l,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"description",required:!0,children:"Description"}),e.jsx("textarea",{id:"description",rows:4,className:"w-full rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2 text-sm text-gray-700 dark:text-gray-300 outline-none focus:ring-2 focus:ring-brand-500",placeholder:"Please provide details about your request...",value:l.description,onChange:s=>u({...l,description:s.target.value}),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100 dark:border-gray-800",children:[e.jsx(g,{variant:"outline",type:"button",onClick:p.closeModal,children:"Cancel"}),e.jsx(g,{variant:"primary",type:"submit",loading:A,children:"Submit Request"})]})]})]})})]})};export{re as default};
