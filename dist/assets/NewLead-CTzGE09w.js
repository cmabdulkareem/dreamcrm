import{r as s,A as ta,K as sa,c as na,u as ra,G as _e,d as g,e as f,k,X as ia,Y as oa,j as e,E as la,N as ca,D as Ae,H as i,I as l,Z as Fe,_ as Me,U as p,$ as da,a0 as ma,a1 as ha,a2 as ua,a3 as pa,a4 as xa,B as C,M as qe,t as ga,y as c}from"./index-BTKtjo01.js";import{D as Le}from"./date-picker-DAovfHJc.js";import"./calender-line-BOFzFji2.js";function va(){const{user:o}=s.useContext(ta),{addEvent:Re}=sa(),Ie=na(),{addNotification:Ge,areToastsEnabled:$e}=ra(),[y,z]=s.useState(!1),[w,E]=s.useState(""),[v,D]=s.useState(""),[b,V]=s.useState(""),[Z,H]=s.useState(""),[T,W]=s.useState(""),[J,K]=s.useState(""),[d,X]=s.useState(""),[x,Y]=s.useState(""),[Q,ee]=s.useState(""),[m,ae]=s.useState(""),[j,te]=s.useState(""),[O,se]=s.useState(["General"]),[h,_]=s.useState(""),[N,ne]=s.useState(""),[A,F]=s.useState(""),[M,re]=s.useState(""),[P,ie]=s.useState(""),[q,oe]=s.useState(""),[le,L]=s.useState(!1),[Be,ce]=s.useState([]),[Ue,de]=s.useState([]),[ze,me]=s.useState([]),[n,he]=s.useState({}),{isOpen:Ve,openModal:Ze,closeModal:R}=_e(),[I,ue]=s.useState(""),[pe,xe]=s.useState(""),[G,ge]=s.useState(""),[$,fe]=s.useState(""),[Ce,we]=s.useState(!0),{isOpen:He,openModal:Te,closeModal:B}=_e(),[U,ve]=s.useState(""),[je,Ne]=s.useState(""),[Pe,ye]=s.useState(!0);s.useEffect(()=>{const a=sessionStorage.getItem("prefillLeadData");if(a){const{fullName:t,email:r}=JSON.parse(a);E(t||""),D(r||""),sessionStorage.removeItem("prefillLeadData")}be(),Se(),We()},[]);const We=async()=>{try{const t=(await g.get(`${f}/course-categories/all`,{withCredentials:!0})).data.categories.filter(r=>r.isActive).map(r=>({value:r.name,label:r.name}));me(t)}catch(a){console.error("Error fetching course categories:",a),me([{value:"General",label:"General"}])}},be=async()=>{try{const t=(await g.get(`${f}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(r=>({value:r.value,label:r.name}));k(o)&&t.push({value:"__add_new__",label:"+ Add New Campaign"}),ce(t)}catch(a){console.error("Error fetching campaigns:",a);const t=[...ia];k(o)&&t.push({value:"__add_new__",label:"+ Add New Campaign"}),ce(t)}},Se=async()=>{try{const t=(await g.get(`${f}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(r=>({value:r.value,label:r.name}));t.push({value:"other",label:"Other"}),k(o)&&t.push({value:"__add_new__",label:"+ Add New Contact Point"}),de(t)}catch(a){console.error("Error fetching contact points:",a);const t=[...oa];k(o)&&t.push({value:"__add_new__",label:"+ Add New Contact Point"}),de(t)}},ke=a=>{if(!a||!a.trim())return L(!1),!0;const t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a);return L(!t),t},Je=a=>{const t=a.target.value;D(t),ke(t)},Ke=a=>{a==="__add_new__"?Ze():F(a)},Xe=a=>{a==="__add_new__"?Te():_(a)},Ye=async()=>{var a,t;if(!I.trim()){c.error("Campaign name is required");return}try{const r=await g.post(`${f}/campaigns/create`,{name:I,description:pe,discountPercentage:G?parseFloat(G):0,cashback:$?parseFloat($):0,isActive:Ce},{withCredentials:!0});c.success("Campaign created successfully!"),F(r.data.campaign.value),await be(),R(),ue(""),xe(""),ge(""),fe(""),we(!0)}catch(r){console.error("Error creating campaign:",r),c.error(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create campaign")}},Qe=async()=>{var a,t;if(!U.trim()){c.error("Contact point name is required");return}try{const r=await g.post(`${f}/contact-points/create`,{name:U,description:je,isActive:Pe},{withCredentials:!0});c.success("Contact point created successfully!"),_(r.data.contactPoint.value),await Se(),B(),ve(""),Ne(""),ye(!0)}catch(r){console.error("Error creating contact point:",r),c.error(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create contact point")}},ea=()=>{const a={};return w.trim()||(a.fullName="Full Name is required"),v.trim()&&!ke(v)&&(a.email="Please enter a valid email address"),b.trim()||(a.phone1="Phone is required"),d?d==="Other"&&!x.trim()&&(a.otherPlace="Please specify the place"):a.place="Place is required",m?m==="Other"&&!j.trim()&&(a.otherEducation="Please specify the education"):a.education="Education is required",O.length===0&&(a.coursePreference="Course preference is required"),h||(a.contactPoint="Contact point is required"),h==="other"&&!N.trim()&&(a.otherContactPoint="Please specify the contact point"),A||(a.campaign="Campaign is required"),P||(a.followUpDate="Next follow up date is required"),M.trim()||(a.leadRemarks="Remarks are required"),q||(a.leadPotential="Lead Potential is required"),he(a),Object.keys(a).length===0},Ee=()=>{E(""),D(""),V(""),H(""),W(""),K(""),X(""),Y(""),ee(""),ae(""),te(""),se(["General"]),_(""),ne(""),F(""),re(""),ie(""),oe(""),L(!1),he({})},aa=async a=>{var r,De,Oe;if(a.preventDefault(),y)return;if(!ea()){c.error("Please fill in all required fields");return}z(!0);const t={fullName:w,email:v.trim()||null,phone1:b,phone2:Z,gender:T,dob:J,place:d==="Other"?x:d,otherPlace:d==="Other"?x:"",status:Q,education:m,otherEducation:m==="Other"?j:"",coursePreference:O,contactPoint:h,otherContactPoint:h==="other"?N:"",campaign:A,handledBy:(o==null?void 0:o.fullName)||"Unknown",leadRemarks:M,followUpDate:P,leadPotential:q};try{const u=await g.post(`${f}/customers/create`,t,{withCredentials:!0});if(u.status===201){if(P)try{const S=P;Re({title:`Follow-up: ${w}`,start:S,end:S,allDay:!0,extendedProps:{calendar:"Warning",leadId:u.data.customer._id,phone:b,email:v,status:u.data.customer.leadStatus||"new"}})}catch(S){console.error("Error creating calendar event:",S)}Ge({type:"lead_created",userName:(o==null?void 0:o.fullName)||"Someone",avatar:(o==null?void 0:o.avatar)||null,action:"added new lead",entityName:w,module:"Lead Management"}),$e()&&c.success("Lead created successfully!",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),Ee(),Ie("/lead-management")}}catch(u){console.error("Error creating lead:",u),((r=u.response)==null?void 0:r.status)===401?c.error("Please login to create a lead."):c.error(((Oe=(De=u.response)==null?void 0:De.data)==null?void 0:Oe.message)||"Failed to create lead. Please try again.")}finally{z(!1)}};return e.jsxs("div",{children:[e.jsx(la,{title:"New Lead | DreamCRM",description:"Add new enquiry here"}),e.jsx(ca,{pageTitle:"New Enquiry"}),e.jsxs("form",{onSubmit:aa,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(Ae,{title:"Basic Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(l,{type:"text",id:"firstName",value:w,onChange:a=>E(a.target.value),error:!!n.fullName,hint:n.fullName})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{children:"Email"}),e.jsx(l,{type:"email",id:"new-lead-email",value:v,error:le||!!n.email,onChange:Je,placeholder:"Enter your email (optional)",hint:n.email||(le?"This is an invalid email address.":"")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{children:"Phone *"}),e.jsx(Fe,{id:"new-lead-phone",selectPosition:"end",countries:Me,placeholder:"+91 98765 43210",value:b,onChange:V,error:!!n.phone1,hint:n.phone1})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(i,{children:"Phone (optional)"}),e.jsx(Fe,{selectPosition:"end",countries:Me,placeholder:"+91 98765 43210",value:Z,onChange:H})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(i,{children:"Gender"}),e.jsx(p,{options:da,value:T,placeholder:"Select Gender",onChange:W})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Le,{id:"dob",label:"DoB",value:J,onChange:(a,t)=>K(t)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(i,{children:"Place *"}),e.jsx(p,{options:ma,value:d,placeholder:"Select Place",onChange:X,error:!!n.place,hint:n.place})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(i,{htmlFor:"otherPlace",children:"Specify other *"}),e.jsx(l,{type:"text",id:"otherPlace",value:x,onChange:a=>Y(a.target.value),disabled:d!=="Other",error:d==="Other"&&!x.trim()&&!!n.otherPlace,hint:d==="Other"&&!x.trim()?n.otherPlace:""})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(i,{children:"Current Status"}),e.jsx(p,{options:ha,value:Q,placeholder:"Select Status",onChange:ee})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(i,{children:"Education *"}),e.jsx(p,{options:ua,value:m,placeholder:"Select Education",onChange:ae,error:!!n.education,hint:n.education})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(i,{htmlFor:"otherEducation",children:"Specify other *"}),e.jsx(l,{type:"text",id:"otherEducation",value:j,onChange:a=>te(a.target.value),disabled:m!=="Other",error:m==="Other"&&!j.trim()&&!!n.otherEducation,hint:m==="Other"&&!j.trim()?n.otherEducation:""})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(Ae,{title:"Enquiry / Lead Information",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(pa,{label:"Course Preference *",id:"new-lead-course-preference",options:ze,selectedValues:O,onChange:se,error:!!n.coursePreference,hint:n.coursePreference})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Contact Point *"}),e.jsx(p,{options:Ue,value:h,placeholder:"Contact Point",onChange:Xe,error:!!n.contactPoint,hint:n.contactPoint})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(i,{htmlFor:"otherContactPoint",children:"Specify other *"}),e.jsx(l,{type:"text",id:"otherContactPoint",value:N,onChange:a=>ne(a.target.value),disabled:h!=="other",error:h==="other"&&!N.trim()&&!!n.otherContactPoint,hint:h==="other"&&!N.trim()?n.otherContactPoint:""})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Campaign *"}),e.jsx(p,{options:Be,value:A,placeholder:"Campaigns",id:"new-lead-campaign",onChange:Ke,error:!!n.campaign,hint:n.campaign})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsx(Le,{id:"followupDate",label:"Next Follow Up Date *",value:P,disablePastDates:!0,onChange:(a,t)=>ie(t),error:!!n.followUpDate,hint:n.followUpDate})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(i,{htmlFor:"leadRemarks",children:"Remarks *"}),e.jsx(l,{type:"text",id:"leadRemarks",value:M,onChange:a=>re(a.target.value),error:!!n.leadRemarks,hint:n.leadRemarks})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Lead Potential *"}),e.jsx(p,{options:xa,value:q,placeholder:"Select Lead Potential",onChange:oe,error:!!n.leadPotential,hint:n.leadPotential})]})})]})})})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-6",children:[e.jsx(C,{type:"button",onClick:Ee,variant:"outline",disabled:y,children:"Clear"}),e.jsx(C,{variant:"primary",type:"submit",disabled:y,id:"new-lead-submit-btn",children:y?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"})]})]}),e.jsxs(qe,{isOpen:Ve,onClose:R,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(l,{id:"newCampaignName",type:"text",value:I,onChange:a=>ue(a.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:pe,onChange:a=>xe(a.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(l,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:G,onChange:a=>ge(a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"newCampaignCashback",children:"Cashback (â‚¹)"}),e.jsx(l,{id:"newCampaignCashback",type:"number",min:"0",value:$,onChange:a=>fe(a.target.value),placeholder:"0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:Ce,onChange:a=>we(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(i,{htmlFor:"newCampaignActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active campaigns will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(C,{type:"button",variant:"outline",onClick:R,children:"Cancel"}),e.jsx(C,{type:"button",onClick:Ye,children:"Create Campaign"})]})]})]}),e.jsxs(qe,{isOpen:He,onClose:B,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Contact Point"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newContactPointName",children:"Contact Point Name *"}),e.jsx(l,{id:"newContactPointName",type:"text",value:U,onChange:a=>ve(a.target.value),placeholder:"e.g., Walk In"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newContactPointDesc",children:"Description"}),e.jsx("textarea",{id:"newContactPointDesc",value:je,onChange:a=>Ne(a.target.value),placeholder:"Contact point description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newContactPointActive",checked:Pe,onChange:a=>ye(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(i,{htmlFor:"newContactPointActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active contact points will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(C,{type:"button",variant:"outline",onClick:B,children:"Cancel"}),e.jsx(C,{type:"button",onClick:Qe,children:"Create Contact Point"})]})]})]}),e.jsx(ga,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{va as default};
