const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-CkwwK0Cl.js","assets/index-BRRNp47y.js","assets/index.DwceQDK3.css"])))=>i.map(i=>d[i]);
import{ac as ue,i as re,w as ae,h as se,r as o,R as _e,c as $,d as E,y as p,j as e,n as xe,a3 as Ae,k as me,M as ge,B as K,z as J,I as X,K as be,A as Ee,P as Pe,G as $e,C as Be,o as Te}from"./index-BRRNp47y.js";import{S as Fe}from"./StudentProfileModal-DvVowh50.js";import{S as Oe}from"./group-yPi5mrTw.js";function He({batchId:d,batchSubject:D,batchStartDate:c,batchEndDate:b,brandName:u}){const{user:g}=ue(),N=re(g)||ae(g)||se(g),[j,B]=o.useState([]),[I,T]=o.useState(!0),[M,h]=o.useState(!1),[w,A]=o.useState(null),[W,z]=o.useState(null),[F,R]=o.useState(!1),[y,i]=o.useState(null);_e.useRef(null);const[S,a]=o.useState([]),[s,f]=o.useState(""),[L,r]=o.useState(!1),[n,v]=o.useState(!1),_={studentId:"",studentName:"",dob:"",phoneNumber:"",parentPhoneNumber:""},[C,q]=o.useState(_),[k,H]=o.useState(_);o.useEffect(()=>{G()},[d]),o.useEffect(()=>{M&&S.length===0&&Y()},[M]);const G=async()=>{try{T(!0);const t=await $.get(`${E}/batches/${d}/students`,{withCredentials:!0});B(t.data.students)}catch(t){console.error("Error fetching students:",t)}finally{T(!1)}},Y=async()=>{try{r(!0);const t=await $.get(`${E}/students/all`,{withCredentials:!0});a(t.data.students)}catch{p.error("Failed to fetch student list for selection.")}finally{r(!1)}},he=S.filter(t=>{var l,Z;return j.some(ne=>ne.studentId&&ne.studentId._id===t._id||ne.studentId===t._id)?!1:((l=t.fullName)==null?void 0:l.toLowerCase().includes(s.toLowerCase()))||((Z=t.phone1)==null?void 0:Z.includes(s))||t.studentId&&t.studentId.toLowerCase().includes(s.toLowerCase())}),fe=async t=>{const x={studentId:t._id,studentName:t.fullName,dob:t.dob?new Date(t.dob).toISOString().split("T")[0]:"",phoneNumber:t.phone1,parentPhoneNumber:t.phone2||""};try{const l=await $.post(`${E}/batches/${d}/students`,x,{withCredentials:!0});B(Z=>[...Z,l.data.student]),f(""),v(!1),p.success(`${t.fullName} added successfully!`)}catch(l){console.error("Error adding student:",l),l.response&&l.response.data&&l.response.data.message?p.error(l.response.data.message):p.error("Failed to add student.")}},je=async t=>{if(t.preventDefault(),!C.studentName||!C.phoneNumber){p.error("Student Name and Phone Number are required.");return}const x={...C};(!x.studentId||x.studentId.length<24)&&delete x.studentId;try{const l=await $.post(`${E}/batches/${d}/students`,x,{withCredentials:!0});B([...j,l.data.student]),q(_),p.success("Student added successfully!")}catch(l){console.error(l),l.response&&l.response.data&&l.response.data.message?p.error(l.response.data.message):p.error("Failed to add student.")}},ke=t=>{const x=t.studentId&&typeof t.studentId=="object"?t.studentId:t;i(x),R(!0)},pe=t=>{const x=t.studentId&&typeof t.studentId=="object"?t.studentId:t,l=t.studentId&&typeof t.studentId=="object";return{id:l?x.studentId||"-":t.studentId||"-",name:l?x.fullName:t.studentName,dob:x.dob,phone:l?x.phone1:t.phoneNumber,parentPhone:l?x.phone2:t.parentPhoneNumber,course:l&&(x.courseName||x.coursePreference)||"",_id:t._id}},Ne=async t=>{if(t.preventDefault(),!k.studentName||!k.phoneNumber){p.error("Student Name and Phone Number are required.");return}try{await $.put(`${E}/batches/students/${w}`,k,{withCredentials:!0}),G(),A(null),p.success("Student updated successfully!")}catch{p.error("Failed to update student.")}},we=async t=>{if(window.confirm("Are you sure you want to remove this student?"))try{await $.delete(`${E}/batches/students/${t}`,{withCredentials:!0}),B(j.filter(x=>x._id!==t)),p.success("Student removed successfully.")}catch{p.error("Failed to remove student.")}},ve=async t=>{var x;z(t._id);try{const l=P=>new Promise((U,Q)=>{const O=new Image;O.crossOrigin="anonymous",O.onload=()=>U(O),O.onerror=()=>{console.error(`Failed to load image: ${P}`),Q(new Error(`Failed to load: ${P}`))},O.src=P}),ee=document.createElement("canvas");ee.width=1550,ee.height=2400;const m=ee.getContext("2d");let te="/images/cc_id_temp.png";if(u){const P=u.toLowerCase();P.includes("cadd")?te="/images/cc_id_temp.png":P.includes("synergy")?te="/images/syn_id_temp.png":P.includes("dream")?te="/images/dz_id_temp.png":P.includes("livewire")&&(te="/images/lw_id_temp.png")}const Se=await l(te);m.drawImage(Se,0,0,1550,2400);const de=pe(t);let V=((x=t.studentId)==null?void 0:x.photo)||t.photo;V&&!V.startsWith("http")&&!V.startsWith("data:")&&(V=`${E.replace("/api","")}/${V.replace(/^\//,"")}`),V||(V="/images/user/avatar.png");try{const P=await l(V),U=345,Q=422,O=905,le=U+O/2,ie=Q+O/2,ce=O/2;m.save(),m.beginPath(),m.arc(le,ie,ce,0,Math.PI*2),m.clip(),m.drawImage(P,U,Q,O,O),m.restore(),m.strokeStyle="#000",m.lineWidth=5,m.beginPath(),m.arc(le,ie,ce,0,Math.PI*2),m.stroke()}catch(P){console.error("Could not load student photo, drawing placeholder",P);const U=345,Q=422,O=905,le=U+O/2,ie=Q+O/2,ce=O/2;m.fillStyle="#f3f4f6",m.beginPath(),m.arc(le,ie,ce,0,Math.PI*2),m.fill()}m.fillStyle="#021349",m.font="bold 100px Arial",m.fillText(de.name||"Student Name",145,1595),m.fillStyle="#000000",m.font="bold 75px Arial",m.fillText(de.course||"",145,1680),m.fillStyle="#021349",m.font="normal 70px Arial",m.fillText(de.id||"Student ID",145,1800);const Ce=ee.toDataURL("image/jpeg",.95);m.clearRect(0,0,1550,2400);const De=await l("/images/cc_id_temp_back.png");if(m.drawImage(De,0,0,1550,2400),c&&b){const P=new Date(c).toLocaleDateString(),U=new Date(b).toLocaleDateString();m.fillStyle="#021349",m.font="bold 70px Arial",m.textAlign="center",m.fillText(`Start Date: ${P}`,1550/2,2030),m.fillText(`End Date: ${U}`,1550/2,2150)}const Ie=ee.toDataURL("image/jpeg",.95),{jsPDF:Me}=await Ae(async()=>{const{jsPDF:P}=await import("./jspdf.es.min-CkwwK0Cl.js").then(U=>U.j);return{jsPDF:P}},__vite__mapDeps([0,1,2])),oe=new Me({orientation:"portrait",unit:"pt",format:[1550*.75,2400*.75]});oe.addImage(Ce,"JPEG",0,0,1550*.75,2400*.75),oe.addPage(),oe.addImage(Ie,"JPEG",0,0,1550*.75,2400*.75);const Le=`${(de.name||"Student").trim().replace(/[^a-z0-9]/gi,"_")}_ID_Card.pdf`;oe.save(Le)}catch(l){console.error("ID Generation Error:",l),p.error(`Error: ${l.message}`)}finally{z(null)}};return I?e.jsx(xe,{className:"py-10"}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h6",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Total Students: ",j.length]}),N&&e.jsx("button",{onClick:()=>h(!M),className:"text-xs font-semibold px-3 py-1 bg-brand-50 text-brand-600 rounded-md hover:bg-brand-100 dark:bg-brand-900/30 dark:text-brand-400",children:M?"Done Adding":"+ Add Student"})]}),M&&e.jsxs("div",{className:"mb-4 p-4 bg-brand-50/50 dark:bg-brand-900/20 rounded-lg border border-brand-100 dark:border-brand-800",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-800 dark:text-white mb-3",children:"Add Student to Batch"}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Search Student (from Manage Students)"}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Search by name, phone or ID...",className:"w-full text-sm border-gray-300 rounded-md dark:bg-gray-800 dark:text-white dark:border-gray-600",value:s,onChange:t=>{f(t.target.value),v(!0)},onFocus:()=>v(!0),onBlur:()=>{setTimeout(()=>{v(!1)},200)}}),n&&s&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:L?e.jsx("div",{className:"p-2 text-xs text-gray-500",children:"Loading..."}):he.length>0?he.map(t=>e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-50 dark:border-gray-700/50 last:border-0",onMouseDown:x=>x.preventDefault(),onClick:()=>fe(t),children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.fullName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.studentId||"No ID"," | ",t.phone1]})]},t._id)):e.jsx("div",{className:"p-2 text-xs text-gray-500",children:"No matching students found."})})]}),e.jsxs("div",{className:"border-t border-gray-100 dark:border-gray-700 pt-3 mt-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2 italic",children:"Or enter details manually if not found in search:"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ID (Opt)"}),e.jsx("input",{type:"text",value:C.studentId,onChange:t=>q({...C,studentId:t.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white",placeholder:"Custom ID"})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:C.studentName,onChange:t=>q({...C,studentName:t.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white",placeholder:"Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"DOB"}),e.jsx("input",{type:"date",value:C.dob,onChange:t=>q({...C,dob:t.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Phone *"}),e.jsx("input",{type:"text",value:C.phoneNumber,onChange:t=>q({...C,phoneNumber:t.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white",placeholder:"Phone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Parent Phone"}),e.jsx("input",{type:"text",value:C.parentPhoneNumber,onChange:t=>q({...C,parentPhoneNumber:t.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white",placeholder:"Parent (Opt)"})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:je,className:"px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700 shadow-sm",children:"Add Manually"})})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-100 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Student ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"DOB"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Phone"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Parent Phone"}),N&&e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:[j.map(t=>{const x=pe(t);return e.jsx("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:w===t._id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:k.studentId,disabled:!0,className:"w-full text-sm border-gray-300 rounded bg-gray-100 cursor-not-allowed dark:bg-gray-700 dark:text-white"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:k.studentName,onChange:l=>H({...k,studentName:l.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"date",value:k.dob?new Date(k.dob).toISOString().split("T")[0]:"",onChange:l=>H({...k,dob:l.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:k.phoneNumber,onChange:l=>H({...k,phoneNumber:l.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:k.parentPhoneNumber,onChange:l=>H({...k,parentPhoneNumber:l.target.value}),className:"w-full text-sm border-gray-300 rounded dark:bg-gray-800 dark:text-white"})}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[e.jsx("button",{onClick:Ne,className:"text-green-600 hover:text-green-800 mr-2",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:()=>A(null),className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:x.id}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:e.jsx("span",{className:"cursor-pointer hover:text-brand-600 transition-colors font-medium",onClick:()=>ke(t),children:x.name})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400",children:x.dob?new Date(x.dob).toLocaleDateString():"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400",children:x.phone}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400",children:x.parentPhone||"-"}),N&&e.jsxs("td",{className:"px-4 py-2 text-right flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>ve(t),disabled:W===t._id,className:`p-1.5 rounded-md transition-colors ${W===t._id?"text-gray-300":"text-brand-500 hover:bg-brand-50"}`,title:"Generate ID Card",children:W===t._id?e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),e.jsx("button",{onClick:()=>{A(t._id),H(t)},className:"p-1.5 text-gray-400 hover:text-brand-600 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>we(t._id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t._id)}),!M&&j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-10 text-center text-sm text-gray-500",children:"No students enrolled in this batch yet."})})]})]})}),e.jsx(Fe,{isOpen:F,onClose:()=>R(!1),student:y})]})}function We({isOpen:d,onClose:D,batch:c}){const{user:b}=ue(),[u,g]=o.useState([]),[N,j]=o.useState(!1),[B,I]=o.useState(!1),[T,M]=o.useState(new Date().toLocaleDateString("en-CA")),[h,w]=o.useState({}),[A,W]=o.useState(!1),z=b&&c&&b.fullName===c.instructorName||me(b,"Instructor"),F=(re(b)||ae(b)||se(b)||z)&&!me(b,"Academic Coordinator");o.useEffect(()=>{d&&c&&(M(new Date().toLocaleDateString("en-CA")),R())},[d,c]);const R=async()=>{j(!0);try{const s=(await $.get(`${E}/batches/${c._id}/students`,{withCredentials:!0})).data.students;g(s);try{const L=(await $.get(`${E}/batches/${c._id}/attendance?date=${T}`,{withCredentials:!0})).data.attendance[0],r={};L?L.records.forEach(n=>{r[n.studentId]={status:n.status,remarks:n.remarks}}):s.forEach(n=>{r[n._id]={status:"Present",remarks:""}}),w(r)}catch(f){console.error("No existing attendance found or error fetching",f);const L={};s.forEach(r=>{L[r._id]={status:"Present",remarks:""}}),w(L)}}catch(a){console.error("Failed to fetch data:",a),p.error("Failed to load students.")}finally{j(!1)}},y=a=>{if(!c)return!1;const s=new Date(a),f=new Date(c.startDate),L=new Date(c.expectedEndDate);return s.setHours(0,0,0,0),f.setHours(0,0,0,0),L.setHours(0,0,0,0),s>=f&&s<=L},i=(a,s)=>{if(F){if(!y(T)){p.error("Attendance date must be within batch duration.");return}w(f=>({...f,[a]:{...f[a],status:s}}))}},S=async()=>{var a,s;if(F){if(!y(T)){p.error("Cannot mark attendance outside of batch dates.");return}I(!0);try{const f=Object.keys(h).map(L=>({studentId:L,status:h[L].status,remarks:h[L].remarks}));await $.post(`${E}/batches/${c._id}/attendance`,{date:T,records:f},{withCredentials:!0}),p.success("Attendance marked successfully!"),D()}catch(f){console.error("Error marking attendance:",f),p.error(((s=(a=f.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to mark attendance.")}finally{I(!1)}}};return d?e.jsx(ge,{isOpen:d,onClose:D,className:"max-w-4xl p-0 h-[90vh] sm:h-auto sm:max-h-[90vh]",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4 sm:p-6 border-b border-gray-100 dark:border-gray-700 shrink-0 pr-12 sm:pr-14",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:F?"Mark Attendance":"View Attendance"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400",children:[c==null?void 0:c.batchName," | ",new Date().toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 custom-scrollbar",children:N?e.jsx(xe,{className:"py-20"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Student Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:u.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:[e.jsx("div",{children:a.studentName}),e.jsx("div",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 mt-1",children:a.phoneNumber})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.jsx("div",{className:"flex gap-2",children:["Present","Absent","Late","Excused","Holiday"].map(s=>{var f;return e.jsx("button",{onClick:()=>i(a._id,s),disabled:!F,className:`px-3 py-1 rounded-full text-xs font-medium transition-colors border 
                                                            ${((f=h[a._id])==null?void 0:f.status)===s?s==="Present"?"bg-green-100 text-green-800 border-green-200":s==="Absent"?"bg-red-100 text-red-800 border-red-200":s==="Late"?"bg-yellow-100 text-yellow-800 border-yellow-200":s==="Holiday"?"bg-purple-100 text-purple-800 border-purple-200":"bg-blue-100 text-blue-800 border-blue-200":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600"}
                                                            ${F?"":"cursor-default opacity-80"}
                                                        `,children:s},s)})})})]},a._id))})]})}),e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-100 dark:border-gray-600",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2 italic",children:"Attendance Legend"}),e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[{l:"P",n:"Present",c:"bg-green-100 text-green-800 border-green-200"},{l:"A",n:"Absent",c:"bg-red-100 text-red-800 border-red-200"},{l:"L",n:"Late",c:"bg-yellow-100 text-yellow-800 border-yellow-200"},{l:"E",n:"Excused",c:"bg-blue-100 text-blue-800 border-blue-200"},{l:"H",n:"Holiday",c:"bg-purple-100 text-purple-800 border-purple-200"}].map(a=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold border ${a.c}`,children:a.l}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:a.n})]},a.l))})]}),e.jsx("div",{className:"space-y-4",children:u.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 dark:text-white",children:a.studentName}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:a.phoneNumber})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Present","Absent","Late","Excused","Holiday"].map(s=>{var f;return e.jsx("button",{onClick:()=>i(a._id,s),disabled:!F,className:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold transition-colors border
                                                    ${((f=h[a._id])==null?void 0:f.status)===s?s==="Present"?"bg-green-100 text-green-800 border-green-200":s==="Absent"?"bg-red-100 text-red-800 border-red-200":s==="Late"?"bg-yellow-100 text-yellow-800 border-yellow-200":s==="Holiday"?"bg-purple-100 text-purple-800 border-purple-200":"bg-blue-100 text-blue-800 border-blue-200":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600"}
                                                    ${F?"":"cursor-default opacity-80"}
                                                `,children:s.charAt(0)},s)})})]},a._id))})]})]})}),e.jsxs("div",{className:"mt-auto p-4 sm:p-6 border-t border-gray-100 dark:border-gray-700 flex justify-end gap-3 shrink-0",children:[e.jsx(K,{variant:"outline",onClick:D,className:"px-4 py-2",children:"Close"}),F&&e.jsx(K,{variant:"primary",onClick:S,loading:B,className:"px-6 py-2",children:"Save Attendance"})]})]})}):null}function ze({isOpen:d,onClose:D,batch:c}){const[b,u]=o.useState(!1),[g,N]=o.useState(new Date().getMonth()+1),[j,B]=o.useState(new Date().getFullYear()),[I,T]=o.useState([]),[M,h]=o.useState([]),w=["January","February","March","April","May","June","July","August","September","October","November","December"],A=new Date().getFullYear(),W=[A-1,A,A+1];o.useEffect(()=>{d&&c&&z()},[d,c,g,j]);const z=async()=>{u(!0);try{const n=(await $.get(`${E}/batches/${c._id}/students`,{withCredentials:!0})).data.students;h(n);const v=await $.get(`${E}/batches/${c._id}/attendance?month=${g}&year=${j}`,{withCredentials:!0});T(v.data.attendance)}catch(r){console.error("Failed to fetch monthly attendance:",r),p.error("Failed to load attendance report.")}finally{u(!1)}},R=((r,n)=>new Date(n,r,0).getDate())(g,j),y=Array.from({length:R},(r,n)=>n+1),i=()=>{const r={},n={},v={present:0,absent:0,late:0,excused:0,holiday:0},_={};return M.forEach(C=>{r[C._id]={},n[C._id]={present:0,absent:0,late:0,excused:0,holiday:0,totalSessions:0}}),I.forEach(C=>{const k=new Date(C.date).getDate();C.records.forEach(H=>{if(r[H.studentId]&&(r[H.studentId][k]=H.status,n[H.studentId])){const G=n[H.studentId],Y=H.status;_[k]||(_[k]={present:0,absent:0,late:0,excused:0,holiday:0}),Y==="Holiday"?(G.holiday++,v.holiday++,_[k].holiday++):(G.totalSessions++,Y==="Present"?(G.present++,v.present++,_[k].present++):Y==="Absent"?(G.absent++,v.absent++,_[k].absent++):Y==="Late"?(G.late++,v.late++,_[k].late++):Y==="Excused"&&(G.excused++,v.excused++,_[k].excused++))}})}),{studentMap:r,statsMap:n,monthlySummary:v,dailyStats:_}},{studentMap:S,statsMap:a,monthlySummary:s,dailyStats:f}=i(),L=r=>{if(!r)return e.jsx("span",{className:"text-gray-200 text-xs",children:"-"});let n="text-gray-500",v=r.charAt(0);switch(r){case"Present":n="bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800";break;case"Absent":n="bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800";break;case"Late":n="bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-800";break;case"Excused":n="bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800";break;case"Holiday":n="bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-400 dark:border-purple-800";break;default:n="bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800/50 dark:text-gray-600 dark:border-gray-800";break}return e.jsx("div",{className:`w-6 h-6 flex items-center justify-center rounded-full text-[10px] sm:text-xs font-bold mx-auto border ${n}`,children:v})};return d?e.jsxs(ge,{isOpen:d,onClose:D,className:"max-w-6xl p-6 h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6 shrink-0 pr-10 sm:pr-12",children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:["Monthly Attendance Report - ",c==null?void 0:c.batchName]}),e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx("select",{value:g,onChange:r=>N(Number(r.target.value)),className:"p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:w.map((r,n)=>e.jsx("option",{value:n+1,children:r},n))}),e.jsx("select",{value:j,onChange:r=>B(Number(r.target.value)),className:"p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:W.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),!b&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl border border-gray-100 dark:border-gray-600 shrink-0",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase mb-3 tracking-widest",children:"Monthly Status Indicators"}),e.jsx("div",{className:"flex flex-wrap gap-x-8 gap-y-3",children:[{l:"P",n:"Present",c:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-400",count:s.present},{l:"A",n:"Absent",c:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-400",count:s.absent},{l:"L",n:"Late",c:"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-400",count:s.late},{l:"E",n:"Excused",c:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400",count:s.excused},{l:"H",n:"Holiday",c:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-400",count:s.holiday}].map(r=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold border shadow-sm ${r.c}`,children:r.l}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-400 dark:text-gray-500 uppercase leading-none mb-1",children:r.n}),e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-white leading-none",children:r.count})]})]},r.l))})]}),e.jsx("div",{className:"flex-1 overflow-auto border rounded-lg",children:b?e.jsx(xe,{className:"h-full"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider sticky left-0 bg-gray-50 dark:bg-gray-700 z-20 border-r dark:border-gray-600 min-w-[150px] sm:min-w-[200px]",children:"Student Name"}),y.map(r=>{const n=new Date(j,g-1,r),v=["S","M","T","W","T","F","S"][n.getDay()],_=n.getDay()===0;return e.jsxs("th",{className:`px-1 py-2 text-center text-[10px] font-medium min-w-[32px] border-l dark:border-gray-600 ${_?"text-red-600 bg-red-50 dark:bg-red-900/20":"text-gray-500 dark:text-gray-300"}`,children:[e.jsx("div",{className:"mb-0.5",children:v}),e.jsx("div",{className:"text-[11px]",children:r})]},r)}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider bg-gray-50 dark:bg-gray-700 sticky right-0 z-20 border-l dark:border-gray-600",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider bg-gray-50 dark:bg-gray-700 sticky right-0 z-20 border-l dark:border-gray-600",children:"%"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:M.map(r=>{const n=a[r._id]||{present:0,totalSessions:0},v=n.totalSessions>0?Math.round(n.present/n.totalSessions*100):0;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white sticky left-0 bg-white dark:bg-gray-800 z-10 border-r dark:border-gray-600 max-w-[150px] sm:max-w-none truncate",children:r.studentName}),y.map(_=>{var k;const q=new Date(j,g-1,_).getDay()===0;return e.jsx("td",{className:`px-1 py-1 text-center border-l border-gray-100 dark:border-gray-700 ${q?"bg-red-50/50 dark:bg-red-900/5":""}`,children:L((k=S[r._id])==null?void 0:k[_])},_)}),e.jsxs("td",{className:"px-4 py-2 text-center text-sm text-gray-900 dark:text-white sticky right-0 bg-white dark:bg-gray-800 z-10 border-l dark:border-gray-600 font-semibold",children:[e.jsx("span",{className:"text-green-600",children:n.present})," / ",n.totalSessions]}),e.jsx("td",{className:"px-4 py-2 text-center text-sm sticky right-0 bg-white dark:bg-gray-800 z-10 border-l dark:border-gray-600 font-bold",children:e.jsxs("span",{className:v>=75?"text-green-600":v>=50?"text-yellow-600":"text-red-600",children:[v,"%"]})})]},r._id)})}),e.jsxs("tfoot",{className:"bg-gray-50 dark:bg-gray-700/30 sticky bottom-0 z-10",children:[e.jsxs("tr",{className:"border-t-2 border-gray-200 dark:border-gray-600",children:[e.jsx("td",{className:"px-4 py-2 font-bold text-[10px] uppercase tracking-wider text-gray-500 sticky left-0 bg-gray-50 dark:bg-gray-700 z-10 border-r dark:border-gray-600",children:"Total Presents"}),y.map(r=>{var n;return e.jsx("td",{className:"px-1 py-1 text-center font-bold text-[11px] border-l border-gray-100 dark:border-gray-700 text-green-600",children:((n=f[r])==null?void 0:n.present)||0},r)}),e.jsx("td",{colSpan:2,className:"bg-gray-50 dark:bg-gray-700"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-bold text-[10px] uppercase tracking-wider text-gray-500 sticky left-0 bg-gray-50 dark:bg-gray-700 z-10 border-r dark:border-gray-600",children:"Total Absents"}),y.map(r=>{var n;return e.jsx("td",{className:"px-1 py-1 text-center font-bold text-[11px] border-l border-gray-100 dark:border-gray-700 text-red-600",children:((n=f[r])==null?void 0:n.absent)||0},r)}),e.jsx("td",{colSpan:2,className:"bg-gray-50 dark:bg-gray-700"})]})]})]})}),e.jsx("div",{className:"mt-6 flex justify-end shrink-0",children:e.jsx(K,{variant:"outline",onClick:D,className:"px-6 py-2.5",children:"Close"})})]}):null}function ye({isOpen:d,onClose:D,onCreated:c,onUpdated:b,batch:u}){const[g,N]=o.useState({batchName:"",instructorName:"",mode:"online",subject:"",startDate:"",expectedEndDate:"",batchTime:{from:"",to:""},instructor:""}),[j,B]=o.useState(!1),[I,T]=o.useState([]),[M,h]=o.useState(""),w=!!u;o.useEffect(()=>{var y,i;d&&((async()=>{try{const a=await $.get(`${E}/users/dropdown?roles=Instructor`,{withCredentials:!0}),s=["Instructor"],L=a.data.users.filter(r=>r.roles&&r.roles.some(n=>s.includes(n))).map(r=>({value:r._id,label:r.fullName}));T(L)}catch(a){console.error("Failed to fetch instructors:",a),p.error("Failed to load instructors")}})(),u?N({batchName:u.batchName||"",instructorName:u.instructorName||"",mode:u.mode||"online",subject:u.subject||"",startDate:u.startDate?new Date(u.startDate).toISOString().split("T")[0]:"",expectedEndDate:u.expectedEndDate?new Date(u.expectedEndDate).toISOString().split("T")[0]:"",batchTime:{from:((y=u.batchTime)==null?void 0:y.from)||"",to:((i=u.batchTime)==null?void 0:i.to)||""},instructor:u.instructor||""}):(N({batchName:"",instructorName:"",mode:"online",subject:"",startDate:"",expectedEndDate:"",batchTime:{from:"",to:""},instructor:""}),h("")))},[d,u]),o.useEffect(()=>{if(w&&g.instructorName&&I.length>0){const y=I.find(i=>i.label===g.instructorName);y&&h(y.value)}},[w,g.instructorName,I]);const A=y=>{const{name:i,value:S}=y.target;if(i.includes("batchTime.")){const a=i.split(".")[1];N(s=>({...s,batchTime:{...s.batchTime,[a]:S}}))}else N(a=>({...a,[i]:S}))},W=y=>{h(y);const i=I.find(S=>S.value===y);i&&N(S=>({...S,instructorName:i.label,instructor:y}))},z=y=>{N(i=>({...i,mode:y}))},F=async y=>{var i,S;y.preventDefault(),B(!0);try{if(w){const a=await $.put(`${E}/batches/${u._id}`,g,{withCredentials:!0});p.success("Batch updated successfully!"),b&&b(a.data.batch)}else{const a=await $.post(`${E}/batches`,g,{withCredentials:!0});p.success("Batch created successfully!"),c&&c(a.data.batch)}D()}catch(a){console.error("Error saving batch:",a),p.error(((S=(i=a.response)==null?void 0:i.data)==null?void 0:S.message)||`Failed to ${w?"update":"create"} batch.`)}finally{B(!1)}},R=[{value:"online",label:"Online"},{value:"offline",label:"Offline"}];return e.jsxs(ge,{isOpen:d,onClose:D,className:"max-w-2xl p-6 lg:p-10",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-6",children:w?"Edit Batch Details":"Create New Batch"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(J,{htmlFor:"batchName",children:"Batch Name"}),e.jsx(X,{type:"text",id:"batchName",name:"batchName",required:!0,value:g.batchName,onChange:A,placeholder:"e.g. Batchname Jan 2026"})]}),e.jsxs("div",{children:[e.jsx(J,{htmlFor:"instructorName",children:"Instructor Assigned"}),e.jsx(be,{options:I,value:M,onChange:W,placeholder:"Select Instructor",disabled:I.length===0})]}),e.jsxs("div",{children:[e.jsx(J,{children:"Mode"}),e.jsx(be,{options:R,value:g.mode,onChange:z})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(J,{htmlFor:"subject",children:"Subject"}),e.jsx(X,{type:"text",id:"subject",name:"subject",required:!0,value:g.subject,onChange:A})]}),e.jsxs("div",{children:[e.jsx(J,{htmlFor:"startDate",children:"Start Date"}),e.jsx(X,{type:"date",id:"startDate",name:"startDate",required:!0,value:g.startDate,onChange:A})]}),e.jsxs("div",{children:[e.jsx(J,{htmlFor:"expectedEndDate",children:"Expected End Date"}),e.jsx(X,{type:"date",id:"expectedEndDate",name:"expectedEndDate",required:!0,value:g.expectedEndDate,onChange:A})]}),e.jsxs("div",{children:[e.jsx(J,{htmlFor:"batchTime.from",children:"Time From"}),e.jsx(X,{type:"time",id:"batchTime.from",name:"batchTime.from",required:!0,value:g.batchTime.from,onChange:A})]}),e.jsxs("div",{children:[e.jsx(J,{htmlFor:"batchTime.to",children:"Time To"}),e.jsx(X,{type:"time",id:"batchTime.to",name:"batchTime.to",required:!0,value:g.batchTime.to,onChange:A})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col-reverse sm:flex-row sm:justify-end gap-3",children:[e.jsx(K,{type:"button",variant:"outline",onClick:D,className:"w-full sm:w-auto mt-2 sm:mt-0",children:"Cancel"}),e.jsx(K,{type:"submit",variant:"primary",loading:j,className:"w-full sm:w-auto",children:w?"Update Batch":"Create Batch"})]})]})]})}function Re({batch:d,onUpdate:D,onDelete:c}){var y;const{user:b}=ue(),[u,g]=o.useState(!1),[N,j]=o.useState(!1),[B,I]=o.useState(!1),[T,M]=o.useState(!1),h=b&&d&&b.fullName===d.instructorName||me(b,"Instructor"),w=re(b)||ae(b)||se(b)||h,A=re(b)||ae(b)||se(b),W=()=>g(!u),z=async i=>{if(i.stopPropagation(),window.confirm("Are you sure you want to delete this batch and all its students?"))try{await $.delete(`${E}/batches/${d._id}`,{withCredentials:!0}),p.success("Batch deleted successfully."),c(d._id)}catch{p.error("Failed to delete batch.")}},F=i=>{i.stopPropagation(),j(!0)},R=i=>{D(i),j(!1)};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-800 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",onClick:W,children:[e.jsxs("div",{className:"flex items-start sm:items-center space-x-4 w-full sm:w-auto",children:[e.jsx("div",{className:`transform transition-transform mt-1 sm:mt-0 ${u?"rotate-90":""}`,children:e.jsx("svg",{className:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:d.batchName}),e.jsxs("div",{className:"flex flex-wrap gap-y-2 gap-x-6 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500 mr-2",children:"Subject:"}),e.jsx("span",{children:d.subject})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500 mr-2",children:"Duration:"}),e.jsxs("span",{children:[new Date(d.startDate).toLocaleDateString()," - ",new Date(d.expectedEndDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500 mr-2",children:"Timing:"}),e.jsxs("span",{children:[d.batchTime.from," - ",d.batchTime.to]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500 mr-2",children:"Mode:"}),e.jsx("span",{className:`uppercase font-bold text-xs px-2 py-0.5 rounded ${d.mode==="online"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:d.mode})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500 mr-2",children:"Instructor:"}),e.jsx("span",{children:d.instructorName})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4 sm:mt-0 w-full sm:w-auto",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),I(!0)},className:"px-3 py-1 text-xs font-medium bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 dark:bg-indigo-900/30 dark:text-indigo-400 dark:hover:bg-indigo-900/50 transition-colors",children:w?"Mark Attendance":"View Attendance"}),e.jsx("button",{onClick:i=>{i.stopPropagation(),M(!0)},className:"px-3 py-1 text-xs font-medium bg-green-50 text-green-600 rounded-full hover:bg-green-100 dark:bg-green-900/30 dark:text-green-400 dark:hover:bg-green-900/50 transition-colors",children:"Monthly Report"}),e.jsxs("button",{onClick:i=>{i.stopPropagation();const S=`${window.location.origin}/public/attendance/${d.shareToken}`;navigator.clipboard.writeText(S).then(()=>{p.info("Shareable link copied to clipboard!")}).catch(a=>{p.error("Failed to copy link.")})},className:"px-3 py-1 text-xs font-medium bg-blue-50 text-blue-600 rounded-full hover:bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400 dark:hover:bg-blue-900/50 transition-colors flex items-center gap-1",title:"Copy Shareable Link for Students",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share Link"]}),A&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F,className:"p-2 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400",title:"Edit Batch",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:z,className:"p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400",title:"Delete Batch",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),u&&e.jsx("div",{className:"p-6 border-t border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"mt-6",children:[e.jsxs("h5",{className:"text-md font-semibold text-gray-800 dark:text-white mb-4 flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-gray-400"}),"Enrolled Students"]}),e.jsx(He,{batchId:d._id,batchSubject:d.subject,batchStartDate:d.startDate,batchEndDate:d.expectedEndDate,brandName:(y=d.brand)==null?void 0:y.name})]})}),e.jsx(We,{isOpen:B,onClose:()=>I(!1),batch:d}),e.jsx(ze,{isOpen:T,onClose:()=>M(!1),batch:d}),N&&e.jsx(ye,{isOpen:N,onClose:()=>j(!1),onUpdated:R,batch:d})]})}function Je(){const{user:d}=o.useContext(Ee),[D,c]=o.useState([]),[b,u]=o.useState(!0),[g,N]=o.useState(!1),j=re(d)||ae(d)||se(d);o.useEffect(()=>{B()},[]);const B=async()=>{try{u(!0);const h=await $.get(`${E}/batches`,{withCredentials:!0});c(h.data.batches)}catch(h){console.error("Error fetching batches:",h),p.error("Failed to load batches.")}finally{u(!1)}},I=h=>{c([h,...D]),N(!1)},T=h=>{c(D.map(w=>w._id===h._id?h:w))},M=h=>{c(D.filter(w=>w._id!==h))};return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx(Pe,{title:"Batch Management | DreamCRM",description:"Manage students in structured batches"}),e.jsx($e,{pageTitle:"Batch Management"}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Structured Batches"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage batches with improved student search and addition."})]}),j&&e.jsx(K,{variant:"primary",onClick:()=>N(!0),className:"w-full sm:w-auto",children:"Create New Batch"})]}),b?e.jsx(xe,{}):D.length>0?e.jsx("div",{className:"space-y-4",children:D.map(h=>e.jsx(Re,{batch:h,onUpdate:T,onDelete:M},h._id))}):e.jsx(Be,{children:e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No batches found for this brand."}),j&&e.jsx(K,{variant:"outline",onClick:()=>N(!0),children:"Start by creating your first batch"})]})}),g&&e.jsx(ye,{isOpen:g,onClose:()=>N(!1),onCreated:I}),e.jsx(Te,{position:"top-center",autoClose:3e3,className:"!z-[999999]",style:{zIndex:999999}})]})}export{Je as default};
