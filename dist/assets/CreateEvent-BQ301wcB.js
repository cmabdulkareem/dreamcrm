import{r as d,A as ie,a as ne,f as F,j as e,P as H,E as de,n as oe,C as $,x as c,I as g,J as ce,B as h,K as S,S as xe,F as O,H as W,y as x,b as E,c as Z,N as me,Q as pe,R as he}from"./index-BNEGGE57.js";import{D as ge}from"./date-picker-BeppTpDh.js";import{S as ue}from"./file-BKwY2KsR.js";import{S as ve,a as be}from"./calendar-BOTJCVoQ.js";import"./index-B_JH6AFf.js";import"./calender-line-DQbsZUHO.js";const Q=u=>d.createElement("svg",{className:"size-5",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 22 22",fill:"none",...u},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.70186 11.0001C2.70186 6.41711 6.41711 2.70186 11.0001 2.70186C15.5831 2.70186 19.2984 6.41711 19.2984 11.0001C19.2984 15.5831 15.5831 19.2984 11.0001 19.2984C6.41711 19.2984 2.70186 15.5831 2.70186 11.0001ZM11.0001 0.901855C5.423 0.901855 0.901855 5.423 0.901855 11.0001C0.901855 16.5772 5.423 21.0984 11.0001 21.0984C16.5772 21.0984 21.0984 16.5772 21.0984 11.0001C21.0984 5.423 16.5772 0.901855 11.0001 0.901855ZM14.6197 9.73951C14.9712 9.38804 14.9712 8.81819 14.6197 8.46672C14.2683 8.11525 13.6984 8.11525 13.347 8.46672L10.1894 11.6243L8.6533 10.0883C8.30183 9.7368 7.73198 9.7368 7.38051 10.0883C7.02904 10.4397 7.02904 11.0096 7.38051 11.3611L9.55295 13.5335C9.72174 13.7023 9.95065 13.7971 10.1894 13.7971C10.428 13.7971 10.657 13.7023 10.8257 13.5335L14.6197 9.73951Z",fill:"#12B76A"}));E.defaults.withCredentials=!0;const fe=()=>Math.floor(1e3+Math.random()*9e3).toString(),Re=()=>{var P;const{user:u}=d.useContext(ie),[l,v]=d.useState({eventName:"",eventDescription:"",eventDate:"",maxRegistrations:0,eventPin:fe(),registrationFields:[{fieldName:"Full Name",fieldType:"text",isRequired:!0},{fieldName:"Email",fieldType:"email",isRequired:!0}]}),[i,b]=d.useState({fieldName:"",fieldType:"text",isRequired:!1,options:[]}),[m,z]=d.useState(null),[X,w]=d.useState(),[T,C]=d.useState(),[j,k]=d.useState(null),[R,B]=d.useState(null),f=d.useRef(null),y=d.useRef(null),q=ne(),D=a=>{const{name:t,value:s}=a.target;v(r=>({...r,[t]:s}))},N=(a,t,s)=>{const r=[...l.registrationFields];r[a][t]=s,v(n=>({...n,registrationFields:r}))},_=()=>{if(i.fieldName.trim()===""){x.error("Field name is required");return}v(a=>({...a,registrationFields:[...a.registrationFields,{...i}]})),b({fieldName:"",fieldType:"text",isRequired:!1,options:[]})},J=a=>{const t=[...l.registrationFields];t.splice(a,1),v(s=>({...s,registrationFields:t}))},L=async(a,t)=>{var s,r;try{if(!F(u))throw new Error("Access denied. Manager privileges required.");const n=new File([t],"banner.jpg",{type:"image/jpeg"}),o=new FormData;return o.append("banner",n),(await E.post(`${Z}/events/upload-banner/${a}`,o,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}})).data.bannerImage}catch(n){console.error("Error uploading banner:",n);const o=((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.message)||n.message||"Failed to upload banner";throw x.error(o),n}},K=async a=>{var t,s;if(a.preventDefault(),!F(u)){x.error("Access denied. Manager privileges required.");return}if(i.fieldName&&i.fieldName.trim()!==""){x.warning("You have an unsaved field. Please click 'Add Field' or clear the input.");return}if(!l.eventName||!l.eventDate){x.error("Event name and date are required");return}try{const r={...l,eventDate:new Date(l.eventDate).toISOString()},n=await E.post(`${Z}/events/create`,r,{withCredentials:!0});if(R||m)try{if(R)await L(n.data.event._id,R);else if(m!=null&&m.startsWith("data:")){const p=await(await fetch(m)).blob();await L(n.data.event._id,p)}}catch(o){console.error("Error uploading banner:",o),x.error("Event created but banner upload failed")}x.success("Event created successfully"),q("/events")}catch(r){console.error("Error creating event:",r),x.error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to create event")}},G=a=>{const{naturalWidth:t,naturalHeight:s}=a.currentTarget,r=me(pe({unit:"%",width:90},16/9,t,s),t,s);w(r),C(r)},V=async(a,t)=>{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r||!t)throw new Error("No context or crop");const n=a.naturalWidth/a.width,o=a.naturalHeight/a.height,p=window.devicePixelRatio;s.width=Math.floor(t.width*n*p),s.height=Math.floor(t.height*o*p),r.scale(p,p),r.imageSmoothingQuality="high";const te=t.x*n,se=t.y*o,A=t.width*n,U=t.height*o;return r.drawImage(a,te,se,A,U,0,0,A,U),new Promise((re,le)=>{s.toBlob(Y=>{if(!Y){le(new Error("Canvas is empty"));return}re(Y)},"image/jpeg",.95)})},ee=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){x.error("Please select an image file");return}const s=new FileReader;s.onload=r=>{z(r.target.result),k(null),w(void 0),C(void 0)},s.readAsDataURL(t)},ae=async()=>{if(!(!T||!f.current))try{const a=he(T,f.current.naturalWidth,f.current.naturalHeight),t=await V(f.current,a);B(t),k(URL.createObjectURL(t))}catch(a){console.error("Error cropping image:",a),x.error("Failed to crop image. Please try again.")}},I=()=>{var a;(a=y.current)==null||a.click()},M=()=>{z(null),k(null),B(null),y.current&&(y.current.value="")};return F(u)?e.jsxs("div",{className:"max-w-(--breakpoint-2xl) mx-auto pb-20",children:[e.jsx(H,{title:"Create Event - CRM"}),e.jsx(de,{pageTitle:"Create Your Event Here"}),e.jsx(oe,{position:"top-right",className:"!z-[999999]"}),e.jsxs("form",{onSubmit:K,className:"mt-6 flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"w-full lg:w-3/5 space-y-8",children:[e.jsx($,{title:"1. Basic Information",desc:"Enter the core details of your event.",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"eventName",children:["Event Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{type:"text",id:"eventName",name:"eventName",placeholder:"e.g. Annual Tech Summit 2024",value:l.eventName,onChange:D,required:!0})]}),e.jsx("div",{children:e.jsx(ge,{id:"eventDate",label:"Event Date *",value:l.eventDate,onChange:(a,t)=>v({...l,eventDate:t}),required:!0})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"eventDescription",children:"Event Description"}),e.jsx("textarea",{id:"eventDescription",name:"eventDescription",placeholder:"Tell people what this event is about...",value:l.eventDescription,onChange:D,rows:"5",className:"w-full px-4 py-3 border border-gray-200 dark:border-gray-800 rounded-xl focus:outline-hidden focus:ring-4 focus:ring-brand-500/10 dark:bg-gray-900 dark:text-white transition-all resize-none shadow-theme-xs"})]}),e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx(c,{htmlFor:"maxRegistrations",children:"Maximum Registrations"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{type:"number",id:"maxRegistrations",name:"maxRegistrations",value:l.maxRegistrations,onChange:D,min:"0",className:"!pr-20"}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-medium text-gray-400 pointer-events-none uppercase tracking-wider",children:"0 = âˆž"})]})]})]}),e.jsxs("div",{className:"lg:col-span-6",children:[e.jsx(c,{children:"Event Banner"}),e.jsx("input",{type:"file",ref:y,onChange:ee,accept:"image/*",className:"hidden"}),m?e.jsx("div",{className:"space-y-4",children:j?e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"aspect-video w-full overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-800 relative shadow-sm",children:[e.jsx("img",{src:j,alt:"Banner Preview",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx(h,{variant:"primary",size:"sm",onClick:I,startIcon:e.jsx(xe,{className:"size-3.5"}),className:"!h-8 !px-3 text-[10px]",children:"Change"}),e.jsx(h,{variant:"danger",size:"sm",onClick:M,startIcon:e.jsx(S,{className:"size-3.5"}),className:"!h-8 !px-3 text-[10px]",children:"Remove"})]})]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-gray-100 dark:bg-gray-900 p-4 overflow-auto",children:e.jsx("div",{style:{width:"fit-content",margin:"0 auto"},children:e.jsx(ce,{crop:X,onChange:a=>w(a),onComplete:a=>C(a),aspect:16/9,children:e.jsx("img",{ref:f,src:m,alt:"To be cropped",onLoad:G,style:{maxHeight:"500px",width:"auto",display:"block"}})})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:M,startIcon:e.jsx(S,{className:"size-3.5"}),className:"flex-1 text-xs",children:"Discard"}),e.jsx(h,{variant:"primary",size:"sm",onClick:ae,startIcon:e.jsx(Q,{className:"size-3.5"}),className:"flex-1 text-xs",children:"Confirm"})]})]})}):e.jsxs("div",{onClick:I,className:"border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-2xl h-[200px] flex flex-col items-center justify-center bg-gray-50/50 dark:bg-white/[0.02] cursor-pointer hover:border-brand-500 hover:bg-brand-50/10 transition-all group",children:[e.jsx("div",{className:"size-10 rounded-full bg-white dark:bg-gray-900 shadow-theme-xs flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx(O,{className:"size-5 text-brand-500"})}),e.jsx("p",{className:"text-gray-700 dark:text-white/90 font-semibold text-xs mb-1",children:"Upload banner"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"16:9 ratio"})]})]})]})]})}),e.jsx($,{title:"3. Form Builder",desc:"Customize the fields people need to fill out to register.",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-3",children:l.registrationFields.map((a,t)=>e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-4 p-4 bg-gray-50/50 dark:bg-white/[0.02] border border-gray-100 dark:border-gray-800 rounded-2xl transition-all hover:border-brand-200 dark:hover:border-brand-800 group",children:[e.jsx("div",{className:"flex-none flex items-center justify-center size-10 bg-white dark:bg-gray-900 rounded-xl shadow-theme-xs text-gray-400",children:e.jsx(ve,{className:"size-5"})}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-[10px] text-gray-500 uppercase tracking-widest mb-1.5 block",children:"Field Label"}),e.jsx(g,{type:"text",value:a.fieldName,onChange:s=>N(t,"fieldName",s.target.value),className:"!h-9 !py-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-[10px] text-gray-500 uppercase tracking-widest mb-1.5 block",children:"Type"}),e.jsx(W,{options:[{value:"text",label:"Short Text"},{value:"email",label:"Email Address"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"textarea",label:"Long Text"},{value:"select",label:"Dropdown Select"}],value:a.fieldType,onChange:s=>N(t,"fieldType",s),className:"!h-9 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(c,{className:"text-[10px] text-gray-500 uppercase tracking-widest mb-1.5 block",children:"Settings"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group/check",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:a.isRequired,onChange:s=>N(t,"isRequired",s.target.checked),className:"sr-only"}),e.jsx("div",{className:`w-10 h-5 rounded-full transition-colors ${a.isRequired?"bg-brand-500":"bg-gray-200 dark:bg-gray-800"}`}),e.jsx("div",{className:`absolute left-1 top-1 size-3 bg-white rounded-full transition-all ${a.isRequired?"translate-x-5":""}`})]}),e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Required"})]})]}),e.jsx("button",{type:"button",onClick:()=>J(t),className:"mt-5 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",title:"Remove Field",children:e.jsx(S,{className:"size-5"})})]})]}),a.fieldType==="select"&&e.jsxs("div",{className:"w-full mt-2 md:mt-0 pt-2 border-t border-gray-100 dark:border-gray-800",children:[e.jsx(c,{className:"text-[10px] text-gray-500 uppercase tracking-widest mb-1.5 block",children:"Options (Comma separated)"}),e.jsx(g,{type:"text",value:a.options?a.options.join(", "):"",onChange:s=>N(t,"options",s.target.value.split(",").map(r=>r.trim())),placeholder:"Option 1, Option 2, etc.",className:"!h-9 !py-1 text-sm font-normal"})]})]},t))}),e.jsxs("div",{className:"p-6 border-2 border-dashed border-gray-100 dark:border-gray-800 rounded-2xl bg-white dark:bg-gray-900/50 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"New Field Label"}),e.jsx(g,{type:"text",placeholder:"e.g. Phone Number",value:i.fieldName,onChange:a=>b({...i,fieldName:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Field Type"}),e.jsx(W,{options:[{value:"text",label:"Short Text"},{value:"email",label:"Email Address"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"textarea",label:"Long Text"},{value:"select",label:"Dropdown Select"}],value:i.fieldType,onChange:a=>b({...i,fieldType:a})})]})]}),i.fieldType==="select"&&e.jsxs("div",{children:[e.jsx(c,{children:"Select Options (Comma separated)"}),e.jsx(g,{type:"text",placeholder:"Choice 1, Choice 2, Choice 3",value:((P=i.options)==null?void 0:P.join(", "))||"",onChange:a=>b({...i,options:a.target.value.split(",").map(t=>t.trim())})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:i.isRequired,onChange:a=>b({...i,isRequired:a.target.checked}),className:"sr-only"}),e.jsx("div",{className:`w-12 h-6 rounded-full transition-colors ${i.isRequired?"bg-brand-500":"bg-gray-200 dark:bg-gray-800"}`}),e.jsx("div",{className:`absolute left-1 top-1 size-4 bg-white rounded-full transition-all ${i.isRequired?"translate-x-6":""}`})]}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-white/90",children:"Make this field required"})]}),e.jsx(h,{variant:"neutral",size:"sm",onClick:_,startIcon:e.jsx(O,{className:"size-4"}),children:"Add to Form"})]})]})]})})]}),e.jsx("div",{className:"w-full lg:w-2/5 flex justify-center",children:e.jsxs("div",{className:"sticky top-6 w-full max-w-[390px]",children:[e.jsxs("div",{className:"relative bg-black rounded-[50px] p-3 shadow-2xl border-[6px] border-gray-900 shadow-brand-500/10",children:[e.jsx("div",{className:"absolute -left-[10px] top-32 w-[4px] h-16 bg-gray-800 rounded-l-md"}),e.jsx("div",{className:"absolute -left-[10px] top-52 w-[4px] h-12 bg-gray-800 rounded-l-md"}),e.jsx("div",{className:"absolute -right-[10px] top-40 w-[4px] h-20 bg-gray-800 rounded-r-md"}),e.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 w-28 h-7 bg-black rounded-full z-50 flex items-center justify-end px-4 gap-1.5 shadow-lg shadow-black/20",children:[e.jsx("div",{className:"size-1.5 rounded-full bg-blue-500/20"}),e.jsx("div",{className:"size-2 rounded-full bg-green-500/40 blur-[1px]"})]}),e.jsx("div",{className:"absolute top-8 left-10 text-[10px] font-bold text-black z-40",children:"9:41"}),e.jsx("div",{className:"absolute top-8 right-10 flex gap-1 z-40",children:e.jsx("div",{className:"w-4 h-2 rounded-[2px] border border-black/20 relative",children:e.jsx("div",{className:"absolute right-0.5 top-0.5 bottom-0.5 left-0.5 bg-black rounded-[0.5px]"})})}),e.jsxs("div",{className:"bg-white rounded-[40px] overflow-hidden shadow-inner h-[760px] flex flex-col scrollbar-hide",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:[e.jsx("div",{className:"relative",children:j?e.jsx("img",{src:j,alt:"Preview Header",className:"w-full aspect-video object-cover"}):e.jsx("div",{className:"aspect-video bg-gray-100 flex items-center justify-center text-gray-300",children:e.jsx(ue,{className:"size-16"})})}),e.jsxs("div",{className:"px-6 pt-6 pb-2",children:[e.jsx("h2",{className:"text-gray-900 text-xl font-bold leading-tight",children:l.eventName||"Your Event Brand Here"}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-xs mt-2 font-medium",children:[e.jsx(be,{className:"size-4 text-brand-500"}),l.eventDate?new Date(l.eventDate).toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"}):"Select a date..."]})]}),e.jsxs("div",{className:"px-6 pb-6 pt-2 space-y-6",children:[l.eventDescription&&e.jsx("p",{className:"text-gray-500 text-sm leading-relaxed border-b border-gray-100 pb-5 whitespace-pre-wrap italic",children:l.eventDescription}),e.jsxs("div",{className:"space-y-4",children:[l.registrationFields.length>0?l.registrationFields.map((a,t)=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-800 uppercase tracking-wider flex items-center gap-1",children:[a.fieldName||`Untitled Field ${t+1}`,a.isRequired&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.fieldType==="textarea"?e.jsx("div",{className:"w-full h-20 bg-gray-50/50 border border-gray-100 rounded-xl"}):a.fieldType==="select"?e.jsxs("div",{className:"w-full h-10 px-4 bg-gray-50/50 border border-gray-100 rounded-xl flex items-center justify-between text-gray-400 text-[11px]",children:["Select from options...",e.jsx(ChevronDownIcon,{className:"size-3.5"})]}):e.jsx("div",{className:"w-full h-10 px-4 bg-gray-50/50 border border-gray-100 rounded-xl flex items-center text-gray-400 text-[11px]",children:a.fieldType==="date"?"YYYY-MM-DD":a.fieldType==="number"?"0":`Enter ${a.fieldName.toLowerCase()}...`})]},t)):e.jsx("div",{className:"text-center py-10 border-2 border-dashed border-gray-50 rounded-3xl",children:e.jsx("p",{className:"text-gray-400 text-[11px]",children:"Add fields to see the form preview"})}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"w-full py-3.5 bg-brand-500 text-white rounded-2xl font-bold text-center text-sm shadow-lg shadow-brand-500/30",children:"Register Now"}),e.jsx("p",{className:"text-[9px] text-center text-gray-400 mt-4 px-4 leading-tight",children:"By clicking register you agree to our terms of service and privacy policy."})]})]})]})]}),e.jsx("div",{className:"h-8 flex items-end justify-center pb-2 bg-white",children:e.jsx("div",{className:"w-32 h-1.5 bg-gray-200 rounded-full"})})]})]}),e.jsxs("div",{className:"flex gap-4 mt-8 px-1",children:[e.jsx(h,{variant:"outline",className:"flex-1 !rounded-[20px] !py-4 text-xs font-bold",onClick:()=>q("/events"),children:"Cancel"}),e.jsx(h,{type:"submit",className:"flex-2 !rounded-[20px] !py-4 text-xs font-bold shadow-lg shadow-brand-500/20",startIcon:e.jsx(Q,{className:"size-4"}),children:"Create Event"})]})]})})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsx(H,{title:"Access Denied - CRM"}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-800 dark:text-red-400 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-600 dark:text-red-300",children:"You don't have permission to create events. Please contact your administrator."})]})]})};export{Re as default};
