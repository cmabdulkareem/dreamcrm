import{r as d,A as te,b as re,h as M,j as e,P as H,G as U,o as se,C as ne,z as m,I as b,N as le,K as V,y as i,c as z,d as W}from"./index-BRRNp47y.js";import{D as ie}from"./date-picker-DxGeXKuS.js";import"./calender-line-CMLkAvQj.js";z.defaults.withCredentials=!0;const he=()=>{const{isAdmin:de,user:k}=d.useContext(te),[o,x]=d.useState({eventName:"",eventDescription:"",eventDate:"",maxRegistrations:0,registrationFields:[{fieldName:"Full Name",fieldType:"text",isRequired:!0},{fieldName:"Email",fieldType:"email",isRequired:!0}]}),[n,g]=d.useState({fieldName:"",fieldType:"text",isRequired:!1,options:[]}),[p,R]=d.useState(null),[A,y]=d.useState({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),[Y,j]=d.useState(null),[S,N]=d.useState(null),[F,$]=d.useState(null),w=d.useRef(null),v=d.useRef(null),L=re(),D=a=>{const{name:t,value:r}=a.target;x(s=>({...s,[t]:r}))},C=(a,t,r)=>{const s=[...o.registrationFields];s[a][t]=r,x(l=>({...l,registrationFields:s}))},X=()=>{if(n.fieldName.trim()===""){i.error("Field name is required");return}x(a=>({...a,registrationFields:[...a.registrationFields,{...n}]})),g({fieldName:"",fieldType:"text",isRequired:!1})},_=a=>{const t=[...o.registrationFields];t.splice(a,1),x(r=>({...r,registrationFields:t}))},I=async(a,t)=>{var r,s;try{if(!M(k))throw new Error("Access denied. Manager privileges required.");const l=new File([t],"banner.jpg",{type:"image/jpeg"}),c=new FormData;return c.append("banner",l),(await z.post(`${W}/events/upload-banner/${a}`,c,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}})).data.bannerImage}catch(l){console.error("Error uploading banner:",l);const c=((s=(r=l.response)==null?void 0:r.data)==null?void 0:s.message)||l.message||"Failed to upload banner";throw i.error(c),l}},G=async a=>{var t,r;if(a.preventDefault(),!M(k)){i.error("Access denied. Manager privileges required.");return}if(n.fieldName&&n.fieldName.trim()!==""){i.warning("You have an unsaved field in the 'New Field' section. Please click 'Add Field' to include it, or clear the input.");return}try{const s={...o,eventDate:new Date(o.eventDate).toISOString()},l=await z.post(`${W}/events/create`,s,{withCredentials:!0});if(F||p)try{if(F)await I(l.data.event._id,F);else if(p!=null&&p.startsWith("data:")){const f=await(await fetch(p)).blob();await I(l.data.event._id,f)}}catch(c){console.error("Error uploading banner:",c),i.error("Event created but banner upload failed")}i.success("Event created successfully"),L("/events"),O()}catch(s){console.error("Error creating event:",s),i.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create event")}},O=()=>{x({eventName:"",eventDescription:"",eventDate:"",maxRegistrations:0,registrationFields:[{fieldName:"Full Name",fieldType:"text",isRequired:!0},{fieldName:"Email",fieldType:"email",isRequired:!0}]}),g({fieldName:"",fieldType:"text",isRequired:!1,options:[]}),R(null),N(null),y({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),j(null),v.current&&(v.current.value="")},K=d.useCallback(a=>{a&&(w.current=a)},[]),J=(a,t,r)=>{const s=document.createElement("canvas"),l=a.naturalWidth/a.width,c=a.naturalHeight/a.height;let f,B,u,h;t.unit==="%"||t.unit===void 0?(f=t.x/100*a.width,B=t.y/100*a.height,u=t.width/100*a.width,h=t.height/100*a.height):(f=t.x,B=t.y,u=t.width,h=t.height);const T=16/9;return u/h>T?u=h*T:h=u/T,s.width=u,s.height=h,s.getContext("2d").drawImage(a,f*l,B*c,u*l,h*c,0,0,u,h),new Promise((ee,ae)=>{s.toBlob(q=>{if(!q){ae(new Error("Canvas is empty"));return}q.name=r,ee(q)},"image/jpeg",.8)})},Q=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){i.error("Please select an image file");return}if(t.size>5*1024*1024){i.error("File size exceeds 5MB limit");return}const r=new FileReader;r.onload=s=>{R(s.target.result),N(null),y({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),j({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9})},r.readAsDataURL(t)},Z=async()=>{const a=Y||A;if(!a||!w.current){i.error("Please select an area to crop");return}if(!w.current.complete||w.current.naturalWidth===0){i.error("Image not fully loaded. Please try again.");return}try{const t=await J(w.current,a,"banner.jpg");$(t),N(URL.createObjectURL(t))}catch(t){console.error("Error cropping image:",t),i.error("Failed to crop image")}},E=()=>{var a;(a=v.current)==null||a.click()},P=()=>{R(null),N(null),y({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),j(null),v.current&&(v.current.value="")};return M(k)?e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"Create Event - CRM"}),e.jsx(U,{items:[{name:"Dashboard",path:"/"},{name:"Events",path:"/events"},{name:"Create Event"}]}),e.jsx(se,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}}),e.jsx(ne,{title:"Create New Event",children:e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(m,{htmlFor:"eventName",children:"Event Name *"}),e.jsx(b,{type:"text",id:"eventName",name:"eventName",value:o.eventName,onChange:D,required:!0})]}),e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(ie,{id:"eventDate",label:"Event Date *",value:o.eventDate,onChange:(a,t)=>x({...o,eventDate:t})})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(m,{htmlFor:"eventDescription",children:"Event Description"}),e.jsx("textarea",{id:"eventDescription",name:"eventDescription",value:o.eventDescription,onChange:D,rows:"3",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-hidden focus:ring-3 focus:ring-brand-500/20 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 focus:border-brand-300 dark:border-gray-700 dark:focus:border-brand-800 rounded-lg shadow-theme-xs"})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(m,{children:"Banner Image (Optional)"}),e.jsx("input",{type:"file",ref:v,onChange:Q,accept:"image/*",className:"hidden"}),p?e.jsx("div",{className:"mt-2",children:S?e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full pt-[56.25%] overflow-hidden rounded-lg border border-gray-300 dark:border-gray-600 relative",children:e.jsx("img",{src:S,alt:"Cropped Banner Preview",className:"absolute top-0 left-0 w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:E,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700 dark:text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),e.jsx("button",{type:"button",onClick:P,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(m,{children:"Cropped Banner Preview"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"This is how your banner will appear on the event registration form."})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full overflow-hidden rounded-lg border border-gray-300 dark:border-gray-600",children:e.jsx(le,{crop:A,onChange:a=>y(a),onComplete:a=>j(a),aspect:16/9,minWidth:100,minHeight:100*(9/16),ruleOfThirds:!0,crossorigin:"anonymous",children:e.jsx("img",{ref:K,src:p,alt:"Banner Preview",className:"w-full h-auto max-h-96 object-contain"})})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:E,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700 dark:text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),e.jsx("button",{type:"button",onClick:P,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx("button",{type:"button",onClick:Z,className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Crop Banner"})})]})}):e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{onClick:E,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg h-48 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:border-brand-500 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:"Click to upload banner"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"16:9 aspect ratio recommended"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Optional: Upload a banner image for this event"})]})]})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(m,{htmlFor:"maxRegistrations",children:"Max Registrations (0 for unlimited)"}),e.jsx(b,{type:"number",id:"maxRegistrations",name:"maxRegistrations",value:o.maxRegistrations,onChange:D,min:"0"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{children:"Registration Fields"}),o.registrationFields.map((a,t)=>e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"w-full md:w-2/5",children:[e.jsx(m,{children:"Field Name"}),e.jsx(b,{type:"text",value:a.fieldName,onChange:r=>C(t,"fieldName",r.target.value),placeholder:"Field Name"})]}),e.jsxs("div",{className:"w-full md:w-2/5",children:[e.jsx(V,{options:[{value:"text",label:"Text"},{value:"email",label:"Email"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"textarea",label:"Textarea"},{value:"select",label:"Select"}],value:a.fieldType,onChange:r=>C(t,"fieldType",r)}),a.fieldType==="select"&&e.jsxs("div",{className:"mt-2",children:[e.jsx(m,{children:"Options (comma separated)"}),e.jsx(b,{type:"text",value:a.options?a.options.join(", "):"",onChange:r=>C(t,"options",r.target.value.split(",").map(s=>s.trim())),placeholder:"Option 1, Option 2, Option 3"})]})]}),e.jsx("div",{className:"w-full md:w-1/5 flex items-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.isRequired,onChange:r=>C(t,"isRequired",r.target.checked),className:"mr-2 h-5 w-5 text-brand-500 rounded focus:ring-brand-500"}),e.jsx(m,{className:"mb-0",children:"Required"})]})}),e.jsx("div",{className:"w-full md:w-auto flex items-end",children:e.jsx("button",{type:"button",onClick:()=>_(t),className:"text-red-500 hover:text-red-700 px-3 py-2",children:"Remove"})})]},t))]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"w-full md:w-2/5",children:e.jsx(b,{type:"text",name:"fieldName",value:n.fieldName,onChange:a=>g({...n,fieldName:a.target.value}),placeholder:"New Field Name"})}),e.jsxs("div",{className:"w-full md:w-2/5",children:[e.jsx(V,{options:[{value:"text",label:"Text"},{value:"email",label:"Email"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"textarea",label:"Textarea"},{value:"select",label:"Select"}],value:n.fieldType,onChange:a=>g({...n,fieldType:a})}),n.fieldType==="select"&&e.jsxs("div",{className:"mt-2",children:[e.jsx(m,{children:"Options (comma separated)"}),e.jsx(b,{type:"text",value:n.options?n.options.join(", "):"",onChange:a=>g({...n,options:a.target.value.split(",").map(t=>t.trim())}),placeholder:"Option 1, Option 2, Option 3"})]})]}),e.jsx("div",{className:"w-full md:w-1/5 flex items-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isRequired",checked:n.isRequired,onChange:a=>g({...n,isRequired:a.target.checked}),className:"mr-2 h-5 w-5 text-brand-500 rounded focus:ring-brand-500"}),e.jsx("span",{className:"text-sm",children:"Required"})]})}),e.jsx("div",{className:"w-full md:w-auto flex items-end",children:e.jsx("button",{type:"button",onClick:X,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm",children:"Add Field"})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{L("/events"),O()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Create Event"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"Create Event - CRM"}),e.jsx(U,{items:[{name:"Dashboard",path:"/"},{name:"Events",path:"/events"},{name:"Create Event"}]}),e.jsxs("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Access Denied"}),e.jsx("p",{children:"You don't have permission to create events."})]})]})};export{he as default};
