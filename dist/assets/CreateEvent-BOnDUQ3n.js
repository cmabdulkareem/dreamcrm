import{r as n,A as ae,c as te,j as e,E as P,N as U,t as re,D as se,H as c,I as N,V as le,U as V,y as i,d as A,e as W}from"./index-BTKtjo01.js";import{D as ne}from"./date-picker-DAovfHJc.js";import"./calender-line-BOFzFji2.js";A.defaults.withCredentials=!0;const me=()=>{const{isAdmin:C}=n.useContext(ae),[d,g]=n.useState({eventName:"",eventDescription:"",eventDate:"",maxRegistrations:0,registrationFields:[{fieldName:"Full Name",fieldType:"text",isRequired:!0},{fieldName:"Email",fieldType:"email",isRequired:!0}]}),[m,f]=n.useState({fieldName:"",fieldType:"text",isRequired:!1}),[x,k]=n.useState(null),[z,w]=n.useState({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),[O,y]=n.useState(null),[S,j]=n.useState(null),[R,Y]=n.useState(null),b=n.useRef(null),p=n.useRef(null),L=te(),F=a=>{const{name:t,value:r}=a.target;g(s=>({...s,[t]:r}))},D=(a,t,r)=>{const s=[...d.registrationFields];s[a][t]=r,g(l=>({...l,registrationFields:s}))},$=()=>{if(m.fieldName.trim()===""){i.error("Field name is required");return}g(a=>({...a,registrationFields:[...a.registrationFields,{...m}]})),f({fieldName:"",fieldType:"text",isRequired:!1})},X=a=>{const t=[...d.registrationFields];t.splice(a,1),g(r=>({...r,registrationFields:t}))},M=async(a,t)=>{var r,s;try{if(!C)throw new Error("Access denied. Admin privileges required.");const l=new File([t],"banner.jpg",{type:"image/jpeg"}),o=new FormData;return o.append("banner",l),(await A.post(`${W}/events/upload-banner/${a}`,o,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}})).data.bannerImage}catch(l){console.error("Error uploading banner:",l);const o=((s=(r=l.response)==null?void 0:r.data)==null?void 0:s.message)||l.message||"Failed to upload banner";throw i.error(o),l}},_=async a=>{var t,r;if(a.preventDefault(),!C){i.error("Access denied. Admin privileges required.");return}try{const s={...d,eventDate:new Date(d.eventDate).toISOString()},l=await A.post(`${W}/events/create`,s,{withCredentials:!0});if(R||x)try{if(R)await M(l.data.event._id,R);else if(x!=null&&x.startsWith("data:")){const v=await(await fetch(x)).blob();await M(l.data.event._id,v)}}catch(o){console.error("Error uploading banner:",o),i.error("Event created but banner upload failed")}i.success("Event created successfully"),L("/events"),H()}catch(s){console.error("Error creating event:",s),i.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create event")}},H=()=>{g({eventName:"",eventDescription:"",eventDate:"",maxRegistrations:0,registrationFields:[{fieldName:"Full Name",fieldType:"text",isRequired:!0},{fieldName:"Email",fieldType:"email",isRequired:!0}]}),f({fieldName:"",fieldType:"text",isRequired:!1}),k(null),j(null),w({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),y(null),p.current&&(p.current.value="")},G=n.useCallback(a=>{a&&(b.current=a)},[]),J=(a,t,r)=>{const s=document.createElement("canvas"),l=a.naturalWidth/a.width,o=a.naturalHeight/a.height;let v,B,u,h;t.unit==="%"||t.unit===void 0?(v=t.x/100*a.width,B=t.y/100*a.height,u=t.width/100*a.width,h=t.height/100*a.height):(v=t.x,B=t.y,u=t.width,h=t.height);const T=16/9;return u/h>T?u=h*T:h=u/T,s.width=u,s.height=h,s.getContext("2d").drawImage(a,v*l,B*o,u*l,h*o,0,0,u,h),new Promise((Z,ee)=>{s.toBlob(q=>{if(!q){ee(new Error("Canvas is empty"));return}q.name=r,Z(q)},"image/jpeg",.8)})},K=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){i.error("Please select an image file");return}if(t.size>5*1024*1024){i.error("File size exceeds 5MB limit");return}const r=new FileReader;r.onload=s=>{k(s.target.result),j(null),w({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),y({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9})},r.readAsDataURL(t)},Q=async()=>{const a=O||z;if(!a||!b.current){i.error("Please select an area to crop");return}if(!b.current.complete||b.current.naturalWidth===0){i.error("Image not fully loaded. Please try again.");return}try{const t=await J(b.current,a,"banner.jpg");Y(t),j(URL.createObjectURL(t))}catch(t){console.error("Error cropping image:",t),i.error("Failed to crop image")}},E=()=>{var a;(a=p.current)==null||a.click()},I=()=>{k(null),j(null),w({unit:"%",x:0,y:0,width:100,height:56.25,aspect:16/9}),y(null),p.current&&(p.current.value="")};return C?e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Create Event - CRM"}),e.jsx(U,{items:[{name:"Dashboard",path:"/"},{name:"Events",path:"/events"},{name:"Create Event"}]}),e.jsx(re,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}}),e.jsx(se,{title:"Create New Event",children:e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(c,{htmlFor:"eventName",children:"Event Name *"}),e.jsx(N,{type:"text",id:"eventName",name:"eventName",value:d.eventName,onChange:F,required:!0})]}),e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(ne,{id:"eventDate",label:"Event Date *",value:d.eventDate,onChange:(a,t)=>g({...d,eventDate:t})})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(c,{htmlFor:"eventDescription",children:"Event Description"}),e.jsx("textarea",{id:"eventDescription",name:"eventDescription",value:d.eventDescription,onChange:F,rows:"3",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-hidden focus:ring-3 focus:ring-brand-500/20 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 focus:border-brand-300 dark:border-gray-700 dark:focus:border-brand-800 rounded-lg shadow-theme-xs"})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(c,{children:"Banner Image (Optional)"}),e.jsx("input",{type:"file",ref:p,onChange:K,accept:"image/*",className:"hidden"}),x?e.jsx("div",{className:"mt-2",children:S?e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full pt-[56.25%] overflow-hidden rounded-lg border border-gray-300 dark:border-gray-600 relative",children:e.jsx("img",{src:S,alt:"Cropped Banner Preview",className:"absolute top-0 left-0 w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:E,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700 dark:text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),e.jsx("button",{type:"button",onClick:I,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{children:"Cropped Banner Preview"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"This is how your banner will appear on the event registration form."})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full overflow-hidden rounded-lg border border-gray-300 dark:border-gray-600",children:e.jsx(le,{crop:z,onChange:a=>w(a),onComplete:a=>y(a),aspect:16/9,minWidth:100,minHeight:100*(9/16),ruleOfThirds:!0,crossorigin:"anonymous",children:e.jsx("img",{ref:G,src:x,alt:"Banner Preview",className:"w-full h-auto max-h-96 object-contain"})})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:E,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700 dark:text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),e.jsx("button",{type:"button",onClick:I,className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx("button",{type:"button",onClick:Q,className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Crop Banner"})})]})}):e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{onClick:E,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg h-48 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:border-brand-500 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-2",children:"Click to upload banner"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"16:9 aspect ratio recommended"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Optional: Upload a banner image for this event"})]})]})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(c,{htmlFor:"maxRegistrations",children:"Max Registrations (0 for unlimited)"}),e.jsx(N,{type:"number",id:"maxRegistrations",name:"maxRegistrations",value:d.maxRegistrations,onChange:F,min:"0"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Registration Fields"}),d.registrationFields.map((a,t)=>e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"w-full md:w-2/5",children:[e.jsx(c,{children:"Field Name"}),e.jsx(N,{type:"text",value:a.fieldName,onChange:r=>D(t,"fieldName",r.target.value),placeholder:"Field Name"})]}),e.jsxs("div",{className:"w-full md:w-2/5",children:[e.jsx(c,{children:"Field Type"}),e.jsx(V,{options:[{value:"text",label:"Text"},{value:"email",label:"Email"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"textarea",label:"Textarea"},{value:"select",label:"Select"}],value:a.fieldType,onChange:r=>D(t,"fieldType",r)})]}),e.jsx("div",{className:"w-full md:w-1/5 flex items-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.isRequired,onChange:r=>D(t,"isRequired",r.target.checked),className:"mr-2 h-5 w-5 text-brand-500 rounded focus:ring-brand-500"}),e.jsx(c,{className:"mb-0",children:"Required"})]})}),e.jsx("div",{className:"w-full md:w-auto flex items-end",children:e.jsx("button",{type:"button",onClick:()=>X(t),className:"text-red-500 hover:text-red-700 px-3 py-2",children:"Remove"})})]},t))]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"w-full md:w-2/5",children:e.jsx(N,{type:"text",name:"fieldName",value:m.fieldName,onChange:a=>f({...m,fieldName:a.target.value}),placeholder:"New Field Name"})}),e.jsx("div",{className:"w-full md:w-2/5",children:e.jsx(V,{options:[{value:"text",label:"Text"},{value:"email",label:"Email"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"textarea",label:"Textarea"},{value:"select",label:"Select"}],value:m.fieldType,onChange:a=>f({...m,fieldType:a})})}),e.jsx("div",{className:"w-full md:w-1/5 flex items-end",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isRequired",checked:m.isRequired,onChange:a=>f({...m,isRequired:a.target.checked}),className:"mr-2 h-5 w-5 text-brand-500 rounded focus:ring-brand-500"}),e.jsx("span",{className:"text-sm",children:"Required"})]})}),e.jsx("div",{className:"w-full md:w-auto flex items-end",children:e.jsx("button",{type:"button",onClick:$,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm",children:"Add Field"})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{L("/events"),H()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-500 text-white rounded-md hover:bg-brand-600",children:"Create Event"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Create Event - CRM"}),e.jsx(U,{items:[{name:"Dashboard",path:"/"},{name:"Events",path:"/events"},{name:"Create Event"}]}),e.jsxs("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Access Denied"}),e.jsx("p",{children:"You don't have admin privileges to create events."})]})]})};export{me as default};
