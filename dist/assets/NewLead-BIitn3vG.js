import{r as t,A as Ke,p as Qe,b as Xe,u as Ye,q as ke,c as N,d as P,E as ea,F as aa,j as e,P as ta,s as sa,C as Ee,v as r,I as i,G as De,H as Oe,w as p,J as na,K as ra,N as oa,Q as ia,U as la,V as ca,W as da,B as f,M as _e,x as ma,y as l}from"./index-CfT7qPI5.js";import{D as Fe}from"./date-picker-DRMw8yeX.js";import"./calender-line-B2NiFWTh.js";function xa(){const{user:c}=t.useContext(Ke),{addEvent:Ae}=Qe(),qe=Xe(),{addNotification:Me,areToastsEnabled:Le}=Ye(),[C,S]=t.useState(""),[w,k]=t.useState(""),[y,U]=t.useState(""),[B,G]=t.useState(""),[$,z]=t.useState(""),[V,T]=t.useState(""),[d,W]=t.useState(""),[x,Z]=t.useState(""),[H,J]=t.useState(""),[m,K]=t.useState(""),[g,Q]=t.useState(""),[E,X]=t.useState(["General"]),[h,D]=t.useState(""),[v,Y]=t.useState(""),[O,_]=t.useState(""),[F,ee]=t.useState(""),[j,ae]=t.useState(""),[te,se]=t.useState(""),[ne,re]=t.useState(!1),[Re,oe]=t.useState([]),[Ie,ie]=t.useState([]),[n,le]=t.useState({}),{isOpen:Ue,openModal:Be,closeModal:A}=ke(),[q,ce]=t.useState(""),[de,me]=t.useState(""),[M,he]=t.useState(""),[L,ue]=t.useState(""),[pe,xe]=t.useState(!0),{isOpen:Ge,openModal:$e,closeModal:R}=ke(),[I,ge]=t.useState(""),[fe,Ce]=t.useState(""),[we,ve]=t.useState(!0);t.useEffect(()=>{const a=sessionStorage.getItem("prefillLeadData");if(a){const{fullName:s,email:o}=JSON.parse(a);S(s||""),k(o||""),sessionStorage.removeItem("prefillLeadData")}je(),Ne()},[]);const je=async()=>{try{const s=(await N.get(`${P}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(o=>({value:o.value,label:o.name}));s.push({value:"__add_new__",label:"+ Add New Campaign"}),oe(s)}catch(a){console.error("Error fetching campaigns:",a);const s=[...ea,{value:"__add_new__",label:"+ Add New Campaign"}];oe(s)}},Ne=async()=>{try{const s=(await N.get(`${P}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(o=>({value:o.value,label:o.name}));s.push({value:"other",label:"Other"}),s.push({value:"__add_new__",label:"+ Add New Contact Point"}),ie(s)}catch(a){console.error("Error fetching contact points:",a);const s=[...aa,{value:"__add_new__",label:"+ Add New Contact Point"}];ie(s)}},Pe=a=>{const s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a);return re(!s),s},ze=a=>{const s=a.target.value;k(s),Pe(s)},Ve=a=>{a==="__add_new__"?Be():_(a)},Te=a=>{a==="__add_new__"?$e():D(a)},We=async()=>{var a,s;if(!q.trim()){l.error("Campaign name is required");return}try{const o=await N.post(`${P}/campaigns/create`,{name:q,description:de,discountPercentage:M?parseFloat(M):0,cashback:L?parseFloat(L):0,isActive:pe},{withCredentials:!0});l.success("Campaign created successfully!"),_(o.data.campaign.value),await je(),A(),ce(""),me(""),he(""),ue(""),xe(!0)}catch(o){console.error("Error creating campaign:",o),l.error(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create campaign")}},Ze=async()=>{var a,s;if(!I.trim()){l.error("Contact point name is required");return}try{const o=await N.post(`${P}/contact-points/create`,{name:I,description:fe,isActive:we},{withCredentials:!0});l.success("Contact point created successfully!"),D(o.data.contactPoint.value),await Ne(),R(),ge(""),Ce(""),ve(!0)}catch(o){console.error("Error creating contact point:",o),l.error(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create contact point")}},He=()=>{const a={};return C.trim()||(a.fullName="Full Name is required"),w.trim()?Pe(w)||(a.email="Please enter a valid email address"):a.email="Email is required",y.trim()||(a.phone1="Phone is required"),d?d==="Other"&&!x.trim()&&(a.otherPlace="Please specify the place"):a.place="Place is required",m?m==="Other"&&!g.trim()&&(a.otherEducation="Please specify the education"):a.education="Education is required",E.length===0&&(a.coursePreference="Course preference is required"),h||(a.contactPoint="Contact point is required"),h==="other"&&!v.trim()&&(a.otherContactPoint="Please specify the contact point"),O||(a.campaign="Campaign is required"),j||(a.followUpDate="Next follow up date is required"),F.trim()||(a.leadRemarks="Remarks are required"),le(a),Object.keys(a).length===0},ye=()=>{S(""),k(""),U(""),G(""),z(""),T(""),W(""),Z(""),J(""),K(""),Q(""),X(["General"]),D(""),Y(""),_(""),ee(""),ae(""),se(""),re(!1),le({})},Je=async a=>{var o,be,Se;if(a.preventDefault(),!He()){l.error("Please fill in all required fields");return}const s={fullName:C,email:w,phone1:y,phone2:B,gender:$,dob:V,place:d==="Other"?x:d,otherPlace:d==="Other"?x:"",status:H,education:m==="Other"?g:m,otherEducation:m==="Other"?g:"",coursePreference:E,contactPoint:h,otherContactPoint:h==="other"?v:"",campaign:O,handledBy:(c==null?void 0:c.fullName)||"Unknown",leadRemarks:F,followUpDate:j,leadPotential:te};console.log("Sending formData with leadPotential:",s);try{const u=await N.post(`${P}/customers/create`,s,{withCredentials:!0});if(u.status===201){if(j)try{const b=j;Ae({title:`Follow-up: ${C}`,start:b,end:b,allDay:!0,extendedProps:{calendar:"Warning",leadId:u.data.customer._id,phone:y,email:w,status:u.data.customer.leadStatus||"new"}})}catch(b){console.error("Error creating calendar event:",b)}Me({type:"lead_created",userName:(c==null?void 0:c.fullName)||"Someone",avatar:(c==null?void 0:c.avatar)||null,action:"added new lead",entityName:C,module:"Lead Management"}),Le()&&l.success("Lead created successfully!",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),ye(),qe("/lead-management")}}catch(u){console.error("Error creating lead:",u),((o=u.response)==null?void 0:o.status)===401?l.error("Please login to create a lead."):l.error(((Se=(be=u.response)==null?void 0:be.data)==null?void 0:Se.message)||"Failed to create lead. Please try again.")}};return e.jsxs("div",{children:[e.jsx(ta,{title:"New Lead | DreamCRM",description:"Add new enquiry here"}),e.jsx(sa,{pageTitle:"New Enquiry"}),e.jsxs("form",{onSubmit:Je,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(Ee,{title:"Basic Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(r,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(i,{type:"text",id:"firstName",value:C,onChange:a=>S(a.target.value),error:!!n.fullName,hint:n.fullName})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(r,{children:"Email *"}),e.jsx(i,{type:"email",value:w,error:ne||!!n.email,onChange:ze,placeholder:"Enter your email",hint:n.email||(ne?"This is an invalid email address.":"")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(r,{children:"Phone *"}),e.jsx(De,{selectPosition:"end",countries:Oe,placeholder:"+91 98765 43210",value:y,onChange:U,error:!!n.phone1,hint:n.phone1})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(r,{children:"Phone (optional)"}),e.jsx(De,{selectPosition:"end",countries:Oe,placeholder:"+91 98765 43210",value:B,onChange:G})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(r,{children:"Gender"}),e.jsx(p,{options:na,value:$,placeholder:"Select Gender",onChange:z})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Fe,{id:"dob",label:"DoB",value:V,onChange:(a,s)=>T(s)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(r,{children:"Place *"}),e.jsx(p,{options:ra,value:d,placeholder:"Select Place",onChange:W,error:!!n.place,hint:n.place})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(r,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(i,{type:"text",id:"otherPlace",value:x,onChange:a=>Z(a.target.value),disabled:d!=="Other",error:d==="Other"&&!x.trim()&&!!n.otherPlace,hint:d==="Other"&&!x.trim()?n.otherPlace:""})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(r,{children:"Current Status"}),e.jsx(p,{options:oa,value:H,placeholder:"Select Status",onChange:J})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(r,{children:"Education"}),e.jsx(p,{options:ia,value:m,placeholder:"Select Education",onChange:K,error:!!n.education,hint:n.education})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(r,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(i,{type:"text",id:"otherEducation",value:g,onChange:a=>Q(a.target.value),disabled:m!=="Other",error:m==="Other"&&!g.trim()&&!!n.otherEducation,hint:m==="Other"&&!g.trim()?n.otherEducation:""})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(Ee,{title:"Enquiry / Lead Information",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(la,{label:"Course Preference",options:ca,selectedValues:E,onChange:X,error:!!n.coursePreference,hint:n.coursePreference})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(r,{children:"Contact Point *"}),e.jsx(p,{options:Ie,value:h,placeholder:"Contact Point",onChange:Te,error:!!n.contactPoint,hint:n.contactPoint})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(r,{htmlFor:"otherContactPoint",children:"Specify other"}),e.jsx(i,{type:"text",id:"otherContactPoint",value:v,onChange:a=>Y(a.target.value),disabled:h!=="other",error:h==="other"&&!v.trim()&&!!n.otherContactPoint,hint:h==="other"&&!v.trim()?n.otherContactPoint:""})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(r,{children:"Campaign *"}),e.jsx(p,{options:Re,value:O,placeholder:"Campaigns",onChange:Ve,error:!!n.campaign,hint:n.campaign})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsx(Fe,{id:"followupDate",label:"Next Follow Up Date",value:j,disablePastDates:!0,onChange:(a,s)=>ae(s),error:!!n.followUpDate,hint:n.followUpDate})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(r,{htmlFor:"leadRemarks",children:"Remarks *"}),e.jsx(i,{type:"text",id:"leadRemarks",value:F,onChange:a=>ee(a.target.value),error:!!n.leadRemarks,hint:n.leadRemarks})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx(r,{children:"Lead Potential"}),e.jsx(p,{options:da,value:te,placeholder:"Select Lead Potential",onChange:se})]})})]})})})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-6",children:[e.jsx(f,{type:"button",onClick:ye,variant:"outline",children:"Clear"}),e.jsx(f,{variant:"primary",type:"submit",children:"Save"})]})]}),e.jsxs(_e,{isOpen:Ue,onClose:A,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(i,{id:"newCampaignName",type:"text",value:q,onChange:a=>ce(a.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:de,onChange:a=>me(a.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(i,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:M,onChange:a=>he(a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{htmlFor:"newCampaignCashback",children:"Cashback (â‚¹)"}),e.jsx(i,{id:"newCampaignCashback",type:"number",min:"0",value:L,onChange:a=>ue(a.target.value),placeholder:"0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:pe,onChange:a=>xe(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(r,{htmlFor:"newCampaignActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active campaigns will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(f,{type:"button",variant:"outline",onClick:A,children:"Cancel"}),e.jsx(f,{type:"button",onClick:We,children:"Create Campaign"})]})]})]}),e.jsxs(_e,{isOpen:Ge,onClose:R,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Contact Point"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"newContactPointName",children:"Contact Point Name *"}),e.jsx(i,{id:"newContactPointName",type:"text",value:I,onChange:a=>ge(a.target.value),placeholder:"e.g., Walk In"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"newContactPointDesc",children:"Description"}),e.jsx("textarea",{id:"newContactPointDesc",value:fe,onChange:a=>Ce(a.target.value),placeholder:"Contact point description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newContactPointActive",checked:we,onChange:a=>ve(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(r,{htmlFor:"newContactPointActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active contact points will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(f,{type:"button",variant:"outline",onClick:R,children:"Cancel"}),e.jsx(f,{type:"button",onClick:Ze,children:"Create Contact Point"})]})]})]}),e.jsx(ma,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{xa as default};
