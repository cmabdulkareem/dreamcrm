import{r as s,A as Ye,p as ea,b as aa,u as ta,q as Ee,c as f,d as C,E as sa,F as na,j as e,P as ra,s as oa,C as Oe,v as o,I as i,G as De,H as _e,w as p,J as ia,K as la,N as ca,Q as da,U as ma,V as ha,B as w,M as Fe,x as ua,y as l}from"./index-DbEq1jlF.js";import{D as Ae}from"./date-picker-D-LGiiL9.js";import"./calender-line-eoPINGxh.js";function fa(){const{user:c}=s.useContext(Ye),{addEvent:qe}=ea(),Me=aa(),{addNotification:Le,areToastsEnabled:Re}=ta(),[v,S]=s.useState(""),[j,k]=s.useState(""),[y,G]=s.useState(""),[U,$]=s.useState(""),[B,z]=s.useState(""),[V,T]=s.useState(""),[d,Z]=s.useState(""),[x,H]=s.useState(""),[J,W]=s.useState(""),[m,K]=s.useState(""),[g,Q]=s.useState(""),[E,X]=s.useState(["General"]),[h,O]=s.useState(""),[N,Y]=s.useState(""),[D,_]=s.useState(""),[F,ee]=s.useState(""),[P,ae]=s.useState(""),[te,se]=s.useState(""),[ne,re]=s.useState(!1),[Ie,oe]=s.useState([]),[Ge,ie]=s.useState([]),[Ue,le]=s.useState([]),[n,ce]=s.useState({}),{isOpen:$e,openModal:Be,closeModal:A}=Ee(),[q,de]=s.useState(""),[me,he]=s.useState(""),[M,ue]=s.useState(""),[L,pe]=s.useState(""),[xe,ge]=s.useState(!0),{isOpen:ze,openModal:Ve,closeModal:R}=Ee(),[I,fe]=s.useState(""),[Ce,we]=s.useState(""),[ve,je]=s.useState(!0);s.useEffect(()=>{const a=sessionStorage.getItem("prefillLeadData");if(a){const{fullName:t,email:r}=JSON.parse(a);S(t||""),k(r||""),sessionStorage.removeItem("prefillLeadData")}Ne(),Pe(),Te()},[]);const Te=async()=>{try{const t=(await f.get(`${C}/course-categories/all`,{withCredentials:!0})).data.categories.filter(r=>r.isActive).map(r=>({value:r.name,label:r.name}));le(t)}catch(a){console.error("Error fetching course categories:",a),le([{value:"General",label:"General"}])}},Ne=async()=>{try{const t=(await f.get(`${C}/campaigns/active`,{withCredentials:!0})).data.campaigns.map(r=>({value:r.value,label:r.name}));t.push({value:"__add_new__",label:"+ Add New Campaign"}),oe(t)}catch(a){console.error("Error fetching campaigns:",a);const t=[...sa,{value:"__add_new__",label:"+ Add New Campaign"}];oe(t)}},Pe=async()=>{try{const t=(await f.get(`${C}/contact-points/active`,{withCredentials:!0})).data.contactPoints.map(r=>({value:r.value,label:r.name}));t.push({value:"other",label:"Other"}),t.push({value:"__add_new__",label:"+ Add New Contact Point"}),ie(t)}catch(a){console.error("Error fetching contact points:",a);const t=[...na,{value:"__add_new__",label:"+ Add New Contact Point"}];ie(t)}},ye=a=>{const t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a);return re(!t),t},Ze=a=>{const t=a.target.value;k(t),ye(t)},He=a=>{a==="__add_new__"?Be():_(a)},Je=a=>{a==="__add_new__"?Ve():O(a)},We=async()=>{var a,t;if(!q.trim()){l.error("Campaign name is required");return}try{const r=await f.post(`${C}/campaigns/create`,{name:q,description:me,discountPercentage:M?parseFloat(M):0,cashback:L?parseFloat(L):0,isActive:xe},{withCredentials:!0});l.success("Campaign created successfully!"),_(r.data.campaign.value),await Ne(),A(),de(""),he(""),ue(""),pe(""),ge(!0)}catch(r){console.error("Error creating campaign:",r),l.error(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create campaign")}},Ke=async()=>{var a,t;if(!I.trim()){l.error("Contact point name is required");return}try{const r=await f.post(`${C}/contact-points/create`,{name:I,description:Ce,isActive:ve},{withCredentials:!0});l.success("Contact point created successfully!"),O(r.data.contactPoint.value),await Pe(),R(),fe(""),we(""),je(!0)}catch(r){console.error("Error creating contact point:",r),l.error(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create contact point")}},Qe=()=>{const a={};return v.trim()||(a.fullName="Full Name is required"),j.trim()?ye(j)||(a.email="Please enter a valid email address"):a.email="Email is required",y.trim()||(a.phone1="Phone is required"),d?d==="Other"&&!x.trim()&&(a.otherPlace="Please specify the place"):a.place="Place is required",m?m==="Other"&&!g.trim()&&(a.otherEducation="Please specify the education"):a.education="Education is required",E.length===0&&(a.coursePreference="Course preference is required"),h||(a.contactPoint="Contact point is required"),h==="other"&&!N.trim()&&(a.otherContactPoint="Please specify the contact point"),D||(a.campaign="Campaign is required"),P||(a.followUpDate="Next follow up date is required"),F.trim()||(a.leadRemarks="Remarks are required"),ce(a),Object.keys(a).length===0},be=()=>{S(""),k(""),G(""),$(""),z(""),T(""),Z(""),H(""),W(""),K(""),Q(""),X(["General"]),O(""),Y(""),_(""),ee(""),ae(""),se(""),re(!1),ce({})},Xe=async a=>{var r,Se,ke;if(a.preventDefault(),!Qe()){l.error("Please fill in all required fields");return}const t={fullName:v,email:j,phone1:y,phone2:U,gender:B,dob:V,place:d==="Other"?x:d,otherPlace:d==="Other"?x:"",status:J,education:m==="Other"?g:m,otherEducation:m==="Other"?g:"",coursePreference:E,contactPoint:h,otherContactPoint:h==="other"?N:"",campaign:D,handledBy:(c==null?void 0:c.fullName)||"Unknown",leadRemarks:F,followUpDate:P,leadPotential:te};console.log("Sending formData with leadPotential:",t);try{const u=await f.post(`${C}/customers/create`,t,{withCredentials:!0});if(u.status===201){if(P)try{const b=P;qe({title:`Follow-up: ${v}`,start:b,end:b,allDay:!0,extendedProps:{calendar:"Warning",leadId:u.data.customer._id,phone:y,email:j,status:u.data.customer.leadStatus||"new"}})}catch(b){console.error("Error creating calendar event:",b)}Le({type:"lead_created",userName:(c==null?void 0:c.fullName)||"Someone",avatar:(c==null?void 0:c.avatar)||null,action:"added new lead",entityName:v,module:"Lead Management"}),Re()&&l.success("Lead created successfully!",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),be(),Me("/lead-management")}}catch(u){console.error("Error creating lead:",u),((r=u.response)==null?void 0:r.status)===401?l.error("Please login to create a lead."):l.error(((ke=(Se=u.response)==null?void 0:Se.data)==null?void 0:ke.message)||"Failed to create lead. Please try again.")}};return e.jsxs("div",{children:[e.jsx(ra,{title:"New Lead | DreamCRM",description:"Add new enquiry here"}),e.jsx(oa,{pageTitle:"New Enquiry"}),e.jsxs("form",{onSubmit:Xe,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(Oe,{title:"Basic Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(o,{htmlFor:"firstName",children:"Full Name *"}),e.jsx(i,{type:"text",id:"firstName",value:v,onChange:a=>S(a.target.value),error:!!n.fullName,hint:n.fullName})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(o,{children:"Email *"}),e.jsx(i,{type:"email",value:j,error:ne||!!n.email,onChange:Ze,placeholder:"Enter your email",hint:n.email||(ne?"This is an invalid email address.":"")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(o,{children:"Phone *"}),e.jsx(De,{selectPosition:"end",countries:_e,placeholder:"+91 98765 43210",value:y,onChange:G,error:!!n.phone1,hint:n.phone1})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(o,{children:"Phone (optional)"}),e.jsx(De,{selectPosition:"end",countries:_e,placeholder:"+91 98765 43210",value:U,onChange:$})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(o,{children:"Gender"}),e.jsx(p,{options:ia,value:B,placeholder:"Select Gender",onChange:z})]}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(Ae,{id:"dob",label:"DoB",value:V,onChange:(a,t)=>T(t)})}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(o,{children:"Place *"}),e.jsx(p,{options:la,value:d,placeholder:"Select Place",onChange:Z,error:!!n.place,hint:n.place})]}),e.jsxs("div",{className:"w-full md:w-1/4",children:[e.jsx(o,{htmlFor:"otherPlace",children:"Specify other"}),e.jsx(i,{type:"text",id:"otherPlace",value:x,onChange:a=>H(a.target.value),disabled:d!=="Other",error:d==="Other"&&!x.trim()&&!!n.otherPlace,hint:d==="Other"&&!x.trim()?n.otherPlace:""})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(o,{children:"Current Status"}),e.jsx(p,{options:ca,value:J,placeholder:"Select Status",onChange:W})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(o,{children:"Education"}),e.jsx(p,{options:da,value:m,placeholder:"Select Education",onChange:K,error:!!n.education,hint:n.education})]}),e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(o,{htmlFor:"otherEducation",children:"Specify other"}),e.jsx(i,{type:"text",id:"otherEducation",value:g,onChange:a=>Q(a.target.value),disabled:m!=="Other",error:m==="Other"&&!g.trim()&&!!n.otherEducation,hint:m==="Other"&&!g.trim()?n.otherEducation:""})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(Oe,{title:"Enquiry / Lead Information",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(ma,{label:"Course Preference",options:Ue,selectedValues:E,onChange:X,error:!!n.coursePreference,hint:n.coursePreference})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Contact Point *"}),e.jsx(p,{options:Ge,value:h,placeholder:"Contact Point",onChange:Je,error:!!n.contactPoint,hint:n.contactPoint})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(o,{htmlFor:"otherContactPoint",children:"Specify other"}),e.jsx(i,{type:"text",id:"otherContactPoint",value:N,onChange:a=>Y(a.target.value),disabled:h!=="other",error:h==="other"&&!N.trim()&&!!n.otherContactPoint,hint:h==="other"&&!N.trim()?n.otherContactPoint:""})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Campaign *"}),e.jsx(p,{options:Ie,value:D,placeholder:"Campaigns",onChange:He,error:!!n.campaign,hint:n.campaign})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsx(Ae,{id:"followupDate",label:"Next Follow Up Date",value:P,disablePastDates:!0,onChange:(a,t)=>ae(t),error:!!n.followUpDate,hint:n.followUpDate})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(o,{htmlFor:"leadRemarks",children:"Remarks *"}),e.jsx(i,{type:"text",id:"leadRemarks",value:F,onChange:a=>ee(a.target.value),error:!!n.leadRemarks,hint:n.leadRemarks})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Lead Potential"}),e.jsx(p,{options:ha,value:te,placeholder:"Select Lead Potential",onChange:se})]})})]})})})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-6",children:[e.jsx(w,{type:"button",onClick:be,variant:"outline",children:"Clear"}),e.jsx(w,{variant:"primary",type:"submit",children:"Save"})]})]}),e.jsxs(Fe,{isOpen:$e,onClose:A,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"newCampaignName",children:"Campaign Name *"}),e.jsx(i,{id:"newCampaignName",type:"text",value:q,onChange:a=>de(a.target.value),placeholder:"e.g., Summer Promotion 2024"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"newCampaignDesc",children:"Description"}),e.jsx("textarea",{id:"newCampaignDesc",value:me,onChange:a=>he(a.target.value),placeholder:"Campaign description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{htmlFor:"newCampaignDiscount",children:"Discount %"}),e.jsx(i,{id:"newCampaignDiscount",type:"number",min:"0",max:"100",value:M,onChange:a=>ue(a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{htmlFor:"newCampaignCashback",children:"Cashback (â‚¹)"}),e.jsx(i,{id:"newCampaignCashback",type:"number",min:"0",value:L,onChange:a=>pe(a.target.value),placeholder:"0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newCampaignActive",checked:xe,onChange:a=>ge(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(o,{htmlFor:"newCampaignActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active campaigns will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(w,{type:"button",variant:"outline",onClick:A,children:"Cancel"}),e.jsx(w,{type:"button",onClick:We,children:"Create Campaign"})]})]})]}),e.jsxs(Fe,{isOpen:ze,onClose:R,className:"max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white/90 mb-4",children:"Add New Contact Point"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"newContactPointName",children:"Contact Point Name *"}),e.jsx(i,{id:"newContactPointName",type:"text",value:I,onChange:a=>fe(a.target.value),placeholder:"e.g., Walk In"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"newContactPointDesc",children:"Description"}),e.jsx("textarea",{id:"newContactPointDesc",value:Ce,onChange:a=>we(a.target.value),placeholder:"Contact point description (optional)",rows:3,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"newContactPointActive",checked:ve,onChange:a=>je(a.target.checked),className:"h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500"}),e.jsx(o,{htmlFor:"newContactPointActive",className:"mb-0",children:"Mark as Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Only active contact points will appear in dropdowns"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(w,{type:"button",variant:"outline",onClick:R,children:"Cancel"}),e.jsx(w,{type:"button",onClick:Ke,children:"Create Contact Point"})]})]})]}),e.jsx(ua,{position:"top-center",className:"!z-[999999]",style:{zIndex:999999}})]})}export{fa as default};
